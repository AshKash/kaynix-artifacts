export class BaseSiteAdapter{constructor(e,t={}){this.domain=e,this.config=t,this.debug=t.debug}getDomain(){return this.domain}async search(e,t={}){throw new Error("search() must be implemented by site adapter")}async extractProducts(e={}){throw new Error("extractProducts() must be implemented by site adapter")}async applyFilters(e={}){throw new Error("applyFilters() must be implemented by site adapter")}async addToCart(e,t={}){throw new Error("addToCart() must be implemented by site adapter")}async extractAvailableFilters(){throw new Error("extractAvailableFilters() must be implemented by site adapter")}async clearFilters(){throw new Error("clearFilters() must be implemented by site adapter")}getFilterState(){throw new Error("getFilterState() must be implemented by site adapter")}async sortBy(e){throw new Error("sortBy() must be implemented by site adapter")}async waitForPageLoad(e=5e3){throw new Error("waitForPageLoad() must be implemented by site adapter")}detectPageType(){const e="undefined"!=typeof global&&global.window||window,t=e.location.pathname.toLowerCase(),r=e.location.search.toLowerCase();return t.includes("/product")||t.includes("/p/")?"product":t.includes("/search")||r.includes("q=")?"search":t.includes("/category")||t.includes("/c/")?"category":"/"===t||""===t?"home":t.includes("/cart")?"cart":"other"}getPageContext(){return{url:window.location.href,pathname:window.location.pathname,search:window.location.search,title:document.title,type:this.detectPageType(),domain:this.domain}}async waitForSelector(e,t=5e3){const r=Date.now();for(;Date.now()-r<t;){const t=document.querySelector(e);if(t&&null!==t.offsetParent)return t;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for selector: ${e}`)}async waitForAnySelector(e,t=5e3){const r=Array.isArray(e)?e:[e],o=Date.now();for(;Date.now()-o<t;){for(const e of r){const t=document.querySelector(e);if(t&&null!==t.offsetParent)return{element:t,selector:e}}await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for any selector: ${r.join(", ")}`)}async waitForElement(e,t=5e3){return this.waitForSelector(e,t)}async safeClick(e,t={}){if(!e)throw new Error("No element to click");if(e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),await new Promise(e=>setTimeout(e,t.scrollDelay||300)),null===e.offsetParent)throw new Error("Element is not visible");e.click(),t.waitAfter&&await new Promise(e=>setTimeout(e,t.waitAfter))}async typeText(e,t,r={}){if(!e)throw new Error("No element to type into");const{clearFirst:o=!0,delay:n=50,triggerEvents:i=!0}=r;e.focus(),o&&(e.value="",i&&e.dispatchEvent(new Event("input",{bubbles:!0})));for(const a of t)e.value+=a,i&&e.dispatchEvent(new Event("input",{bubbles:!0})),n>0&&await new Promise(e=>setTimeout(e,n));i&&(e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",code:"Enter",bubbles:!0})))}extractText(e){return e&&(e.textContent&&e.textContent.trim()||e.innerText&&e.innerText.trim())||""}extractPrice(e){if(!e)return null;const t=e.replace(/[^\d.,]/g,"").match(/(\d{1,3}(?:,\d{3})*(?:\.\d{2})?|\d+(?:\.\d{2})?)/);return t?parseFloat(t[1].replace(/,/g,"")):null}async findCheckboxByText(e,t=3){for(let r=0;r<t;r++){const o=[()=>{const t=Array.from(document.querySelectorAll("label"));for(const r of t)if(r.textContent.toLowerCase().includes(e.toLowerCase())){const e=r.querySelector('input[type="checkbox"]');if(e)return e;const t=r.getAttribute("for");if(t){const e=document.getElementById(t);if(e&&"checkbox"===e.type)return e}}return null},()=>{const t=document.querySelectorAll('input[type="checkbox"]');for(const r of t)if(r.value&&r.value.toLowerCase()===e.toLowerCase())return r;return null},()=>{const t=document.querySelectorAll('input[type="checkbox"]');for(const r of t){const t=r.getAttribute("aria-label");if(t&&t.toLowerCase().includes(e.toLowerCase()))return r}return null},()=>{const t=document.querySelectorAll('input[type="checkbox"]');for(const r of t){const t=r.parentElement;if(t&&t.textContent.toLowerCase().includes(e.toLowerCase()))return r}return null}];for(const e of o){const t=e();if(t)return t}r<t-1&&await new Promise(e=>setTimeout(e,500))}return null}async waitForProductUpdate(e=3e3){await new Promise(e=>setTimeout(e,300));const t=[".loading",".spinner",".loader","[data-loading]",".is-loading",".product-loading",".updating"];for(const r of t){const t=document.querySelector(r);if(t&&null!==t.offsetParent){const r=Date.now();for(;Date.now()-r<e&&t.offsetParent;)await new Promise(e=>setTimeout(e,100))}}await new Promise(e=>setTimeout(e,500))}async findElementByText(e,t,r={}){const{exact:o=!1,ignoreCase:n=!0,stripCount:i=!0,stripSymbols:a=!0}=r,s=document.querySelectorAll(e);for(const c of s){let e=this.extractText(c);i&&(e=e.replace(/\s*\(\d+\)\s*$/,"")),a&&(e=e.replace(/[✓×✗✔➜→]/g,"").trim());const r=n?e.toLowerCase():e,s=n?t.toLowerCase():t;if(o?r===s:r.includes(s))return c}return null}async findRadioByText(e,t=3){for(let r=0;r<t;r++){const o=[()=>{const t=Array.from(document.querySelectorAll("label"));for(const r of t)if(r.textContent.toLowerCase().includes(e.toLowerCase())){const e=r.querySelector('input[type="radio"]');if(e)return e;const t=r.getAttribute("for");if(t){const e=document.getElementById(t);if(e&&"radio"===e.type)return e}}return null},()=>{const t=document.querySelectorAll('input[type="radio"]');for(const r of t)if(r.value&&r.value.toLowerCase()===e.toLowerCase())return r;return null},()=>{const t=document.querySelectorAll('input[type="radio"]');for(const r of t){const t=r.getAttribute("aria-label");if(t&&t.toLowerCase().includes(e.toLowerCase()))return r}return null}];for(const e of o){const t=e();if(t)return t}r<t-1&&await new Promise(e=>setTimeout(e,500))}return null}async selectDropdownOption(e,t){if(!e)return!1;const r=e.querySelectorAll("option");for(const o of r)if(o.textContent.toLowerCase().includes(t.toLowerCase()))return e.value=o.value,e.dispatchEvent(new Event("change",{bubbles:!0})),!0;return!1}async setPriceRange(e,t){const r=document.querySelector('input[name*="min"][name*="price"], input[placeholder*="min"], input[aria-label*="minimum price"]'),o=document.querySelector('input[name*="max"][name*="price"], input[placeholder*="max"], input[aria-label*="maximum price"]');r&&null!==e&&await this.typeText(r,e.toString(),{clearFirst:!0}),o&&null!==t&&await this.typeText(o,t.toString(),{clearFirst:!0});const n=document.querySelector('button[class*="price"][class*="apply"], button[aria-label*="apply price"]');return n&&await this.safeClick(n),!(!r&&!o)}isOutOfStock(e){const t=this.extractText(e).toLowerCase();return["out of stock","sold out","unavailable","coming soon","notify me","out-of-stock","nicht verfügbar","agotado","épuisé"].some(e=>t.includes(e))}extractRating(e){if(!e)return null;const t=e.querySelector('[class*="rating"], [class*="star"], [aria-label*="rating"]');if(!t)return null;const r=t.getAttribute("aria-label");if(r){const e=r.match(/(\d+\.?\d*)\s*(out of|\/|stars?)/i);if(e)return parseFloat(e[1])}const o=this.extractText(t).match(/(\d+\.?\d*)\s*(\/\s*5|stars?|★)/i);if(o)return parseFloat(o[1]);const n=t.querySelectorAll('[class*="filled"], [class*="full"], .star.active');return n.length>0?n.length:null}extractReviewCount(e){if(!e)return null;const t=e.querySelector('[class*="review"], [class*="rating"]');if(!t)return null;const r=this.extractText(t).match(/\((\d+)\)|\b(\d+)\s*reviews?/i);return r?parseInt(r[1]||r[2]):null}log(...e){this.debug}error(...e){}warn(...e){}getMCPCapabilities(){return{tools:[]}}async callMCPTool(e,t){throw new Error(`MCP tool "${e}" not implemented by ${this.domain} adapter`)}}export const STANDARD_MCP_TOOLS=[{name:"search_products",description:"Search for products on the e-commerce site",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},filters:{type:"object",description:"Optional filters"}},required:["query"]}},{name:"apply_filters",description:"Apply filters to product listing",inputSchema:{type:"object",properties:{filters:{type:"object",description:"Filters to apply"}},required:["filters"]}},{name:"get_page_products",description:"Extract products from current page",inputSchema:{type:"object",properties:{}}},{name:"add_to_cart",description:"Add product to shopping cart",inputSchema:{type:"object",properties:{productId:{type:"string",description:"Product identifier"},size:{type:"string",description:"Product size"},quantity:{type:"number",description:"Quantity to add"}},required:["productId"]}}];export class MCPResponse{constructor(e,t,r=null,o=null){this.success=e,this.message=t,this.data=r,this.debug=o}}export class ProductJsonLD{constructor(e){this["@context"]="https://schema.org/",this["@type"]="Product",this.name=e.title,this.url=e.url,this.image=e.image,this.description=e.description,this.brand=e.brand?{"@type":"Brand",name:e.brand}:void 0,this.offers={"@type":"Offer",price:e.price,priceCurrency:e.currency||"USD",availability:e.inStock?"https://schema.org/InStock":"https://schema.org/OutOfStock"},this.aggregateRating=e.rating?{"@type":"AggregateRating",ratingValue:e.rating,reviewCount:e.reviewCount}:void 0}}export default BaseSiteAdapter;