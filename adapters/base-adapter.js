export class BaseSiteAdapter{constructor(e,t={}){this.domain=e,this.config=t,this.debug=t.debug}getDomain(){return this.domain}async search(e,t={}){throw new Error("search() must be implemented by site adapter")}async extractProducts(e={}){throw new Error("extractProducts() must be implemented by site adapter")}async applyFilters(e={}){throw new Error("applyFilters() must be implemented by site adapter")}async addToCart(e,t={}){throw new Error("addToCart() must be implemented by site adapter")}async waitForPageLoad(e=5e3){const t=Date.now();for(;Date.now()-t<e;){const e=document.querySelectorAll('.loading, .spinner, [class*="loading"], [class*="spinner"], [aria-busy="true"]');let t=!0;for(const r of e)if(null!==r.offsetParent){t=!1;break}if(t)return await new Promise(e=>setTimeout(e,100)),!0;await new Promise(e=>setTimeout(e,100))}return!1}detectPageType(){const e="undefined"!=typeof global&&global.window||window,t=e.location.pathname.toLowerCase(),r=e.location.search.toLowerCase();return t.includes("/product")||t.includes("/p/")?"product":t.includes("/search")||r.includes("q=")?"search":t.includes("/category")||t.includes("/c/")?"category":"/"===t||""===t?"home":t.includes("/cart")?"cart":"other"}getPageContext(){return{url:window.location.href,pathname:window.location.pathname,search:window.location.search,title:document.title,type:this.detectPageType(),domain:this.domain}}async waitForSelector(e,t=5e3){const r=Date.now();for(;Date.now()-r<t;){const t=document.querySelector(e);if(t&&null!==t.offsetParent)return t;await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for selector: ${e}`)}async waitForAnySelector(e,t=5e3){const r=Array.isArray(e)?e:[e],o=Date.now();for(;Date.now()-o<t;){for(const e of r){const t=document.querySelector(e);if(t&&null!==t.offsetParent)return{element:t,selector:e}}await new Promise(e=>setTimeout(e,100))}throw new Error(`Timeout waiting for any selector: ${r.join(", ")}`)}async waitForElement(e,t=5e3){return this.waitForSelector(e,t)}async safeClick(e,t={}){if(!e)throw new Error("No element to click");if(e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),await new Promise(e=>setTimeout(e,t.scrollDelay||300)),null===e.offsetParent)throw new Error("Element is not visible");e.click(),t.waitAfter&&await new Promise(e=>setTimeout(e,t.waitAfter))}async typeText(e,t,r={}){if(!e)throw new Error("No element to type into");const{clearFirst:o=!0,delay:n=50,triggerEvents:i=!0}=r;e.focus(),o&&(e.value="",i&&e.dispatchEvent(new Event("input",{bubbles:!0})));for(const s of t)e.value+=s,i&&e.dispatchEvent(new Event("input",{bubbles:!0})),n>0&&await new Promise(e=>setTimeout(e,n));i&&(e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",code:"Enter",bubbles:!0})))}extractText(e){return e&&(e.textContent&&e.textContent.trim()||e.innerText&&e.innerText.trim())||""}extractPrice(e){if(!e)return null;const t=e.replace(/[^\d.,]/g,"").match(/(\d{1,3}(?:,\d{3})*(?:\.\d{2})?|\d+(?:\.\d{2})?)/);return t?parseFloat(t[1].replace(/,/g,"")):null}async waitForDynamicContent(e=2e3){this.log(`Waiting ${e}ms for dynamic content to load...`),await new Promise(t=>setTimeout(t,e))}async findProductElements(e=[]){const t=[...e,".product-card",".product-item","article[data-product]",'[data-testid*="product"]',".search-result-item",".product-tile",".plp-product-card",'a[href*="/product/"]','div[class*="product-card"]','div[data-qa*="product"]'];for(const r of t){const e=document.querySelectorAll(r);if(e.length>0)return this.log(`Found ${e.length} products with selector: ${r}`),e}return this.warn("No product elements found with any selector"),document.querySelectorAll("_")}extractProductData(e,t=1){const r={position:t},o=["h1","h2","h3","h4",'[class*="product-name"]','[class*="product-title"]','[data-qa="product-name"]',".title",".name"];for(const s of o){const t=e.querySelector(s);if(t){r.title=this.extractText(t);break}}const n=e.closest("a")||e.querySelector("a");if(n){const e=n.getAttribute("href");r.url=e.startsWith("http")?e:`${window.location.origin}${e}`}const i=e.querySelector("img");return i&&(r.image=i.src||i.getAttribute("data-src")),r.title&&(r.brand=this.extractBrandFromTitle(r.title)),r}extractBrandFromTitle(e){const t=["Nike","Adidas","Brooks","ASICS","Saucony","New Balance","HOKA","Under Armour","Puma","Reebok","Mizuno","Salomon","On","Altra"];for(const o of t)if(e.toLowerCase().includes(o.toLowerCase()))return o;const r=e.split(" ");return r.length>1&&r[0].length>2?r[0]:""}async navigateTo(e,t={}){this.log(`Navigating to: ${e}`),window.location.href=e,await new Promise(e=>setTimeout(e,100)),t.waitForSelector?await this.waitForSelector(t.waitForSelector,t.timeout):await this.waitForPageLoad(t.timeout)}async waitForProductUpdate(e=3e3){await this.waitForPageLoad(e),await new Promise(e=>setTimeout(e,500))}findCheckboxByText(e){const t=e.trim().toLowerCase(),r=document.querySelectorAll('input[type="checkbox"]');for(const o of r){const e=o.closest("label")||document.querySelector(`label[for="${o.id}"]`);if(e){if(this.extractText(e).toLowerCase().includes(t))return o}const r=o.parentElement;if(r){if(this.extractText(r).toLowerCase().includes(t))return o}}return null}extractCountFromLabel(e){const t=e.match(/\((\d+)\)/);return t?parseInt(t[1]):null}async extractAvailableFilters(){const e={brands:[],colors:[],sizes:[],priceRanges:[],categories:[],sortOptions:[]},t=document.querySelectorAll('.filters, .sidebar, .filter-sidebar, [data-filters], .facets, .refinements, .product-filters, .plp-filters, aside, [role="complementary"], .left-sidebar, .filter-panel'),r=t.length>0?t:[document.body];for(const n of r){n.querySelectorAll('input[type="checkbox"]').forEach(t=>{const r=this.extractText(t.closest("label")||t.parentElement);if(!r||r.length>50)return;const o={label:r,value:t.value||r,isChecked:t.checked,count:this.extractCountFromLabel(r)},n=r.toLowerCase();this.isSizePattern(n)?e.sizes.push(o):this.isColorPattern(n)?e.colors.push(o):this.isBrandPattern(n)&&e.brands.push(o)})}const o=document.querySelector('select[name*="sort"], .sort-select, #sort-options');if(o){o.querySelectorAll("option").forEach(t=>{t.value&&t.textContent.trim()&&e.sortOptions.push({label:t.textContent.trim(),value:t.value,isSelected:t.selected})})}return e}isSizePattern(e){return/^(xs|s|m|l|xl|xxl|xxxl|\d+(\.\d+)?|small|medium|large|x-small|x-large)$/i.test(e)}isColorPattern(e){return["black","white","red","blue","green","yellow","orange","purple","pink","gray","grey","brown","navy","beige","tan","gold","silver","multi"].some(t=>e.includes(t))}isBrandPattern(e){return["nike","adidas","brooks","asics","saucony","new balance","hoka","under armour","puma","reebok","mizuno","salomon","on","altra"].some(t=>e.includes(t))}formatFilterValues(e){return Array.isArray(e)?e.map(e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e){if(e.label)return e.label;if(e.value)return e.value;if(e.name)return e.name;if(e.text)return e.text;for(const[t,r]of Object.entries(e))if("string"==typeof r&&r.trim())return r;return"Unknown"}return String(e)}).filter(e=>e&&e.trim()):[]}formatFilterList(e,t=5){if(!e||0===e.length)return null;const r=this.formatFilterValues(e);if(0===r.length)return null;if(r.length<=t)return r.join(", ");return`${r.slice(0,t).join(", ")} (+${r.length-t} more)`}formatAvailableFilters(e){if(!e||0===Object.keys(e).length)return"ðŸ” No filters detected on this page.\n\nTry:\nâ€¢ Navigate to a category page\nâ€¢ Use /extract to see products";let t="ðŸŽ›ï¸ Available filters on this page:\n\n";if(e.sizes&&e.sizes.length>0){const r=this.formatFilterList(e.sizes);r&&(t+=`ðŸ“ Sizes (${e.sizes.length}): ${r}\n`)}if(e.colors&&e.colors.length>0){const r=this.formatFilterList(e.colors);r&&(t+=`ðŸŽ¨ Colors (${e.colors.length}): ${r}\n`)}if(e.players&&e.players.length>0){const r=this.formatFilterList(e.players);r&&(t+=`ðŸ€ Players (${e.players.length}): ${r}\n`)}if(e.productTypes&&e.productTypes.length>0){const r=this.formatFilterList(e.productTypes);r&&(t+=`ðŸ“¦ Types (${e.productTypes.length}): ${r}\n`)}if(e.priceRange&&("object"==typeof e.priceRange?t+=`ðŸ’° Price: $${e.priceRange.min||0} - $${e.priceRange.max||"N/A"}\n`:t+=`ðŸ’° Price: ${e.priceRange}\n`),e.categories&&e.categories.length>0){const r=this.formatFilterList(e.categories);r&&(t+=`ðŸ“‚ Categories (${e.categories.length}): ${r}\n`)}if(e.brands&&e.brands.length>0){const r=this.formatFilterList(e.brands);r&&(t+=`ðŸ·ï¸ Brands (${e.brands.length}): ${r}\n`)}const r=["sizes","colors","players","productTypes","priceRange","categories","brands"];return Object.keys(e).forEach(o=>{if(!r.includes(o)&&e[o]&&Array.isArray(e[o])&&e[o].length>0){const r=this.formatFilterList(e[o]);r&&(t+=`ðŸ”¹ ${o} (${e[o].length}): ${r}\n`)}}),t+="\nðŸ’¡ Usage examples:\n",t+="â€¢ /filter size M\n",t+="â€¢ /filter lebron james\n",t+="â€¢ /filter red under $50",t}log(...e){this.debug}error(...e){}warn(...e){}getMCPCapabilities(){return{tools:[]}}async callMCPTool(e,t){throw new Error(`MCP tool "${e}" not implemented by ${this.domain} adapter`)}}export const STANDARD_MCP_TOOLS=[{name:"search_products",description:"Search for products on the e-commerce site",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},filters:{type:"object",description:"Optional filters"}},required:["query"]}},{name:"apply_filters",description:"Apply filters to product listing",inputSchema:{type:"object",properties:{filters:{type:"object",description:"Filters to apply"}},required:["filters"]}},{name:"get_page_products",description:"Extract products from current page",inputSchema:{type:"object",properties:{}}},{name:"add_to_cart",description:"Add product to shopping cart",inputSchema:{type:"object",properties:{productId:{type:"string",description:"Product identifier"},size:{type:"string",description:"Product size"},quantity:{type:"number",description:"Quantity to add"}},required:["productId"]}}];export class MCPResponse{constructor(e,t,r=null,o=null){this.success=e,this.message=t,this.data=r,this.debug=o}}export class ProductJsonLD{constructor(e){this["@context"]="https://schema.org/",this["@type"]="Product",this.name=e.title,this.url=e.url,this.image=e.image,this.description=e.description,this.brand=e.brand?{"@type":"Brand",name:e.brand}:void 0,this.offers={"@type":"Offer",price:e.price,priceCurrency:e.currency||"USD",availability:e.inStock?"https://schema.org/InStock":"https://schema.org/OutOfStock"},this.aggregateRating=e.rating?{"@type":"AggregateRating",ratingValue:e.rating,reviewCount:e.reviewCount}:void 0}}export default BaseSiteAdapter;