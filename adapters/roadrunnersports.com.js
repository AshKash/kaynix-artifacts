import BaseSiteAdapter from"./base-adapter.js";export default class RoadrunnersportscomAdapter extends BaseSiteAdapter{constructor(){super("roadrunnersports.com",{searchUrl:"https://roadrunnersports.com/search?q={query}",categoryUrls:["https://roadrunnersports.com/category/womens/apparel/outerwear","https://roadrunnersports.com/category/womens/apparel/shorts","https://roadrunnersports.com/category/womens/apparel/tightsandpants","https://roadrunnersports.com/category/womens/shoes/new","https://roadrunnersports.com/category/womens/shoes/outlet","https://roadrunnersports.com/category/womens/apparel/outlet","https://roadrunnersports.com/category/womens/accessories/outlet","https://roadrunnersports.com/category/womens/shoes","https://roadrunnersports.com/category/womens/shoes/running","https://roadrunnersports.com/category/womens/shoes/trail-running","https://roadrunnersports.com/category/womens/shoes/cross-training","https://roadrunnersports.com/category/womens/shoes/racing","https://roadrunnersports.com/category/womens/shoes/sandals","https://roadrunnersports.com/category/womens/shoes/walking","https://roadrunnersports.com/category/womens/shoes/casual","https://roadrunnersports.com/category/womens/shoes/hiking","https://roadrunnersports.com/category/womens/shoes/cross-country","https://roadrunnersports.com/category/womens/shoes/court","https://roadrunnersports.com/category/womens/shoes/pickleball","https://roadrunnersports.com/category/womens/shoes/work-safety"],productItemSelector:'.product-card, .product-item, article[data-product], [data-testid*="product"], .search-result-item',searchInputSelector:'input[type="search"], input[name="q"], input[name="search"], input[placeholder*="search" i]',searchButtonSelector:'button[type="submit"], button[class*="search"]'})}async search(t,e={}){try{const r=this.config.searchUrl.replace("{query}",encodeURIComponent(t));await this.navigateTo(r,e),await this.waitForSelector(this.config.productItemSelector,{timeout:e.timeout||1e4});const s=await this.extractProducts(e);return{success:!0,query:t,products:s.products||[],count:s.products?.length||0}}catch(r){return{success:!1,query:t,error:r.message,products:[]}}}async extractProducts(t={}){try{const t=[];await new Promise(t=>setTimeout(t,2e3));let e=document.querySelectorAll(this.config.productItemSelector);if(0===e.length){const t=['a[href*="/product/"] > div','div[class*="product-list"] > div > a','div[class*="search-results"] article','div[class*="ProductCard"]','div[data-qa*="product"]'];for(const r of t)if(e=document.querySelectorAll(r),e.length>0)break}for(let r=0;r<e.length;r++){const s=e[r],o=s,c={position:r+1},a=o.querySelector('h2, h3, h4, [class*="product-name"], [class*="product-title"], [data-qa="product-name"]');a&&(c.title=this.extractText(a));const n=s.closest("a")||o.querySelector('a[href*="/product"]');if(n){const t=n.getAttribute("href");c.url=t.startsWith("http")?t:`https://roadrunnersports.com${t}`}let i=o.querySelector('.price, [class*="price"], .cost, [data-price]');if(i||(i=o.querySelector('[class*="dollar"], [class*="amount"], [class*="currency"]')),!i){const t=o.querySelectorAll("*");for(const e of t){const t=this.extractText(e);if(t&&/\$\d/.test(t)){i=e;break}}}if(i){const t=this.extractText(i);c.priceText=t,c.price=this.extractPrice(t)}const l=o.querySelector("img");l&&(c.image=l.src||l.getAttribute("data-src")),c.title&&(c.brand=this.extractBrandFromName(c.title)),c.title&&c.url&&t.push(c)}return{success:!0,products:t}}catch(e){return{success:!1,error:e.message,products:[]}}}async applyFilters(t){try{let e=0;if(t.brands&&t.brands.length>0)for(const r of t.brands){const t=r.replace(/\s*\(\d+\)\s*$/,"").trim(),s=await this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),e++)}if(t.sizes&&t.sizes.length>0)for(const r of t.sizes){const t=r.replace(/\s*\(\d+\)\s*$/,"").trim(),s=await this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),e++)}if(t.colors&&t.colors.length>0)for(const r of t.colors){const t=r.replace(/\s*\(\d+\)\s*$/,"").trim(),s=await this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),e++)}return{success:!0,filtersApplied:e,message:`Applied ${e} filters`,products:(await this.extractProducts()).products||[]}}catch(e){return{success:!1,error:e.message}}}async extractAvailableFilters(){try{const t={brands:[],colors:[],sizes:[],priceRanges:[],categories:[],sortOptions:[]},e=document.querySelectorAll(".filters, .sidebar, .filter-sidebar, [data-filters], .facets, .refinements");for(const s of e){const e=s.querySelector('[data-filter="brand"], .brand-filter, .brands');if(e){e.querySelectorAll('input[type="checkbox"], .filter-option').forEach(e=>{const r=this.extractText(e.parentElement||e.nextElementSibling);r&&t.brands.push({label:r,value:e.value||r.toLowerCase().replace(/\s+/g,"-"),isChecked:e.checked||!1,count:this.extractCountFromLabel(r)})})}const r=s.querySelector('[data-filter="size"], .size-filter, .sizes');if(r){r.querySelectorAll('input[type="checkbox"], .filter-option, .size-option').forEach(e=>{const r=this.extractText(e.parentElement||e.nextElementSibling);r&&t.sizes.push({label:r,value:e.value||r.toLowerCase(),isChecked:e.checked||!1,count:this.extractCountFromLabel(r)})})}const o=s.querySelector('[data-filter="color"], .color-filter, .colors');if(o){o.querySelectorAll('input[type="checkbox"], .filter-option, .color-option').forEach(e=>{const r=this.extractText(e.parentElement||e.nextElementSibling);r&&t.colors.push({label:r,value:e.value||r.toLowerCase(),isChecked:e.checked||!1,count:this.extractCountFromLabel(r)})})}}const r=document.querySelector('select[name*="sort"], .sort-select, #sort-options');if(r){r.querySelectorAll("option").forEach(e=>{e.value&&e.textContent.trim()&&t.sortOptions.push({label:e.textContent.trim(),value:e.value})})}return t}catch(t){return{brands:[],colors:[],sizes:[],priceRanges:[],categories:[],sortOptions:[]}}}extractCountFromLabel(t){const e=t.match(/\((\d+)\)/);return e?parseInt(e[1]):null}extractBrandFromName(t){const e=["Nike","Adidas","Brooks","ASICS","Saucony","New Balance","HOKA","Under Armour"];for(const r of e)if(t.toLowerCase().includes(r.toLowerCase()))return r;return""}getMCPCapabilities(){return{tools:[{name:"search_products",description:"Search for products on Road Runner Sports",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query for products"}},required:["query"]}},{name:"apply_filters",description:"Apply filters like brand, size, color to refine products",inputSchema:{type:"object",properties:{filters:{type:"object",properties:{brands:{type:"array",items:{type:"string"}},sizes:{type:"array",items:{type:"string"}},colors:{type:"array",items:{type:"string"}}}}},required:["filters"]}}]}}async callMCPTool(t,e){switch(t){case"search_products":return await this.search(e.query);case"apply_filters":return await this.applyFilters(e.filters);default:throw new Error(`Unknown MCP tool: ${t}`)}}getVersion(){const t=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+),\s(.+)/,"$3-$1-$2 $4"),e=this.constructor.toString().split("").reduce((t,e)=>(t=(t<<5)-t+e.charCodeAt(0))&t,0);return`roadrunner-v2.4-${t} PST [hash:${Math.abs(e)}]`}}