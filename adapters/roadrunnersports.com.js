import{BaseSiteAdapter}from"./base-adapter.js";export default class RoadrunnersportscomAdapter extends BaseSiteAdapter{constructor(){super("roadrunnersports.com",{searchUrl:"https://roadrunnersports.com/search?q={query}",categoryUrls:["https://roadrunnersports.com/category/womens/apparel/outerwear","https://roadrunnersports.com/category/womens/apparel/shorts","https://roadrunnersports.com/category/womens/apparel/tightsandpants","https://roadrunnersports.com/category/womens/shoes/new","https://roadrunnersports.com/category/womens/shoes/outlet","https://roadrunnersports.com/category/womens/apparel/outlet","https://roadrunnersports.com/category/womens/accessories/outlet","https://roadrunnersports.com/category/womens/shoes","https://roadrunnersports.com/category/womens/shoes/running","https://roadrunnersports.com/category/womens/shoes/trail-running","https://roadrunnersports.com/category/womens/shoes/cross-training","https://roadrunnersports.com/category/womens/shoes/racing","https://roadrunnersports.com/category/womens/shoes/sandals","https://roadrunnersports.com/category/womens/shoes/walking","https://roadrunnersports.com/category/womens/shoes/casual","https://roadrunnersports.com/category/womens/shoes/hiking","https://roadrunnersports.com/category/womens/shoes/cross-country","https://roadrunnersports.com/category/womens/shoes/court","https://roadrunnersports.com/category/womens/shoes/pickleball","https://roadrunnersports.com/category/womens/shoes/work-safety"],productItemSelector:'[class*="product-card"]',searchInputSelector:'input[type="search"], input[name="q"], input[name="search"], input[placeholder*="search" i]',searchButtonSelector:'button[type="submit"], button[class*="search"]'})}async search(t,r={}){try{const e=this.config.searchUrl.replace("{query}",encodeURIComponent(t));await this.navigateTo(e,{waitForSelector:this.config.productItemSelector,timeout:r.timeout||1e4});const s=await this.extractProducts(r);return{success:!0,query:t,products:s.products||[],count:s.products?.length||0}}catch(e){return{success:!1,query:t,error:e.message,products:[]}}}async extractProducts(t={}){try{const t=[];await this.waitForDynamicContent(2e3);const r=await this.findProductElements([this.config.productItemSelector]);for(let e=0;e<r.length;e++){const s=r[e],o=this.extractProductData(s,e+1),c=['[class*="price"]','[data-testid*="price"]','[data-qa*="price"]','[aria-label*="price"]',".price",".cost",".amount"];let a=!1;for(const t of c){const r=s.querySelector(t);if(r){const t=this.extractText(r);if(t&&(o.price=this.extractPrice(t),null!==o.price)){a=!0;break}}}if(!a&&0===e){const t=s.querySelectorAll("*");for(const r of t){const t=r.textContent||"";t.includes("$")&&!t.includes("script")&&r.children.length}}o.title&&o.url&&t.push(o)}return{success:!0,products:t}}catch(r){return{success:!1,error:r.message,products:[]}}}async applyFilters(t){try{let r=0;if(t.brands&&t.brands.length>0)for(const e of t.brands){const t=e.replace(/\s*\(\d+\)\s*$/,"").trim(),s=this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),r++)}if(t.sizes&&t.sizes.length>0)for(const e of t.sizes){const t=e.replace(/\s*\(\d+\)\s*$/,"").trim(),s=this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),r++)}if(t.colors&&t.colors.length>0)for(const e of t.colors){const t=e.replace(/\s*\(\d+\)\s*$/,"").trim(),s=this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),r++)}return{success:!0,filtersApplied:r,message:`Applied ${r} filters`,products:(await this.extractProducts()).products||[]}}catch(r){return{success:!1,error:r.message}}}async extractAvailableFilters(){try{return await super.extractAvailableFilters()}catch(t){return{brands:[],colors:[],sizes:[],priceRanges:[],categories:[],sortOptions:[]}}}getMCPCapabilities(){return{tools:[{name:"search_products",description:"Search for products on Road Runner Sports",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query for products"}},required:["query"]}},{name:"apply_filters",description:"Apply filters like brand, size, color to refine products",inputSchema:{type:"object",properties:{filters:{type:"object",properties:{brands:{type:"array",items:{type:"string"}},sizes:{type:"array",items:{type:"string"}},colors:{type:"array",items:{type:"string"}}}}},required:["filters"]}}]}}async callMCPTool(t,r){switch(t){case"search_products":return await this.search(r.query);case"apply_filters":return await this.applyFilters(r.filters);default:throw new Error(`Unknown MCP tool: ${t}`)}}getVersion(){const t=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+),\s(.+)/,"$3-$1-$2 $4"),r=this.constructor.toString().split("").reduce((t,r)=>(t=(t<<5)-t+r.charCodeAt(0))&t,0);return`roadrunner-v2.7-clean-${t} PST [hash:${Math.abs(r)}]`}}