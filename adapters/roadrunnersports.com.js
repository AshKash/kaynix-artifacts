import{BaseSiteAdapter}from"./base-adapter.js";export default class RoadrunnersportscomAdapter extends BaseSiteAdapter{constructor(){super("roadrunnersports.com",{searchUrl:"https://roadrunnersports.com/search?q={query}",categoryUrls:["https://roadrunnersports.com/category/womens/apparel/outerwear","https://roadrunnersports.com/category/womens/apparel/shorts","https://roadrunnersports.com/category/womens/apparel/tightsandpants","https://roadrunnersports.com/category/womens/shoes/new","https://roadrunnersports.com/category/womens/shoes/outlet","https://roadrunnersports.com/category/womens/apparel/outlet","https://roadrunnersports.com/category/womens/accessories/outlet","https://roadrunnersports.com/category/womens/shoes","https://roadrunnersports.com/category/womens/shoes/running","https://roadrunnersports.com/category/womens/shoes/trail-running","https://roadrunnersports.com/category/womens/shoes/cross-training","https://roadrunnersports.com/category/womens/shoes/racing","https://roadrunnersports.com/category/womens/shoes/sandals","https://roadrunnersports.com/category/womens/shoes/walking","https://roadrunnersports.com/category/womens/shoes/casual","https://roadrunnersports.com/category/womens/shoes/hiking","https://roadrunnersports.com/category/womens/shoes/cross-country","https://roadrunnersports.com/category/womens/shoes/court","https://roadrunnersports.com/category/womens/shoes/pickleball","https://roadrunnersports.com/category/womens/shoes/work-safety"],productItemSelector:'[class*="product-card"]',searchInputSelector:'input[type="search"], input[name="q"], input[name="search"], input[placeholder*="search" i]',searchButtonSelector:'button[type="submit"], button[class*="search"]'})}async search(t,e={}){try{const r=this.config.searchUrl.replace("{query}",encodeURIComponent(t));await this.navigateTo(r,{waitForSelector:this.config.productItemSelector,timeout:e.timeout||1e4});const s=await this.extractProducts(e);return{success:!0,query:t,products:s.products||[],count:s.products?.length||0}}catch(r){return{success:!1,query:t,error:r.message,products:[]}}}async extractProducts(t={}){try{const t=[];await this.waitForDynamicContent(2e3);const e=await this.findProductElements([this.config.productItemSelector]);for(let r=0;r<e.length;r++){const s=e[r],o=this.extractProductData(s,r+1),n=['[class*="price"]','[data-testid*="price"]','[data-qa*="price"]','[aria-label*="price"]',".price",".cost",".amount"];let c=!1;for(const t of n){const e=s.querySelector(t);if(e){const t=this.extractText(e);if(t&&(o.price=this.extractPrice(t),null!==o.price)){c=!0;break}}}if(!c&&0===r){const t=s.querySelectorAll("*");for(const e of t){const t=e.textContent||"";t.includes("$")&&!t.includes("script")&&e.children.length}}o.title&&o.url&&t.push(o)}return{success:!0,products:t}}catch(e){return{success:!1,error:e.message,products:[]}}}async applyFilters(t){try{let e=0;if(t.brands&&t.brands.length>0)for(const r of t.brands){const t=r.replace(/\s*\(\d+\)\s*$/,"").trim(),s=this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),e++)}if(t.sizes&&t.sizes.length>0)for(const r of t.sizes){const t=r.replace(/\s*\(\d+\)\s*$/,"").trim(),s=this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),e++)}if(t.colors&&t.colors.length>0)for(const r of t.colors){const t=r.replace(/\s*\(\d+\)\s*$/,"").trim(),s=this.findCheckboxByText(t);s&&!s.checked&&(await this.safeClick(s),await this.waitForProductUpdate(),e++)}return{success:!0,filtersApplied:e,message:`Applied ${e} filters`,products:(await this.extractProducts()).products||[]}}catch(e){return{success:!1,error:e.message}}}async extractAvailableFilters(){try{const e=document.querySelectorAll("button");let r=0;for(const o of e)if(o.textContent&&o.textContent.includes("Show All"))try{o.click(),r++}catch(t){}await this.waitForDynamicContent(1e3);const s={brands:[],colors:[],sizes:[],priceRanges:[],categories:[],sortOptions:[]};document.querySelectorAll('input[type="checkbox"]').forEach(t=>{const e=t.closest("label")||t.parentElement;if(!e)return;const r=this.extractText(e);if(!r||r.length>100)return;const o={label:r,value:t.value||r,isChecked:t.checked,count:this.extractCountFromLabel(r)},n=r.toLowerCase();if(/^\d+(\.\d+)?(\s*\(\d+\))?$/.test(r)||/^(xx?s|xx?l|small|medium|large)/i.test(r)||/\b(size|width)\b/i.test(n))s.sizes.push(o);else if(this.isColorPattern(n)||/\b(color|colour)\b/i.test(n))s.colors.push(o);else if(/\$\d+|\d+\s*-\s*\d+|under|over|price/i.test(n))s.priceRanges.push(o);else if(this.isKnownBrand(r)||this.isInBrandSection(t))s.brands.push(o);else if(this.isCategoryPattern(n))s.categories.push(o);else{const e=this.getFilterSection(t);"brand"===e?s.brands.push(o):s.categories.push(o)}}),s.sizes.sort((t,e)=>(parseFloat(t.label)||999)-(parseFloat(e.label)||999));return document.querySelectorAll('select[name*="sort"], .sort-select, #sort-options').forEach(t=>{t.querySelectorAll("option").forEach(t=>{t.value&&t.textContent.trim()&&s.sortOptions.push({label:t.textContent.trim(),value:t.value,isSelected:t.selected})})}),s}catch(e){return{brands:[],colors:[],sizes:[],priceRanges:[],categories:[],sortOptions:[]}}}isKnownBrand(t){const e=t.toLowerCase();return["adidas","nike","asics","brooks","hoka","new balance","saucony","mizuno","altra","on","salomon","under armour","reebok","puma","topo athletic","newton","karhu"].some(t=>e.includes(t))}isInBrandSection(t){let e=t.parentElement,r=0;for(;e&&r<5;){const t=e.textContent||"";if(/brand|manufacturer/i.test(t))return!0;e=e.parentElement,r++}return!1}isCategoryPattern(t){return["shoes","apparel","accessories","gear","equipment","running","trail","road","track","cross country","socks","shorts","shirts","jackets","pants","hydration","nutrition","electronics","recovery"].some(e=>t.includes(e))}getFilterSection(t){let e=t.parentElement,r=0;for(;e&&r<5;){const t=e.querySelector('h1, h2, h3, h4, [class*="heading"]');if(t){const e=t.textContent.toLowerCase();if(e.includes("brand"))return"brand";if(e.includes("categor"))return"category";if(e.includes("size"))return"size";if(e.includes("color"))return"color";if(e.includes("price"))return"price"}e=e.parentElement,r++}return"unknown"}getMCPCapabilities(){return{tools:[{name:"search_products",description:"Search for products on Road Runner Sports",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query for products"}},required:["query"]}},{name:"apply_filters",description:"Apply filters like brand, size, color to refine products",inputSchema:{type:"object",properties:{filters:{type:"object",properties:{brands:{type:"array",items:{type:"string"}},sizes:{type:"array",items:{type:"string"}},colors:{type:"array",items:{type:"string"}}}}},required:["filters"]}}]}}async callMCPTool(t,e){switch(t){case"search_products":return await this.search(e.query);case"apply_filters":return await this.applyFilters(e.filters);default:throw new Error(`Unknown MCP tool: ${t}`)}}getVersion(){const t=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+),\s(.+)/,"$3-$1-$2 $4"),e=this.constructor.toString().split("").reduce((t,e)=>(t=(t<<5)-t+e.charCodeAt(0))&t,0);return`roadrunner-v2.7-clean-${t} PST [hash:${Math.abs(e)}]`}}