(()=>{"use strict";var e,t,n={},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return n[e](a,a.exports,i),a.exports}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t,n){return t=l(t),function(e,t){if(t&&("object"==a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(t,n||[],l(e).constructor):t.apply(e,n))}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(c())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&u(i,n.prototype),i}(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)},s(e)}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function f(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}i.m=n,i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((t,n)=>(i.f[n](e,t),t),[])),i.u=e=>(193===e?"kaynix-common":e)+"."+{12:"a1ac9e073b9b333489dd",116:"bdf310e5ae8a49c35023",193:"4005a4fd84647028f72a",282:"55a3c29d4454d268f30d",461:"44239524802535d7ec0b",481:"9efb425d82a8c310aa8e",617:"dbc5adc7025bea044772",622:"7584bd8b819f365f989e",735:"bbc9c90ccee7e0e876c6",981:"dc6ebc3ce045c897d907"}[e]+".js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="kaynix-frontend:",i.l=(n,r,a,o)=>{if(e[n])e[n].push(r);else{var s,c;if(void 0!==a)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+a){s=d;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.setAttribute("data-webpack",t+a),s.src=n),e[n]=[r];var p=(t,r)=>{s.onerror=s.onload=null,clearTimeout(f);var i=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach(e=>e(r)),t)return t(r)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),c&&document.head.appendChild(s)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={239:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var a=new Promise((n,i)=>r=e[t]=[n,i]);n.push(r[2]=a);var o=i.p+i.u(t),s=new Error;i.l(o,n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,r[1](s)}},"chunk-"+t,t)}};var t=(t,n)=>{var r,a,[o,s,c]=n,u=0;if(o.some(t=>0!==e[t])){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(c)c(i)}for(t&&t(n);u<o.length;u++)a=o[u],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0},n=self.webpackChunkkaynix_frontend=self.webpackChunkkaynix_frontend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var h={DEFAULT_TIMEOUT:3e4,DEFAULT_BASE_URL_PROD:"https://api.kaynix.ai",DEFAULT_BASE_URL_DEV:"http://localhost:8080",DEFAULT_PORT_DEV:"8090"},m={API_KEY:"kaynix_api_key",FORCE_LOCAL:"kaynix_force_local"},y={LOCAL_MODE:"kaynix_local"},b=0,v=1,w=2,x=3,k=function(){return f(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;d(this,e),this.name=t,this.level=n,this.debugMode=_()||"true"===localStorage.getItem("kaynix_debug")},[{key:"debug",value:function(){if(this.debugMode&&this.level<=b){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[".concat(this.name,"]")].concat(n))}}},{key:"info",value:function(){if(this.level<=v){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[".concat(this.name,"]")].concat(n))}}},{key:"warn",value:function(){if(this.level<=w){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).warn.apply(e,["[".concat(this.name,"]")].concat(n))}}},{key:"error",value:function(){if(this.level<=x){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,["[".concat(this.name,"]")].concat(n))}}}])}();function _(){if("undefined"==typeof window)return!1;var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||window.location.port===h.DEFAULT_PORT_DEV||"true"===localStorage.getItem(m.FORCE_LOCAL)||window.location.search.includes("".concat(y.LOCAL_MODE,"=true"))||!0===window.KAYNIX_FORCE_LOCAL}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.baseUrl?e.baseUrl:_()?h.DEFAULT_BASE_URL_DEV:h.DEFAULT_BASE_URL_PROD}var A=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UNKNOWN_ERROR",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return d(this,t),(n=o(this,t,[e])).name="ApiError",n.code=r,n.details=i,n.timestamp=(new Date).toISOString(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),f(t,[{key:"toJSON",value:function(){return{error:{message:this.message,code:this.code,details:this.details,timestamp:this.timestamp}}}}])}(s(Error));function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UNKNOWN_ERROR",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e instanceof A)return e;var r=e instanceof Error?e.message:String(e);return new A(r,t,n)}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var n=localStorage.getItem(e);if(null===n)return t;try{return JSON.parse(n)}catch(r){return n}}catch(i){return t}}function P(e,t){try{var n="string"==typeof t?t:JSON.stringify(t);return localStorage.setItem(e,n),!0}catch(r){return!1}}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach(function(t){N(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function N(e,t,n){return(t=K(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return L(u,"_invoke",function(n,r,i){var a,s,c,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,o}};function f(n,r){for(s=n,c=r,t=0;!d&&u&&!i&&t<l.length;t++){var i,a=l[t],f=p.p,g=a[2];n>3?(i=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=n<2&&f<a[1])?(s=0,p.v=r,p.n=a[1]):f<g&&(i=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,p.n=g,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(p.n=-1),f(s,c)):p.n=c:p.v=c);try{if(u=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(d=p.n<0)?c:n.call(r,p))!==o)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,i,a),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(L(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,L(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,L(d,"constructor",u),L(u,"constructor",c),c.displayName="GeneratorFunction",L(u,i,"GeneratorFunction"),L(d),L(d,i,"Generator"),L(d,r,function(){return this}),L(d,"toString",function(){return"[object Generator]"}),(q=function(){return{w:a,m:p}})()}function L(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}L=function(e,t,n,r){if(t)i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){L(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},L(e,t,n,r)}function D(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function U(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){D(a,r,i,o,s,"next",e)}function s(e){D(a,r,i,o,s,"throw",e)}o(void 0)})}}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,K(r.key),r)}}function K(e){var t=function(e,t){if("object"!=T(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==T(t)?t:t+""}const F=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={baseUrl:t.baseUrl||S(),timeout:t.timeout||h.DEFAULT_TIMEOUT,debug:t.debug||!1},this.apiKeyProvider=t.apiKeyProvider||null,this.requestId=0,this.logger=new k("KaynixAPI",this.config.debug?0:1),this.logger.debug("Initialized with base URL: ".concat(this.config.baseUrl))},t=[{key:"_getDefaultBaseUrl",value:function(){return S()}},{key:"getApiKey",value:(l=U(q().m(function e(){var t,n;return q().w(function(e){for(;;)switch(e.n){case 0:if(this.logger.debug("getApiKey called"),this.logger.debug("Current location:",window.location.href),this.logger.debug("Current origin:",window.location.origin),this.logger.debug("localStorage available:","undefined"!=typeof localStorage),!_()){e.n=2;break}if("undefined"==typeof process||!process.env||!process.env.KAYNIX_API_KEY){e.n=1;break}return this.logger.debug("Using KAYNIX_API_KEY from environment variable"),e.a(2,process.env.KAYNIX_API_KEY);case 1:this.logger.warn("KAYNIX_API_KEY not found in environment variables for development mode.");case 2:if(this.logger.debug("Checking localStorage for key:",m.API_KEY),t=C(m.API_KEY),this.logger.debug("StoredKey found:",!!t,t?"(length: "+t.length+")":""),!t){e.n=3;break}return e.a(2,t);case 3:if(!this.apiKeyProvider||"function"!=typeof this.apiKeyProvider){e.n=6;break}return this.logger.debug("Using apiKeyProvider function"),e.n=4,this.apiKeyProvider();case 4:if(!(n=e.v)){e.n=5;break}return this.logger.debug("Got key from provider, saving to localStorage"),P(m.API_KEY,n),e.a(2,n);case 5:this.logger.debug("Provider returned no key");case 6:throw this.logger.error("No API key available - all methods failed"),new A("No API key available","NO_API_KEY");case 7:return e.a(2)}},e,this)})),function(){return l.apply(this,arguments)})},{key:"request",value:(u=U(q().m(function e(t){var n,r,i,a,o,s,c,u,l,d,p,f,g,h,m,y,b=arguments;return q().w(function(e){for(;;)switch(e.n){case 0:return n=b.length>1&&void 0!==b[1]?b[1]:{},r=++this.requestId,e.p=1,e.n=2,this.getApiKey();case 2:return i=e.v,a="".concat(this.config.baseUrl).concat(t),o=new AbortController,s=setTimeout(function(){return o.abort()},this.config.timeout),c={method:n.method||"POST",headers:M({"Content-Type":"application/json",Authorization:"Bearer ".concat(i),"X-Request-ID":"widget-".concat(r)},n.headers),signal:o.signal},n.body&&(c.body=JSON.stringify(n.body)),this.logger.debug("Request ".concat(r,": ").concat(c.method," ").concat(a),n.body),this.logger.debug("Current location: ".concat(window.location.href)),this.logger.debug("Port detection: ".concat(window.location.port)),this.logger.debug("Base URL: ".concat(this.config.baseUrl)),e.n=3,fetch(a,c);case 3:if(u=e.v,clearTimeout(s),u.ok){e.n=5;break}return e.n=4,u.json().catch(function(){return{}});case 4:throw l=e.v,d=l.detail||"HTTP ".concat(u.status),this.logger.error("HTTP ".concat(u.status," error:"),l),l.detail&&"object"===T(l.detail)&&this.logger.error("Validation errors:",JSON.stringify(l.detail,null,2)),O(d,"HTTP_".concat(u.status),{status:u.status,response:l});case 5:return e.n=6,u.json();case 6:return p=e.v,this.logger.debug("Response ".concat(r,":"),p),e.a(2,p);case 7:if(e.p=7,y=e.v,this.logger.error("Request ".concat(r," failed:"),y),y instanceof A){e.n=8;break}throw g="UNKNOWN_ERROR",h="Something went wrong. Please try again.",m=null,401===(null===(f=y.details)||void 0===f?void 0:f.status)?(g="AUTH_ERROR",h="Invalid API key. Please check your credentials.",m={action:"clear_api_key"}):"AbortError"===y.name&&(g="TIMEOUT_ERROR",h="Request timed out after ".concat(this.config.timeout/1e3," seconds.")),O(h,g,m);case 8:throw y;case 9:return e.a(2)}},e,this,[[1,7]])})),function(e){return u.apply(this,arguments)})},{key:"sendChatRequest",value:(c=U(q().m(function e(t){return q().w(function(e){for(;;)if(0===e.n)return e.a(2,this.request("/api/v1/chat",{body:{site_domain:t.site_domain,user_query:t.user_query,page_query:t.page_query||null,page_url:t.page_url||null,page_context:t.page_context||{},widget_mode:t.widget_mode||null,mode:t.mode||"rag",debug:t.debug||!1,use_cache:!1!==t.use_cache}}))},e,this)})),function(e){return c.apply(this,arguments)})},{key:"sendChatMCPRequest",value:(s=U(q().m(function e(t){var n,r,i,a,o,s,c,u;return q().w(function(e){for(;;)switch(e.n){case 0:if(this.config.debug,n=(t.page_products||[]).map(function(e){var t,n;return"Product"===e["@type"]?{title:e.name,price:(null===(t=e.offers)||void 0===t?void 0:t.price)||e.price||0,brand:(null===(n=e.brand)||void 0===n?void 0:n.name)||e.brand||null,productUrl:e["@id"]||e.url||null,id:e.sku||e["@id"]||null}:{title:e.title||"Unknown",price:e.price||0,priceText:e.priceText||null,brand:e.brand||"N/A",productUrl:e.productUrl||e.url||null,id:e.id||e.url||null}}),r=null,t.available_filters)for(r={},i=0,a=Object.entries(t.available_filters);i<a.length;i++)o=I(a[i],2),s=o[0],c=o[1],Array.isArray(c)&&(r[s]=c.map(function(e){return"object"===T(e)&&e.label?e.label:String(e)}));return e.n=1,this.request("/api/v1/chat-mcp",{body:{site_domain:t.site_domain,user_query:t.user_query,page_products:n,available_tools:t.available_tools||[],available_filters:r,page_url:t.page_url||null,page_context:t.page_context||{},debug:t.debug||!1,use_cache:!1!==t.use_cache}});case 1:return u=e.v,this.config.debug,e.a(2,u)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"checkHealth",value:(o=U(q().m(function e(){return q().w(function(e){for(;;)if(0===e.n)return e.a(2,this.request("/health",{method:"GET"}))},e,this)})),function(){return o.apply(this,arguments)})},{key:"clearApiKey",value:function(){localStorage.removeItem("kaynix_api_key")}},{key:"chat",value:(a=U(q().m(function e(t,n){return q().w(function(e){for(;;)if(0===e.n)return e.a(2,this.sendChatRequest({site_domain:n.site,user_query:t,page_url:n.url,page_context:n,debug:n.debug}))},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"chatMCP",value:(i=U(q().m(function e(t,n){return q().w(function(e){for(;;)if(0===e.n)return e.a(2,this.sendChatMCPRequest({site_domain:n.site_domain,user_query:n.user_query||t,page_products:n.page_products,available_tools:n.available_tools,page_url:n.page_url,page_context:n.page_context,debug:n.debug}))},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"getStatus",value:(r=U(q().m(function e(){return q().w(function(e){for(;;)if(0===e.n)return e.a(2,this.checkHealth())},e,this)})),function(){return r.apply(this,arguments)})}],t&&H(e.prototype,t),n&&H(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,c,u,l}();function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function z(e){return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){if(e){if("string"==typeof e)return B(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function $(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return X(u,"_invoke",function(n,r,i){var a,s,c,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,o}};function f(n,r){for(s=n,c=r,t=0;!d&&u&&!i&&t<l.length;t++){var i,a=l[t],f=p.p,g=a[2];n>3?(i=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=n<2&&f<a[1])?(s=0,p.v=r,p.n=a[1]):f<g&&(i=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,p.n=g,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(p.n=-1),f(s,c)):p.n=c:p.v=c);try{if(u=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(d=p.n<0)?c:n.call(r,p))!==o)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,i,a),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(X(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,X(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,X(d,"constructor",u),X(u,"constructor",c),c.displayName="GeneratorFunction",X(u,i,"GeneratorFunction"),X(d),X(d,i,"Generator"),X(d,r,function(){return this}),X(d,"toString",function(){return"[object Generator]"}),($=function(){return{w:a,m:p}})()}function X(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}X=function(e,t,n,r){if(t)i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){X(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},X(e,t,n,r)}function V(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){V(a,r,i,o,s,"next",e)}function s(e){V(a,r,i,o,s,"throw",e)}o(void 0)})}}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach(function(t){te(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ne(r.key),r)}}function te(e,t,n){return(t=ne(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e){var t=function(e,t){if("object"!=W(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==W(t)?t:t+""}var re="2.0.0",ie=Math.random().toString(36).substring(2,9),ae=(new Date).toISOString(),oe=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Z({debug:t.debug||"8090"===window.location.port},t),this.apiClient=null,this.siteAdapter=null,this.domain=window.location.hostname.replace("www.",""),this.adapters=new Map,this.mcpServer=null,this.mcpCapabilities=null},t=[{key:"initialize",value:(C=J($().m(function e(){var t;return $().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,this.lastKnownUrl=window.location.href,this.apiClient=new F({debug:this.config.debug,apiKeyProvider:this.config.apiKeyProvider,baseUrl:this.config.apiUrl||this.config.baseUrl}),e.n=1,this.loadSiteAdapter();case 1:return this.initializeMCPServer(),e.a(2,{success:!0,domain:this.domain,hasAdapter:!!this.siteAdapter,hasApiClient:!!this.apiClient,mcpServer:!!this.mcpServer});case 2:return e.p=2,t=e.v,e.a(2,{success:!1,error:t.message})}},e,this,[[0,2]])})),function(){return C.apply(this,arguments)})},{key:"checkAndRefreshPageContext",value:(O=J($().m(function e(){var t,n;return $().w(function(e){for(;;)switch(e.n){case 0:if(t=window.location.href,n=window.location.hostname.replace("www.",""),t===this.lastKnownUrl){e.n=3;break}if(this.lastKnownUrl=t,n===this.domain){e.n=2;break}return this.domain=n,e.n=1,this.loadSiteAdapter();case 1:e.n=3;break;case 2:if(!this.siteAdapter||"function"!=typeof this.siteAdapter.refresh){e.n=3;break}return e.n=3,this.siteAdapter.refresh();case 3:return e.a(2)}},e,this)})),function(){return O.apply(this,arguments)})},{key:"loadSiteAdapter",value:(A=J($().m(function e(){var t,n,r;return $().w(function(e){for(;;)switch(e.n){case 0:if(t={localhost:function(){return Promise.all([i.e(193),i.e(282)]).then(i.bind(i,282))},"roadrunnersports.com":function(){return Promise.all([i.e(193),i.e(116)]).then(i.bind(i,735))},"rei.com":function(){return Promise.all([i.e(193),i.e(12)]).then(i.bind(i,12))},"academy.com":function(){return Promise.all([i.e(193),i.e(622)]).then(i.bind(i,622))},"lakersstore.com":function(){return Promise.all([i.e(193),i.e(461)]).then(i.bind(i,461))},"shop.warriors.com":function(){return Promise.all([i.e(193),i.e(981)]).then(i.bind(i,981))},"online-sports-shop.co.uk":function(){return Promise.all([i.e(193),i.e(617)]).then(i.bind(i,617))},"burghardtsportinggoods.com":function(){return Promise.all([i.e(193),i.e(735)]).then(i.bind(i,116))}}[this.domain]){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,e.n=2,t();case 2:return n=e.v,r=n.default,this.siteAdapter=new r({debug:this.config.debug}),this.siteAdapter.getVersion&&this.siteAdapter.getVersion(),this.siteAdapter.constructor.name,this.siteAdapter.extractProducts&&this.siteAdapter.extractProducts.toString().substring(0,100),e.a(2,!0);case 3:return e.p=3,e.v,e.a(2,!1)}},e,this,[[1,3]])})),function(){return A.apply(this,arguments)})},{key:"initializeMCPServer",value:function(){this.mcpCapabilities={tools:[{name:"process_user_input",description:"Process user input with intelligent routing to chat, search, filter, or hybrid workflows",inputSchema:{type:"object",properties:{message:{type:"string",description:"The user's message or query"},context:{type:"object",description:"Additional context (page URL, session info, etc.)",properties:{page_url:{type:"string"},session_id:{type:"string"},page_type:{type:"string"},user_intent:{type:"string"}}}},required:["message"]}},{name:"search_products",description:"Search for products on the current e-commerce site",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query for products"},options:{type:"object",description:"Search options"}},required:["query"]}},{name:"apply_filters",description:"Apply filters to current product listing",inputSchema:{type:"object",properties:{filters:{type:"object",description:"Filters to apply",properties:{gender:{type:"string",enum:["men","women","kids"]},priceMax:{type:"number"},brands:{type:"array",items:{type:"string"}},sizes:{type:"array",items:{type:"string"}},saleOnly:{type:"boolean"}}}},required:["filters"]}},{name:"extract_products",description:"Extract products from the current page",inputSchema:{type:"object",properties:{options:{type:"object",description:"Extraction options"}}}},{name:"get_page_context",description:"Get current page context and site information",inputSchema:{type:"object",properties:{}}}]},this.mcpServer={capabilities:this.mcpCapabilities,callTool:function(){var e=J($().m(function e(t,n){var r;return $().w(function(e){for(;;)switch(e.n){case 0:r=t,e.n="process_user_input"===r?1:"search_products"===r?3:"apply_filters"===r?5:"extract_products"===r?7:"get_page_context"===r?9:11;break;case 1:return e.n=2,this.processUserInput(n.message,n.context||{});case 2:case 4:case 6:case 8:case 10:return e.a(2,e.v);case 3:return e.n=4,this.handleSearchIntent(n.query,n.options||{});case 5:return e.n=6,this.handleFilterIntent(n.filters,{});case 7:return e.n=8,this.handleExtractIntent(n.options||{});case 9:return e.n=10,this.getPageContext();case 11:throw new Error("Unknown tool: ".concat(t));case 12:return e.a(2)}},e,this)}));return function(t,n){return e.apply(this,arguments)}}().bind(this),listTools:function(){return this.mcpCapabilities.tools},getServerInfo:function(){return{name:"kaynix-copilot",version:re,capabilities:this.mcpCapabilities}}}}},{key:"getPageContext",value:(S=J($().m(function e(){var t;return $().w(function(e){for(;;)if(0===e.n)return t=this.detectPageType(),e.a(2,{success:!0,type:"page_context",data:{url:window.location.href,domain:this.domain,pathname:window.location.pathname,search:window.location.search,title:document.title,pageType:t,hasAdapter:!!this.siteAdapter,adapterName:this.siteAdapter&&this.siteAdapter.constructor.name||"none",timestamp:(new Date).toISOString(),sessionId:ie}})},e,this)})),function(){return S.apply(this,arguments)})},{key:"detectPageType",value:function(){var e=window.location.pathname.toLowerCase(),t=window.location.search.toLowerCase();return e.includes("/product")||e.includes("/p/")?"product":e.includes("/search")||t.includes("q=")?"search":e.includes("/category")||e.includes("/c/")?"category":"/"===e||""===e?"home":e.includes("/cart")?"cart":"other"}},{key:"processUserInputMCP",value:(_=J($().m(function e(t){var n,r,i,a,o,s,c,u,l,d,p,f,g,h,m,y,b=this,v=arguments;return $().w(function(e){for(;;)switch(e.n){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:{},e.p=1,this.config.debug,this.apiClient){e.n=2;break}return e.a(2,{success:!1,error:"API client not initialized. Please refresh the page and try again.",type:"error"});case 2:return e.n=3,this.getPageProductsJsonLD();case 3:if(i=e.v,a=(null===(r=this.siteAdapter)||void 0===r||null===(r=r.getMCPCapabilities())||void 0===r?void 0:r.tools)||[],o=null,!this.siteAdapter||"function"!=typeof this.siteAdapter.extractAvailableFilters){e.n=7;break}return e.p=4,e.n=5,this.siteAdapter.extractAvailableFilters();case 5:o=e.v,e.n=7;break;case 6:e.p=6,e.v;case 7:return e.n=8,this.apiClient.sendChatMCPRequest({user_query:t,site_domain:this.domain,page_products:i,available_tools:a,available_filters:o,page_url:window.location.href,page_context:n});case 8:if(s=e.v,this.config.debug,c={request:{user_query:t,site_domain:this.domain,page_url:window.location.href,page_products_count:i?i.length:0,available_tools:a?a.map(function(e){return e.name}):[],available_filters_count:o?Object.keys(o).length:0},response:{success:s.success,text_response:s.text_response,tool_calls:s.tool_calls||[],timestamp:s.timestamp},page_products_sample:i?i.slice(0,3).map(function(e){var t;return{name:e.name,price:e.price||(null===(t=e.offers)||void 0===t?void 0:t.price),url:e.url}}):[],available_filters_sample:o||{}},s.text_response,this.config.debug){if("=".repeat(50),"=".repeat(50),'\n• User Query: "'.concat(c.request.user_query,'"'),"\n• Page Products: ".concat(c.request.page_products_count),c.request.available_filters_count>0&&"\n• Available Filters: ".concat(c.request.available_filters_count," types"),"\n• Success: ".concat(c.response.success),"\n• Tool Calls: ".concat(c.response.tool_calls.length),c.page_products_sample.length>0&&c.page_products_sample.forEach(function(e,t){"\n".concat(t+1,". ").concat(e.name," - ").concat(e.price||"No price")}),o&&Object.keys(o).length>0)for(u=0,l=Object.entries(o);u<l.length;u++)d=G(l[u],2),p=d[0],(f=d[1])&&f.length>0&&(g=f.slice(0,3),h=g.map(function(e){return"object"===W(e)&&e.label?e.label:String(e)}),"\n• ".concat(p," (").concat(f.length,"): ").concat(h.join(", ")),f.length>3&&" +".concat(f.length-3," more"));s.tool_calls&&s.tool_calls.length>0&&s.tool_calls.forEach(function(e,t){"\n".concat(t+1,". ").concat(e.tool,"(").concat(JSON.stringify(e.parameters),")")}),"=".repeat(50)}if(!(s.tool_calls&&s.tool_calls.length>0)){e.n=9;break}return m=s.text_response||"",m+="\n\nActions to be taken:",s.tool_calls.forEach(function(e){m+="\n⏳ ".concat(e.tool,": ").concat(b.formatToolCallDescription(e))}),e.a(2,{success:!0,type:"mcp",text_response:s.text_response,tool_calls:s.tool_calls,tool_results:null,message:m,debug:c,pendingToolCalls:!0});case 9:return e.a(2,{success:!0,type:"chat",message:s.text_response,debug:c});case 10:e.n=12;break;case 11:return e.p=11,y=e.v,e.a(2,{success:!1,error:y.message,type:"error"});case 12:return e.a(2)}},e,this,[[4,6],[1,11]])})),function(e){return _.apply(this,arguments)})},{key:"processUserInput",value:(k=J($().m(function e(t){var n,r,i,a,o=arguments;return $().w(function(e){for(;;)switch(e.n){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},e.p=1,this.config.debug,e.n=2,this.analyzeIntent(t,n);case 2:r=e.v,i=r.type,e.n="chat"===i?3:"search"===i?5:"filter"===i?7:"extract"===i?9:"cart"===i?11:"hybrid"===i?13:"help"===i?15:"status"===i?17:"debug"===i?19:"clear"===i?21:"unknown_command"===i?23:25;break;case 3:return e.n=4,this.handleChatIntent(t,n);case 4:case 6:case 8:case 10:case 12:case 14:case 16:case 18:case 20:case 22:case 24:case 26:return e.a(2,e.v);case 5:return e.n=6,this.handleSearchIntent(r.query,n);case 7:return e.n=8,this.handleFilterIntent(r.filters,n);case 9:return e.n=10,this.handleExtractIntent(n);case 11:return e.n=12,this.handleCartCommandIntent(r.subCommand,n);case 13:return e.n=14,this.handleHybridIntent(t,r,n);case 15:return e.n=16,this.handleHelpIntent();case 17:return e.n=18,this.handleStatusIntent();case 19:return e.n=20,this.handleDebugIntent(r.mode);case 21:return e.n=22,this.handleClearIntent();case 23:return e.n=24,this.handleUnknownCommandIntent(r.command);case 25:return e.n=26,this.handleChatIntent(t,n);case 27:e.n=29;break;case 28:return e.p=28,a=e.v,e.a(2,{success:!1,error:a.message,type:"error"});case 29:return e.a(2)}},e,this,[[1,28]])})),function(e){return k.apply(this,arguments)})},{key:"analyzeIntent",value:(x=J($().m(function e(t,n){var r,i,a;return $().w(function(e){for(;;)switch(e.n){case 0:if(r=t.toLowerCase().trim(),!t.startsWith("/")){e.n=1;break}return e.a(2,this.analyzeSlashCommand(t));case 1:if(!(r.includes("search for")||r.includes("find")||r.includes("show me"))){e.n=2;break}return i=t.replace(/search for|find|show me/gi,"").trim(),e.a(2,{type:"search",query:i});case 2:if(!(r.startsWith("filter ")||r.includes("filter")||r.includes("only show")||r.includes("just"))){e.n=3;break}if(a=this.extractFilters(t),!(Object.keys(a).length>0)){e.n=3;break}return e.a(2,{type:"filter",filters:a});case 3:if(!r.includes("what products")&&!r.includes("list products")){e.n=4;break}return e.a(2,{type:"extract"});case 4:if(!r.includes("add to cart")&&!r.includes("buy")){e.n=5;break}return e.a(2,{type:"cart",product:null,options:{}});case 5:if(!r.includes("which")||!r.includes("best")){e.n=6;break}return e.a(2,{type:"hybrid",subIntents:["chat","extract"]});case 6:return e.a(2,{type:"chat"})}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"extractFilters",value:function(e){var t={},n=e.toLowerCase();n.includes("women")||n.includes("womens")||n.includes("women's")?t.gender="women":n.includes("men")||n.includes("mens")||n.includes("men's")?t.gender="men":(n.includes("kid")||n.includes("child"))&&(t.gender="kids");var r=n.match(/under \$?(\d+)|below \$?(\d+)|less than \$?(\d+)|<\s*\$?(\d+)/);if(r){var i=r[1]||r[2]||r[3]||r[4];t.priceMax=parseInt(i)}var a=["nike","adidas","hoka","asics","brooks","new balance","saucony","mizuno","altra","on"].filter(function(e){return n.includes(e)});a.length>0&&(t.brands=a);var o=n.match(/size\s*(\d+\.?\d*)/);o&&(t.sizes=[o[1]]),n.includes("wide")&&!n.includes("extra wide")?t.width="wide":n.includes("extra wide")&&(t.width="extra wide"),n.includes("waterproof")&&(t.features=["waterproof"]),n.includes("trail")&&(t.features=[].concat(z(t.features||[]),["trail"])),n.includes("cushion")&&(t.features=[].concat(z(t.features||[]),["cushion"])),(n.includes("sale")||n.includes("discount"))&&(t.saleOnly=!0);var s=n.match(/(\d)\+?\s*star/);return s&&(t.minRating=parseInt(s[1])),t}},{key:"analyzeSlashCommand",value:function(e){var t=e.toLowerCase().trim();if("/search"===t||t.startsWith("/search "))return{type:"search",query:"/search"===t?"":e.substring(8).trim()};if("/filter"===t||t.startsWith("/filter ")){var n="/filter"===t?"":e.substring(8).trim();return{type:"filter",filters:n?this.extractFilters(n):{}}}return"/clear"===t?{type:"clear"}:"/extract"===t?{type:"extract"}:"/help"===t?{type:"help"}:"/status"===t?{type:"status"}:"/debug"===t||"/debug on"===t||"/debug off"===t?{type:"debug",mode:t}:"/cart"===t||t.startsWith("/cart ")?{type:"cart",subCommand:t.substring(5).trim()}:{type:"unknown_command",command:e}}},{key:"handleChatIntent",value:(w=J($().m(function e(t,n){var r;return $().w(function(e){for(;;)switch(e.n){case 0:if(this.apiClient){e.n=1;break}throw new Error("API client not initialized");case 1:return e.n=2,this.apiClient.sendChatRequest({user_query:t,site_domain:this.domain,page_url:window.location.href,page_context:n,mode:"rag"});case 2:return r=e.v,e.a(2,{success:!0,type:"chat",response:r.response,debug:r.debug})}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"handleSearchIntent",value:(v=J($().m(function e(t,n){var r;return $().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.checkAndRefreshPageContext();case 1:if(this.siteAdapter){e.n=2;break}return e.a(2,{success:!1,type:"search",error:"No adapter available for this site"});case 2:return e.n=3,this.siteAdapter.search(t);case 3:return r=e.v,e.a(2,Z({success:r.success,type:"search",data:r,message:r.success?'Searched for "'.concat(t,'". ').concat(r.message||""):"Search failed: ".concat(r.error)},r.success?{}:{error:r.error||"Search operation failed"}))}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"handleFilterIntent",value:(b=J($().m(function e(t,n){var r,i,a;return $().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.checkAndRefreshPageContext();case 1:if(this.siteAdapter){e.n=2;break}return e.a(2,{success:!1,type:"filter",error:"No adapter available for this site. Filter commands only work on supported e-commerce sites."});case 2:if(t&&0!==Object.keys(t).length){e.n=4;break}return e.n=3,this.handleShowAvailableFilters();case 3:return e.a(2,e.v);case 4:return e.n=5,this.siteAdapter.applyFilters(t);case 5:return r=e.v,i="",r.success?(a=[],t.gender&&a.push("".concat(t.gender,"'s products")),t.priceMax&&a.push("under $".concat(t.priceMax)),t.brands&&a.push("".concat(t.brands.join(", ")," brands")),t.saleOnly&&a.push("sale items"),i="Applied filters: ".concat(a.join(", "),". "),r.message&&(i+=r.message)):i="Filter failed: ".concat(r.error),e.a(2,Z({success:r.success,type:"filter",data:r,message:i},r.success?{}:{error:r.error||"Filter operation failed"}))}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"handleShowAvailableFilters",value:(y=J($().m(function e(){var t,n,r;return $().w(function(e){for(;;)switch(e.n){case 0:if(e.p=0,!this.siteAdapter.extractAvailableFilters||"function"!=typeof this.siteAdapter.extractAvailableFilters){e.n=2;break}return e.n=1,this.siteAdapter.extractAvailableFilters();case 1:return t=e.v,e.a(2,{success:!0,type:"filter",message:this.formatAvailableFilters(t),data:t});case 2:return e.n=3,this.detectPageFilters();case 3:return n=e.v,e.a(2,{success:!0,type:"filter",message:this.formatAvailableFilters(n),data:n});case 4:return e.p=4,r=e.v,e.a(2,{success:!1,type:"filter",error:"Failed to detect filters: ".concat(r.message)})}},e,this,[[0,4]])})),function(){return y.apply(this,arguments)})},{key:"formatAvailableFilters",value:function(e){if(!e||0===Object.keys(e).length)return"🔍 No filters detected on this page.\n\nTry:\n• Navigate to a category page\n• Use /extract to see products";var t="🎛️ Available filters on this page:\n\n",n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if(!e||0===e.length)return null;var n=e.map(function(e){return"object"===W(e)&&e.label?e.label:String(e)});if(n.length<=t)return n.join(", ");var r=n.slice(0,t).join(", "),i=n.length-t;return"".concat(r," (+").concat(i," more)")};e.sizes&&e.sizes.length>0&&(t+="📏 Sizes (".concat(e.sizes.length,"): ").concat(n(e.sizes),"\n")),e.colors&&e.colors.length>0&&(t+="🎨 Colors (".concat(e.colors.length,"): ").concat(n(e.colors),"\n")),e.players&&e.players.length>0&&(t+="🏀 Players (".concat(e.players.length,"): ").concat(n(e.players),"\n")),e.productTypes&&e.productTypes.length>0&&(t+="📦 Types (".concat(e.productTypes.length,"): ").concat(n(e.productTypes),"\n")),e.priceRange&&(t+="💰 Price: $".concat(e.priceRange.min," - $").concat(e.priceRange.max,"\n")),e.categories&&e.categories.length>0&&(t+="📂 Categories (".concat(e.categories.length,"): ").concat(n(e.categories),"\n")),e.brands&&e.brands.length>0&&(t+="🏷️ Brands (".concat(e.brands.length,"): ").concat(n(e.brands),"\n"));var r=["sizes","colors","players","productTypes","priceRange","categories","brands"];return Object.keys(e).forEach(function(i){!r.includes(i)&&e[i]&&Array.isArray(e[i])&&e[i].length>0&&(t+="🔹 ".concat(i," (").concat(e[i].length,"): ").concat(n(e[i]),"\n"))}),t+="\n💡 Usage examples:\n",t+="• /filter size M\n",t+="• /filter lebron james\n",t+="• /filter red under $50"}},{key:"detectPageFilters",value:(m=J($().m(function e(){var t,n,r,i,a;return $().w(function(e){for(;;)if(0===e.n){t={sizes:[],colors:[],categories:[],brands:[],priceRange:null};try{n=document.querySelectorAll('input[name*="size"], input[value="S"], input[value="M"], input[value="L"], input[value="XL"]'),r=document.querySelectorAll('input[name*="color"]'),document.querySelectorAll('input[name*="category"], input[name*="type"]'),i=new Set,n.forEach(function(e){var t,n=e.value,r=(null===(t=e.closest("label"))||void 0===t||null===(t=t.textContent)||void 0===t?void 0:t.trim())||n;r&&r.length<10&&i.add(r)}),t.sizes=Array.from(i),a=new Set,r.forEach(function(e){var t,n=e.value,r=(null===(t=e.closest("label"))||void 0===t||null===(t=t.textContent)||void 0===t?void 0:t.trim())||n;r&&r.length<20&&a.add(r)}),t.colors=Array.from(a),document.querySelectorAll('input[type="range"], input[name*="price"]').length>0&&(t.priceRange={min:0,max:500})}catch(o){}return e.a(2,t)}},e)})),function(){return m.apply(this,arguments)})},{key:"handleExtractIntent",value:(h=J($().m(function e(t){var n,r,i;return $().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.checkAndRefreshPageContext();case 1:if(this.siteAdapter){e.n=2;break}return e.a(2,{success:!1,type:"extract",error:"No adapter available for this site"});case 2:return e.p=2,e.n=3,this.siteAdapter.extractProducts();case 3:if((n=e.v).products){e.n=4;break}return e.a(2,{success:!1,type:"extract",error:"Extract failed: No products array returned from adapter"});case 4:return r='<p style="color: #4b5563; font-weight: 600;">📦 Found '.concat(n.products.length||0," products on this page:</p>"),n.products&&n.products.length>0?n.products.forEach(function(e){var t=e.title||"Unknown Product",n=e.priceText||(e.price?"$".concat(e.price):"No price"),i=e.url||"#";r+='<p><a href="'.concat(i,'" target="_blank" rel="noopener" style="color: #2563eb; text-decoration: none; hover: text-decoration: underline;">').concat(t," - ").concat(n,"</a></p>")}):r+='<p style="color: #6b7280; font-style: italic;">No products found on this page</p>',e.a(2,{success:!0,type:"extract",data:n,html:r,message:r});case 5:return e.p=5,i=e.v,this.log("Error during extraction:",i),e.a(2,{success:!1,type:"extract",error:"Extract failed: ".concat(i.message)})}},e,this,[[2,5]])})),function(e){return h.apply(this,arguments)})},{key:"handleCartIntent",value:(g=J($().m(function e(t,n,r){return $().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"cart",error:"No adapter available for this site"});case 1:return e.a(2,{success:!1,type:"cart",error:"Cart actions not yet implemented"})}},e,this)})),function(e,t,n){return g.apply(this,arguments)})},{key:"handleHybridIntent",value:(f=J($().m(function e(t,n,r){var i,a;return $().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.handleChatIntent(t,r);case 1:if(i=e.v,!this.siteAdapter){e.n=3;break}return e.n=2,this.handleExtractIntent(r);case 2:return a=e.v,e.a(2,{success:!0,type:"hybrid",chat:i,products:a,message:"Here's what I found and my recommendation"});case 3:return e.a(2,i)}},e,this)})),function(e,t,n){return f.apply(this,arguments)})},{key:"handleHelpIntent",value:(p=J($().m(function e(){return $().w(function(e){for(;;)if(0===e.n)return e.a(2,{success:!0,type:"help",message:'📚 Available Commands\n\n🔍 Shopping Actions:\n• /search [query] - Search for products\n• /filter [type] - Apply filters (women, men, price)\n• /extract - Show products on current page\n• /cart - View cart status and add items\n• /clear - Clear all filters\n\n💬 Chat Controls:\n• /help - Show this help menu\n• /status - Show system status\n• /debug - Toggle debug mode (or use /debug on/off)\n\n🛒 Cart Commands:\n• /cart - Show cart information\n• /cart add [product] - Add product to cart\n• /cart view - Open shopping cart\n\n📝 Examples:\n• /search nike running shoes\n• /filter women\n• /filter under 150\n• /cart add first\n\n💡 Tip: You can also use natural language!\nTry: "show me women\'s running shoes under $100"'})},e)})),function(){return p.apply(this,arguments)})},{key:"handleStatusIntent",value:(d=J($().m(function e(){var t;return $().w(function(e){for(;;)if(0===e.n)return t=this.getStatus(),e.a(2,{success:!0,type:"status",message:"📊 System Status:\n- Version: ".concat(t.version,"\n- Session: ").concat(t.sessionId,"\n- Loaded: ").concat(t.loadTime,"\n- Domain: ").concat(t.domain,"\n- Adapter: ").concat(t.hasAdapter?"✅":"❌"," ").concat(t.adapterName,"\n- Chat API: ").concat(t.hasApiClient?"✅":"❌","\n- MCP Server: ").concat(t.mcpServer?"✅":"❌"," (").concat(t.mcpToolCount," tools)"),data:t})},e,this)})),function(){return d.apply(this,arguments)})},{key:"handleDebugIntent",value:(l=J($().m(function e(t){var n;return $().w(function(e){for(;;)if(0===e.n)return n="/debug on"===t||"/debug"===t&&!this.config.debug,this.config.debug=n,e.a(2,{success:!0,type:"debug",message:n?"🔧 Debug mode enabled\n\nDebug commands:\n• Type normally to see input performance metrics\n• Use /commands to see command processing logs\n• Check browser console for detailed timing data\n• Performance data shows DOM queries, HTML rebuilds, event handling\n\nPerformance optimizations active:\n✅ Input change detection\n✅ DOM element caching\n✅ Smart HTML rebuilding\n✅ Event delegation\n✅ Early returns for non-slash input":"🔧 Debug mode disabled",data:{debug:n}})},e,this)})),function(e){return l.apply(this,arguments)})},{key:"handleClearIntent",value:(u=J($().m(function e(){var t;return $().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"clear",error:"No adapter available for this site. Clear filters only works on supported e-commerce sites."});case 1:return e.n=2,this.siteAdapter.applyFilters({});case 2:return t=e.v,e.a(2,{success:t.success,type:"clear",message:t.success?"All filters cleared":"Failed to clear filters: ".concat(t.error),data:t})}},e,this)})),function(){return u.apply(this,arguments)})},{key:"handleUnknownCommandIntent",value:(c=J($().m(function e(t){return $().w(function(e){for(;;)if(0===e.n)return e.a(2,{success:!1,type:"unknown_command",message:"Unknown command: ".concat(t,"\nType /help to see available commands"),error:"Unknown command: ".concat(t)})},e)})),function(e){return c.apply(this,arguments)})},{key:"handleCartCommandIntent",value:(s=J($().m(function e(t,n){var r,i,a,o,s,c,u;return $().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"cart",message:"🛒 Cart operations are not available on this site.\n\nCart commands only work on supported e-commerce sites.",error:"No adapter available"});case 1:if(null==(i=this.siteAdapter.getMCPCapabilities())||null===(r=i.tools)||void 0===r?void 0:r.some(function(e){return"add_to_cart"===e.name})){e.n=2;break}return e.a(2,{success:!1,type:"cart",message:"🛒 Cart operations are not implemented for this site yet.",error:"Cart tool not available"});case 2:if(t&&""!==t){e.n=3;break}return e.a(2,{success:!0,type:"cart",message:'🛒 Cart Commands\n\n• /cart - Show this help\n• /cart add [number] - Add product by position (1, 2, 3...)\n• /cart add first - Add first product\n• /cart add last - Add last product\n• /cart view - Open shopping cart page\n\n💡 Tips:\n- First extract products with /extract\n- Then use /cart add 1 to add the first product\n- Or use natural language: "add the Nike shoes to cart"'});case 3:if("view"!==t){e.n=4;break}return e.a(2,{success:!0,type:"cart",message:"🛒 Opening shopping cart...",action:"view_cart"});case 4:if(!t.startsWith("add ")){e.n=12;break}return a=t.substring(4).trim(),e.n=5,this.siteAdapter.extractProducts();case 5:if((o=e.v).success&&o.products&&0!==o.products.length){e.n=6;break}return e.a(2,{success:!1,type:"cart",message:"❌ No products found on this page.\n\nTry:\n1. Navigate to a product page\n2. Use /search to find products\n3. Then use /cart add",error:"No products available"});case 6:if(s=-1,c=null,"first"===a?s=0:"last"===a?s=o.products.length-1:/^\d+$/.test(a)&&(s=parseInt(a)-1),!(s>=0&&s<o.products.length)){e.n=7;break}c=o.products[s],e.n=8;break;case 7:return e.a(2,{success:!1,type:"cart",message:'❌ Invalid product reference: "'.concat(a,'"\n\nFound ').concat(o.products.length," products. Use:\n• Numbers 1-").concat(o.products.length,'\n• "first" or "last"'),error:"Invalid product reference"});case 8:return e.n=9,this.siteAdapter.callMCPTool("add_to_cart",{productId:c.productUrl||c.title,size:null,quantity:1});case 9:if(!(u=e.v).success){e.n=10;break}return e.a(2,{success:!0,type:"cart",message:"✅ ".concat(u.message,"\n\n📦 Product: ").concat(c.title,"\n💰 Price: ").concat(c.priceText||"No price"),data:{product:c,cartResult:u}});case 10:return e.a(2,{success:!1,type:"cart",message:"❌ ".concat(u.message,"\n\n📦 Product: ").concat(c.title),error:u.message,debug:u.debug});case 11:e.n=13;break;case 12:return e.a(2,{success:!1,type:"cart",message:'❌ Unknown cart command: "'.concat(t,'"\n\nTry:\n• /cart - Show cart help\n• /cart add 1 - Add first product\n• /cart view - Open cart'),error:"Unknown cart sub-command"});case 13:return e.a(2)}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getStatus",value:function(){return{initialized:!0,version:re,sessionId:ie,loadTime:ae,domain:this.domain,hasAdapter:!!this.siteAdapter,hasApiClient:!!this.apiClient,adapterName:this.siteAdapter&&this.siteAdapter.constructor.name||"none",mcpServer:!!this.mcpServer,mcpToolCount:this.mcpCapabilities&&this.mcpCapabilities.tools&&this.mcpCapabilities.tools.length||0}}},{key:"getMCPCapabilities",value:function(){return this.mcpCapabilities}},{key:"callMCPTool",value:(o=J($().m(function e(t,n){return $().w(function(e){for(;;)switch(e.n){case 0:if(this.mcpServer){e.n=1;break}throw new Error("MCP Server not initialized");case 1:return e.n=2,this.mcpServer.callTool(t,n);case 2:return e.a(2,e.v)}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getPageProductsJsonLD",value:(a=J($().m(function e(){var t,n,r,a,o;return $().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,[]);case 1:return e.p=1,e.n=2,this.siteAdapter.extractProducts();case 2:if(!(t=e.v).success||!t.products){e.n=4;break}return n=t.products,e.n=3,i.e(481).then(i.bind(i,481));case 3:return r=e.v,a=r.ProductJsonLD,o=n.map(function(e){return new a(Z(Z({},e),{},{productUrl:e.url||e.link,priceText:e.priceText||(e.price?"$".concat(e.price):"0")}))}),e.a(2,o);case 4:return e.a(2,[]);case 5:return e.p=5,e.v,e.a(2,[])}},e,this,[[1,5]])})),function(){return a.apply(this,arguments)})},{key:"executeMCPToolCalls",value:(r=J($().m(function e(t){var n,r,i,a,o,s,c;return $().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}throw new Error("No adapter available for MCP tool execution");case 1:n=[],r=R(t),e.p=2,r.s();case 3:if((i=r.n()).done){e.n=8;break}return a=i.value,e.p=4,e.n=5,this.siteAdapter.callMCPTool(a.tool,a.parameters);case 5:o=e.v,n.push({tool:a.tool,parameters:a.parameters,result:o,success:o.success}),e.n=7;break;case 6:e.p=6,s=e.v,n.push({tool:a.tool,parameters:a.parameters,result:{success:!1,message:s.message},success:!1});case 7:e.n=3;break;case 8:e.n=10;break;case 9:e.p=9,c=e.v,r.e(c);case 10:return e.p=10,r.f(),e.f(10);case 11:return e.a(2,n)}},e,this,[[4,6],[2,9,10,11]])})),function(e){return r.apply(this,arguments)})},{key:"formatMCPResponse",value:function(e,t){var n=e.text_response||"";return t&&t.length>0&&(n+="\n\nActions taken:",t.forEach(function(e){var t=e.success?"✅":"❌";n+="\n".concat(t," ").concat(e.tool,": ").concat(e.result.message)})),n}},{key:"formatToolCallDescription",value:function(e){switch(e.tool){case"apply_filters":var t=e.parameters.filters||{},n=[];return t.sizes&&n.push("size ".concat(t.sizes.join(", "))),t.widths&&n.push("".concat(t.widths.join(", "))),t.categories&&n.push("".concat(t.categories.join(", "))),t.brands&&n.push("".concat(t.brands.join(", "))),t.colors&&n.push("".concat(t.colors.join(", "))),t.priceRanges&&n.push("price ".concat(t.priceRanges.join(", "))),n.length>0?"Apply filters: ".concat(n.join(", ")):"Clear filters";case"search_products":return'Search for "'.concat(e.parameters.query,'"');default:return JSON.stringify(e.parameters)}}}],t&&ee(e.prototype,t),n&&ee(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,a,o,s,c,u,l,d,p,f,g,h,m,y,b,v,w,x,k,_,S,A,O,C}();te(oe,"COPILOT_VERSION",re),te(oe,"SESSION_ID",ie),te(oe,"LOAD_TIME",ae);function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ue(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function le(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return de(u,"_invoke",function(n,r,i){var a,s,c,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,o}};function f(n,r){for(s=n,c=r,t=0;!d&&u&&!i&&t<l.length;t++){var i,a=l[t],f=p.p,g=a[2];n>3?(i=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=n<2&&f<a[1])?(s=0,p.v=r,p.n=a[1]):f<g&&(i=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,p.n=g,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(p.n=-1),f(s,c)):p.n=c:p.v=c);try{if(u=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(d=p.n<0)?c:n.call(r,p))!==o)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,i,a),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(de(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,de(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,de(d,"constructor",u),de(u,"constructor",c),c.displayName="GeneratorFunction",de(u,i,"GeneratorFunction"),de(d),de(d,i,"Generator"),de(d,r,function(){return this}),de(d,"toString",function(){return"[object Generator]"}),(le=function(){return{w:a,m:p}})()}function de(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}de=function(e,t,n,r){if(t)i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){de(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},de(e,t,n,r)}function pe(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function fe(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){pe(a,r,i,o,s,"next",e)}function s(e){pe(a,r,i,o,s,"throw",e)}o(void 0)})}}function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach(function(t){me(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function me(e,t,n){return(t=be(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,be(r.key),r)}}function be(e){var t=function(e,t){if("object"!=se(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==se(t)?t:t+""}!function(){var e="4.0.1",t=Math.random().toString(36).substring(2,9),n=(new Date).toISOString(),r=Math.random().toString(36).substring(2,9),i=document.currentScript?document.currentScript.src:"",a=document.currentScript?document.currentScript.getAttribute("data-api-key"):null;function o(){if(!document.getElementById("kaynix-widget-styles")){var e=document.createElement("style");e.id="kaynix-widget-styles",e.textContent="\n            .kaynix-widget-container {\n                all: initial;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                width: 400px;\n                max-width: calc(100vw - 40px);\n                height: 500px;\n                background: white;\n                border: 1px solid #e1e5e9;\n                border-radius: 12px;\n                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\n                display: flex;\n                flex-direction: column;\n                z-index: 10000;\n            }\n\n            .kaynix-widget-header {\n                padding: 16px 20px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                border-radius: 12px 12px 0 0;\n            }\n\n            .kaynix-widget-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                font-size: 16px;\n            }\n\n            .kaynix-widget-close {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 24px;\n                cursor: pointer;\n                padding: 0;\n                width: 30px;\n                height: 30px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .kaynix-widget-close:hover {\n                opacity: 0.8;\n            }\n\n            .kaynix-widget-body {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n\n            .kaynix-widget-messages {\n                flex: 1;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 20px;\n                /* Prevent scroll events from bubbling up to the main page */\n                overscroll-behavior-y: contain;\n                /* Ensure scrolling works properly on touch devices */\n                -webkit-overflow-scrolling: touch;\n                scrollbar-width: thin;\n                position: relative;\n                z-index: 1;\n            }\n\n            .kaynix-widget-messages::-webkit-scrollbar {\n                width: 6px;\n            }\n\n            .kaynix-widget-messages::-webkit-scrollbar-track {\n                background: #f1f1f1;\n                border-radius: 3px;\n            }\n\n            .kaynix-widget-messages::-webkit-scrollbar-thumb {\n                background: #c1c1c1;\n                border-radius: 3px;\n            }\n\n            .kaynix-widget-messages::-webkit-scrollbar-thumb:hover {\n                background: #a8a8a8;\n            }\n\n            .kaynix-message {\n                margin-bottom: 16px;\n            }\n\n            .kaynix-message-user {\n                text-align: right;\n            }\n\n            .kaynix-message-user-command {\n                text-align: right;\n            }\n\n            .kaynix-message-user .kaynix-message-content {\n                background: #667eea;\n                color: white;\n                display: inline-block;\n                padding: 10px 14px;\n                border-radius: 18px 18px 4px 18px;\n                max-width: 80%;\n                text-align: left;\n            }\n\n            .kaynix-message-user-command .kaynix-message-content {\n                background: #667eea;\n                color: white;\n                display: inline-block;\n                padding: 8px 12px;\n                border-radius: 8px;\n                max-width: fit-content;\n                text-align: left;\n                font-family: 'Courier New', Courier, monospace;\n                font-size: 13px;\n                border: 1px solid #5a67d8;\n            }\n\n            .kaynix-message-assistant .kaynix-message-content {\n                background: #f3f4f6;\n                color: #1f2937;\n                display: inline-block;\n                padding: 10px 14px;\n                border-radius: 18px 18px 18px 4px;\n                max-width: 80%;\n            }\n\n            .kaynix-message-content strong {\n                font-weight: 600;\n                color: #111827;\n            }\n\n            .kaynix-message-content ul,\n            .kaynix-message-content ol {\n                margin: 8px 0;\n                padding-left: 20px;\n            }\n\n            .kaynix-message-content li {\n                margin: 4px 0;\n            }\n\n            .kaynix-message-content br {\n                display: block;\n                content: \"\";\n                margin: 4px 0;\n            }\n\n            .kaynix-message-command .kaynix-message-content {\n                background: #1e293b;\n                color: #e2e8f0;\n                display: block;\n                padding: 12px 16px;\n                border-radius: 8px;\n                max-width: 100%;\n                font-family: 'Courier New', Courier, monospace;\n                font-size: 13px;\n                line-height: 1.5;\n                white-space: pre-wrap;\n                border: 1px solid #334155;\n            }\n\n            .kaynix-message-command .kaynix-message-content a {\n                color: #e2e8f0;\n                text-decoration: none;\n            }\n\n            .kaynix-message-command .kaynix-message-content a:hover {\n                color: #e2e8f0;\n                text-decoration: underline;\n            }\n\n            .kaynix-widget-input-container {\n                padding: 16px 20px;\n                border-top: 1px solid #e5e7eb;\n                display: flex;\n                gap: 8px;\n                position: relative;\n                z-index: 10000; /* Base z-index for input container */\n            }\n\n            .kaynix-widget-input {\n                flex: 1;\n                padding: 10px 14px;\n                border: 1px solid #d1d5db;\n                border-radius: 20px;\n                font-size: 14px;\n                outline: none;\n            }\n\n            .kaynix-widget-input:focus {\n                border-color: #667eea;\n            }\n\n            .kaynix-widget-submit {\n                padding: 10px 20px;\n                background: #667eea;\n                color: white;\n                border: none;\n                border-radius: 20px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n            }\n\n            .kaynix-widget-submit:hover:not(:disabled) {\n                background: #5a67d8;\n            }\n\n            .kaynix-widget-submit:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n\n            .kaynix-widget-loading {\n                padding: 20px;\n                text-align: center;\n                color: #6b7280;\n            }\n\n            .kaynix-widget-trigger {\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                width: 60px;\n                height: 60px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                border-radius: 50%;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-size: 28px;\n                z-index: 9999;\n            }\n\n            .kaynix-widget-trigger:hover {\n                transform: scale(1.1);\n            }\n\n            /* Product extraction bubble styles */\n            .kaynix-products-bubble {\n                width: 100%;\n                background: #f9fafb;\n                border-radius: 12px;\n                padding: 16px;\n                margin: 8px 0;\n            }\n\n            .kaynix-products-header {\n                font-weight: 600;\n                color: #1f2937;\n                margin-bottom: 12px;\n                font-size: 15px;\n            }\n\n            .kaynix-products-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .kaynix-product-item {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                padding: 12px;\n                background: white;\n                border: 1px solid #e5e7eb;\n                border-radius: 8px;\n                text-decoration: none;\n                color: inherit;\n                transition: all 0.2s ease;\n                min-height: 50px;\n                gap: 12px;\n            }\n\n            .kaynix-product-item:hover {\n                background: #f3f4f6;\n                border-color: #d1d5db;\n                transform: translateX(4px);\n            }\n\n            .kaynix-product-title {\n                flex: 1;\n                font-size: 14px;\n                color: #1f2937 !important;\n                font-weight: 500;\n                margin-right: 12px;\n                line-height: 1.4;\n                word-wrap: break-word;\n                overflow: visible;\n                min-height: 20px;\n                display: block;\n                visibility: visible;\n                opacity: 1;\n            }\n\n            .kaynix-product-price {\n                font-size: 14px;\n                color: #059669;\n                font-weight: 600;\n                white-space: nowrap;\n            }\n\n            .kaynix-products-empty {\n                text-align: center;\n                color: #6b7280;\n                padding: 20px;\n                font-style: italic;\n            }\n\n            .kaynix-command-suggestions {\n                position: absolute;\n                bottom: 100%;\n                left: 0;\n                right: 0;\n                background: white;\n                border: 1px solid #e5e7eb;\n                border-radius: 8px;\n                margin-bottom: 8px;\n                box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);\n                max-height: 200px;\n                overflow-y: auto;\n                display: none;\n                z-index: 10001; /* Higher than widget container */\n                /* Prevent interference with scrolling */\n                pointer-events: auto;\n            }\n\n            .kaynix-command-suggestions.show {\n                display: block;\n                /* Ensure suggestions don't block scrolling */\n                pointer-events: auto;\n            }\n\n            .kaynix-command-suggestion {\n                padding: 12px 16px;\n                cursor: pointer;\n                border-bottom: 1px solid #f3f4f6;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n\n            .kaynix-command-suggestion:last-child {\n                border-bottom: none;\n            }\n\n            .kaynix-command-suggestion:hover,\n            .kaynix-command-suggestion.selected {\n                background: #f3f4f6;\n            }\n\n            .kaynix-command-name {\n                font-weight: 500;\n                color: #667eea;\n            }\n\n            .kaynix-command-desc {\n                font-size: 12px;\n                color: #6b7280;\n            }\n\n            /* Filter bubble/badge styling */\n            .kaynix-filter-bubble {\n                display: inline-block;\n                background: #667eea;\n                color: white;\n                padding: 4px 12px;\n                border-radius: 16px;\n                font-size: 12px;\n                font-weight: 500;\n                margin: 2px 4px 2px 0;\n                position: relative;\n                z-index: 1;\n                white-space: nowrap;\n            }\n\n            /* Ensure proper spacing between filter indicators and messages */\n            .kaynix-message-with-filter {\n                margin-top: 12px;\n                margin-bottom: 20px;\n            }\n\n            .kaynix-message-with-filter .kaynix-message-content {\n                padding-top: 4px;\n                line-height: 1.6;\n            }\n\n            /* Fix z-index layering issues */\n            .kaynix-widget-messages {\n                position: relative;\n                z-index: 1;\n            }\n\n            .kaynix-message {\n                position: relative;\n                z-index: 2;\n                clear: both;\n            }\n\n            /* Prevent filter bubbles from overlapping with subsequent messages */\n            .kaynix-message + .kaynix-message {\n                margin-top: 16px;\n            }\n\n            /* Debug and system messages should not overlap suggestions */\n            .kaynix-message-command {\n                position: relative;\n                z-index: 1; /* Lower than suggestions */\n            }\n\n            /* Debug info styling */\n            .kaynix-message.debug .kaynix-message-content {\n                background: #f0f9ff;\n                border: 1px solid #bae6fd;\n                font-family: 'Monaco', 'Menlo', 'Consolas', monospace;\n                font-size: 12px;\n                line-height: 1.5;\n            }\n\n            .kaynix-debug-info {\n                color: #0f172a;\n            }\n\n            .kaynix-debug-info strong {\n                color: #0369a1;\n                display: block;\n                margin-top: 8px;\n                margin-bottom: 4px;\n            }\n\n            .kaynix-debug-info .debug-section {\n                margin-left: 12px;\n                color: #475569;\n            }\n\n            .kaynix-debug-info .debug-value {\n                color: #0f172a;\n                font-weight: 600;\n                background: rgba(255, 255, 255, 0.5);\n                padding: 0 4px;\n                border-radius: 3px;\n            }\n\n            /* Intent-specific message styling */\n            .kaynix-message.intent-exploring .kaynix-message-content::before,\n            .kaynix-message.intent-search .kaynix-message-content::before {\n                content: '🔍 ';\n                font-size: 16px;\n            }\n\n            .kaynix-message.intent-compare_decide .kaynix-message-content::before {\n                content: '⚖️ ';\n                font-size: 16px;\n            }\n\n            .kaynix-message.intent-filter .kaynix-message-content::before {\n                content: '🎯 ';\n                font-size: 16px;\n            }\n\n            .kaynix-message.intent-cart .kaynix-message-content::before,\n            .kaynix-message.intent-purchasing .kaynix-message-content::before {\n                content: '🛒 ';\n                font-size: 16px;\n            }\n\n            .kaynix-message.intent-research_qa .kaynix-message-content::before {\n                content: 'ℹ️ ';\n                font-size: 16px;\n            }\n\n            @keyframes slideDown {\n                from {\n                    transform: translateX(-50%) translateY(-20px);\n                    opacity: 0;\n                }\n                to {\n                    transform: translateX(-50%) translateY(0);\n                    opacity: 1;\n                }\n            }\n\n            @keyframes slideUp {\n                from {\n                    transform: translateX(-50%) translateY(0);\n                    opacity: 1;\n                }\n                to {\n                    transform: translateX(-50%) translateY(-20px);\n                    opacity: 0;\n                }\n            }\n        ",document.head.appendChild(e)}}var s=function(){return s=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=he({position:t.position||"bottom-right",autoShow:!1!==t.autoShow,debug:t.debug||!1},t),this.container=null,this.trigger=null,this.messagesEl=null,this.copilot=null,this.visible=!1,this.sessionId=this.getOrCreateSessionId(),this.selectedSuggestionIndex=-1,this.elements={},this.boundHandlers={},this.lastSuggestionInput="",this.lastMatchesKey="",this.inputEventCount=0,this.suggestionDebounceTimer=null,this.commands=[{command:"/help",description:"Show available commands"},{command:"/search",description:"Search for products",example:"/search nike shoes"},{command:"/filter",description:"Apply filters",example:"/filter women"},{command:"/extract",description:"Show products on page"},{command:"/cart",description:"Cart operations",example:"/cart add 1"},{command:"/cart add",description:"Add product to cart",example:"/cart add first"},{command:"/cart view",description:"Open shopping cart"},{command:"/clear",description:"Clear all filters"},{command:"/status",description:"Show system status"},{command:"/debug",description:"Toggle debug mode"},{command:"/debug on",description:"Enable debug mode"},{command:"/debug off",description:"Disable debug mode"},{command:"/reset",description:"Clear conversation"},{command:"/reload",description:"Force reload widget (clears cache)"}]},c=[{key:"getOrCreateSessionId",value:function(){var e=sessionStorage.getItem("kaynix_session_id");return e||(e="session_"+Date.now()+"_"+Math.random().toString(36).substring(2,9),sessionStorage.setItem("kaynix_session_id",e)),e}},{key:"saveSessionState",value:function(){var e={visible:this.visible,conversationHistory:this.getConversationHistory(),timestamp:(new Date).toISOString(),pageUrl:window.location.href};sessionStorage.setItem("kaynix_session_".concat(this.sessionId),JSON.stringify(e))}},{key:"restoreSessionState",value:function(){try{var e=sessionStorage.getItem("kaynix_session_".concat(this.sessionId));if(!e)return!1;var t=JSON.parse(e);if(this.sessionRestored)return!0;var n=Date.now()-new Date(t.timestamp).getTime();return n>36e5?(sessionStorage.removeItem("kaynix_session_".concat(this.sessionId)),!1):(this.sessionRestored=!0,t.conversationHistory&&t.conversationHistory.length>0&&(this.restoreConversationHistory(t.conversationHistory),this.addMessage("📍 Session restored from ".concat(this.formatTimeAgo(t.timestamp)),"system"),t.pageUrl!==window.location.href&&this.addMessage("🔗 Previous page: ".concat(t.pageUrl),"system")),t.visible&&this.show(),!0)}catch(r){return!1}}},{key:"getConversationHistory",value:function(){if(!this.messagesEl)return[];var e=[];return this.messagesEl.querySelectorAll(".kaynix-message").forEach(function(t){if("true"!==t.dataset.system){var n="assistant";t.classList.contains("user")||t.classList.contains("user-command")?n="user":(t.classList.contains("assistant")||t.classList.contains("command"))&&(n="assistant");var r=t.querySelector(".kaynix-message-content");r&&e.push({role:n,content:r.textContent||r.innerText,timestamp:t.dataset.timestamp||(new Date).toISOString()})}}),e}},{key:"restoreConversationHistory",value:function(e){var t=this;this.messagesEl&&e&&0!==e.length&&(this.messagesEl.querySelectorAll(".kaynix-message:not([data-system])").forEach(function(e){return e.remove()}),e.forEach(function(e){e.role&&e.content&&t.addMessage(e.content,e.role,e.timestamp)}))}},{key:"formatTimeAgo",value:function(e){var t=new Date,n=new Date(e),r=t-n,i=Math.floor(r/6e4);if(i<1)return"just now";if(i<60)return"".concat(i,"m ago");var a=Math.floor(i/60);return a<24?"".concat(a,"h ago"):n.toLocaleDateString()}},{key:"init",value:(y=fe(le().m(function e(){var t;return le().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,window.__webpack_dev_server_client__&&(window.__webpack_dev_server_client__.overlay=!1),this.config.debug||localStorage.getItem("kaynix_debug"),o(),this.createUI(),e.n=1,this.initializeCopilot();case 1:return this.setupEventListeners(),t=this.restoreSessionState(),this.config.autoShow&&!t&&this.show(),e.a(2,!0);case 2:return e.p=2,"NO_API_KEY"===e.v.code&&this.addMessage("❌ API key not set. Please set it on the landing page.","assistant"),e.a(2,!1)}},e,this,[[0,2]])})),function(){return y.apply(this,arguments)})},{key:"initializeCopilot",value:(m=fe(le().m(function e(){var t,n=this;return le().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,this.copilot=new oe({debug:this.config.debug||"true"===localStorage.getItem("kaynix_debug"),apiKeyProvider:function(){return n.getApiKey()},apiUrl:this.config.apiUrl||this.config.baseUrl}),e.n=1,this.copilot.initialize();case 1:(t=e.v).success&&(t.hasAdapter,window.kaynixCopilot=this.copilot),e.n=3;break;case 2:e.p=2,e.v,this.copilot=null,setTimeout(function(){n.messagesEl&&n.addMessage("⚠️ Failed to load AI assistant. Please refresh the page and try again.","assistant")},1e3);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return m.apply(this,arguments)})},{key:"createUI",value:function(){var e=this;this.trigger=document.createElement("div"),this.trigger.className="kaynix-widget-trigger",this.trigger.innerHTML="💬",this.trigger.onclick=function(){return e.toggle()},document.body.appendChild(this.trigger),this.container=document.createElement("div"),this.container.className="kaynix-widget-container",this.container.style.display="none",this.container.innerHTML='\n                <div class="kaynix-widget-header">\n                    <div class="kaynix-widget-title">\n                        <span>🤖</span>\n                        <span>Kaynix Assistant</span>\n                    </div>\n                    <button class="kaynix-widget-close" type="button">&times;</button>\n                </div>\n                <div class="kaynix-widget-body">\n                    <div class="kaynix-widget-messages"></div>\n                    <div class="kaynix-widget-input-container">\n                        <input type="text" class="kaynix-widget-input" placeholder="Ask me anything..." />\n                        <button type="submit" class="kaynix-widget-submit" disabled>Send</button>\n                        <div class="kaynix-command-suggestions"></div>\n                    </div>\n                </div>\n            ',document.body.appendChild(this.container),this.messagesEl=this.container.querySelector(".kaynix-widget-messages")}},{key:"setupEventListeners",value:function(){var e=this,t=this.container.querySelector(".kaynix-widget-input"),n=this.container.querySelector(".kaynix-widget-submit"),r=this.container.querySelector(".kaynix-widget-close"),i=this.container.querySelector(".kaynix-command-suggestions");this.elements={input:t,submit:n,close:r,suggestionsEl:i},this.boundHandlers.close=function(t){t.preventDefault(),t.stopPropagation(),e.config.debug,e.hide()},r.addEventListener("click",this.boundHandlers.close),this.boundHandlers.closeTouch=function(t){t.preventDefault(),t.stopPropagation(),e.config.debug,e.hide()},r.addEventListener("touchend",this.boundHandlers.closeTouch),this.boundHandlers.input=function(t){var r=t.target.value;n.disabled=!r.trim(),e.suggestionDebounceTimer&&clearTimeout(e.suggestionDebounceTimer),e.suggestionDebounceTimer=setTimeout(function(){r.startsWith("/")?e.showCommandSuggestions(r):e.hideCommandSuggestions()},200)},this.boundHandlers.keydown=function(t){if("Enter"===t.key&&!n.disabled)return t.preventDefault(),e.hideCommandSuggestions(),void e.handleSubmit();if(t.ctrlKey&&"d"===t.key){t.preventDefault();var r=!("true"===localStorage.getItem("kaynix_debug"));return localStorage.setItem("kaynix_debug",r?"true":"false"),e.config.debug=r,e.copilot&&(e.copilot.config.debug=r),void e.addMessage("🔧 Debug mode ".concat(r?"enabled":"disabled"," (Ctrl+D to toggle)"),"system")}if("Escape"!==t.key){if(e.elements.suggestionsEl&&e.elements.suggestionsEl.classList.contains("show")){var i=e.elements.suggestionsEl.querySelectorAll(".kaynix-command-suggestion");i.length>0&&("ArrowDown"===t.key?(t.preventDefault(),e.selectedSuggestionIndex=Math.min(e.selectedSuggestionIndex+1,i.length-1),e.updateSelectedSuggestion()):"ArrowUp"===t.key?(t.preventDefault(),e.selectedSuggestionIndex=Math.max(e.selectedSuggestionIndex-1,-1),e.updateSelectedSuggestion()):"Tab"===t.key&&e.selectedSuggestionIndex>=0&&(t.preventDefault(),i[e.selectedSuggestionIndex].click()))}}else e.hideCommandSuggestions()},this.boundHandlers.documentClick=function(t){e.container.contains(t.target)||e.hideCommandSuggestions()},t.addEventListener("input",this.boundHandlers.input),t.addEventListener("keydown",this.boundHandlers.keydown),document.addEventListener("click",this.boundHandlers.documentClick),n.onclick=function(){return e.handleSubmit()}}},{key:"showCommandSuggestions",value:function(e){this.elements.suggestionsEl||(this.elements.suggestionsEl=this.container.querySelector(".kaynix-command-suggestions"));var t=this.elements.suggestionsEl,n=e.toLowerCase(),r=this.commands.filter(function(e){return e.command.toLowerCase().startsWith(n)&&e.command!==n});if(0!==r.length){var i=r.map(function(e){return e.command}).join(",");if(this.lastMatchesKey!==i){this.lastMatchesKey=i;var a=r.map(function(e,t){return'\n                    <div class="kaynix-command-suggestion" data-command="'.concat(e.command,'" data-index="').concat(t,'">\n                        <span class="kaynix-command-name">').concat(e.command,'</span>\n                        <span class="kaynix-command-desc">').concat(e.description,"</span>\n                    </div>\n                ")}).join("");t.innerHTML=a,this.setupSuggestionEventDelegation()}t.classList.add("show"),this.selectedSuggestionIndex=-1}else this.hideCommandSuggestions()}},{key:"setupSuggestionEventDelegation",value:function(){var e=this;this.suggestionClickHandler||(this.suggestionClickHandler=function(t){var n=t.target.closest(".kaynix-command-suggestion");if(n){var r=n.getAttribute("data-command");e.elements.input||(e.elements.input=e.container.querySelector(".kaynix-widget-input")),e.elements.input.value=r+" ",e.elements.input.focus(),e.hideCommandSuggestions()}},this.elements.suggestionsEl.addEventListener("click",this.suggestionClickHandler))}},{key:"showDebugInfo",value:function(e){var t=this.container.querySelector(".kaynix-widget-messages"),n='<div style="font-family: monospace; font-size: 12px;">';if(n+="<strong>📊 DEBUG INFORMATION</strong><br><br>",n+="<strong>📤 Request:</strong><br>",n+='• User Query: "'.concat(e.request.user_query,'"<br>'),n+="• Page Products: ".concat(e.request.page_products_count,"<br>"),e.request.available_filters_count&&e.request.available_filters_count>0&&(n+="• Available Filters: ".concat(e.request.available_filters_count," types<br>")),n+="<br>",n+="<strong>📥 Response:</strong><br>",n+="• Success: ".concat(e.response.success,"<br>"),e.response.tool_calls&&e.response.tool_calls.length>0){n+="• Tool Calls: ".concat(e.response.tool_calls.length," - ");var r=e.response.tool_calls.map(function(e){return e.tool}).join(", ");n+="<strong>".concat(r,"</strong><br><br>")}else n+="• Tool Calls: 0<br><br>";if(e.page_products_sample&&e.page_products_sample.length>0&&(n+="<strong>📦 Sample Products:</strong><br>",e.page_products_sample.forEach(function(e,t){n+="".concat(t+1,". ").concat(e.name," - ").concat(e.price||"No price","<br>")}),n+="<br>"),e.available_filters_sample&&Object.keys(e.available_filters_sample).length>0){n+="<strong>🎯 Sample Filters:</strong><br>";for(var i=0,a=Object.entries(e.available_filters_sample);i<a.length;i++){var o=ce(a[i],2),s=o[0],c=o[1];if(c&&c.length>0){var u=c.slice(0,3).map(function(e){return"object"===se(e)&&e.label?e.label:String(e)});n+="• ".concat(s," (").concat(c.length,"): ").concat(u.join(", ")),c.length>3&&(n+=" +".concat(c.length-3," more")),n+="<br>"}}n+="<br>"}e.response.tool_calls&&e.response.tool_calls.length>0&&(n+="<strong>🔧 Tool Calls:</strong><br>",e.response.tool_calls.forEach(function(e,t){n+="".concat(t+1,". ").concat(e.tool,"(").concat(JSON.stringify(e.parameters),")<br>")})),e.tool_results&&e.tool_results.length>0&&(n+="<br><strong>🔧 Tool Results:</strong><br>",e.tool_results.forEach(function(e,t){var r=e.success?"✅":"❌";n+="".concat(t+1,". ").concat(r," ").concat(e.tool,": ").concat(e.result&&e.result.message?e.result.message:"No message available","<br>")})),e.query_analysis&&(n+="<br><strong>🧠 Query Analysis:</strong><br>",e.query_analysis.user_intent&&(n+="• Intent: ".concat(e.query_analysis.user_intent,"<br>")),void 0!==e.query_analysis.intent_confidence&&(n+="• Confidence: ".concat((100*e.query_analysis.intent_confidence).toFixed(0),"%<br>")),e.query_analysis.page_type&&(n+="• Page Type: ".concat(e.query_analysis.page_type,"<br>")),e.query_analysis.page_query&&(n+='• Page Query: "'.concat(e.query_analysis.page_query,'"<br>'))),n+="</div>";var l=document.createElement("div");l.className="kaynix-message kaynix-message-debug",l.innerHTML='\n                <div class="kaynix-message-content" style="background: #f0f0f0; border-left: 3px solid #666; color: #333;">\n                    '.concat(n,"\n                </div>\n            "),t.appendChild(l),t.scrollTop=t.scrollHeight}},{key:"hideCommandSuggestions",value:function(){this.elements.suggestionsEl||(this.elements.suggestionsEl=this.container.querySelector(".kaynix-command-suggestions")),this.elements.suggestionsEl.classList.remove("show"),this.selectedSuggestionIndex=-1,this.lastMatchesKey=""}},{key:"updateSelectedSuggestion",value:function(){var e=this;this.elements.suggestionsEl&&this.elements.suggestionsEl.querySelectorAll(".kaynix-command-suggestion").forEach(function(t,n){n===e.selectedSuggestionIndex?t.classList.add("selected"):t.classList.remove("selected")})}},{key:"handleSubmit",value:(h=fe(le().m(function e(){var t,n,r,i=this;return le().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getApiKey();case 1:if(e.v){e.n=2;break}return this.addMessage("❌ API key not set for ".concat(window.location.hostname,". Click the widget button to set it."),"assistant"),setTimeout(fe(le().m(function e(){return le().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i.promptForApiKey();case 1:e.v&&i.addMessage("✅ API key saved! You can now use the widget.","assistant");case 2:return e.a(2)}},e)})),100),e.a(2);case 2:if(t=this.container.querySelector(".kaynix-widget-input"),n=t.value.trim()){e.n=3;break}return e.a(2);case 3:return t.value="",this.container.querySelector(".kaynix-widget-submit").disabled=!0,r=n.startsWith("/")?"user-command":"user",this.addMessage(n,r),e.n=4,this.processMessage(n);case 4:return e.a(2)}},e,this)})),function(){return h.apply(this,arguments)})},{key:"processMessage",value:(g=fe(le().m(function e(t){var n,r,i,a,o,s,c,u,l=this;return le().w(function(e){for(;;)switch(e.n){case 0:if(!t.startsWith("/")){e.n=2;break}return e.n=1,this.handleSlashCommand(t);case 1:return e.a(2);case 2:if(this.copilot){e.n=3;break}return this.addMessage("⚠️ AI assistant not loaded. Please refresh the page and try again.","assistant"),e.a(2);case 3:return e.p=3,e.n=4,this.getApiKey();case 4:if(e.v){e.n=5;break}return this.addMessage("❌ API key is required. Please refresh the page and enter your API key when prompted.","assistant"),e.a(2);case 5:e.n=7;break;case 6:return e.p=6,e.v,this.addMessage("❌ Failed to get API key. Please refresh the page and try again.","assistant"),e.a(2);case 7:if(n=this.showLoading(),e.p=8,r=[],!this.copilot.siteAdapter){e.n=12;break}return e.p=9,e.n=10,this.copilot.siteAdapter.extractProducts();case 10:(i=e.v).success&&i.products&&(r=i.products),e.n=12;break;case 11:e.p=11,e.v;case 12:return e.n=13,this.copilot.processUserInputMCP(t,{products:r,page_url:window.location.href,session_id:this.getSessionId()});case 13:a=e.v,this.removeLoading(n),a.success?(o="","debug"===a.type&&a.message?(s="=".repeat(50),c=a.message.split(s),o=c[0].trim()):o="chat"===a.type?null!==(u=a.response)&&void 0!==u&&u.text?a.response.text:"string"==typeof a.response?a.response:a.message||"Action completed":a.message?a.message:a.response?"string"==typeof a.response?a.response:a.response.text||"Action completed":"Action completed",this.addMessage(o,"assistant"),(this.config.debug||"true"===localStorage.getItem("kaynix_debug")||this.copilot&&this.copilot.config.debug)&&a.debug&&this.showDebugInfo(a.debug),a.pendingToolCalls&&a.tool_calls&&a.tool_calls.length>0&&(this.saveSessionState(),setTimeout(fe(le().m(function e(){var t,n;return le().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,l.copilot.executeMCPToolCalls(a.tool_calls);case 1:(t=e.v)&&t.length>0&&(n="Actions completed:",t.forEach(function(e){var t=e.success?"✅":"❌";n+="\n".concat(t," ").concat(e.tool,": ").concat(e.result.message)}),l.addMessage(n,"system")),e.n=3;break;case 2:e.p=2,e.v,l.addMessage("⚠️ Failed to apply filters. Please try again.","system");case 3:return e.a(2)}},e,null,[[0,2]])})),500))):this.addMessage("Error: ".concat(a.error),"assistant"),e.n=15;break;case 14:e.p=14,e.v,this.removeLoading(n),this.addMessage("Something went wrong. Please try again.","assistant");case 15:return e.a(2)}},e,this,[[9,11],[8,14],[3,6]])})),function(e){return g.apply(this,arguments)})},{key:"delegateToCopilot",value:(f=fe(le().m(function e(t){var n,r,i,a;return le().w(function(e){for(;;)switch(e.n){case 0:if(this.copilot){e.n=1;break}return this.addMessage("⚠️ AI assistant not loaded. Please refresh the page and try again.","command"),e.a(2);case 1:return n=this.showLoading(),e.p=2,e.n=3,this.copilot.processUserInput(t,{page_url:window.location.href,session_id:this.getSessionId()});case 3:r=e.v,this.removeLoading(n),r.success?(a="",a="string"==typeof r.response?r.response:null!==(i=r.response)&&void 0!==i&&i.text?r.response.text:r.message?r.message:"Command completed",this.addMessage(a,"command"),"debug"===r.type&&r.data&&void 0!==r.data.debug&&(this.config.debug=r.data.debug,r.data.debug?localStorage.setItem("kaynix_debug","true"):localStorage.removeItem("kaynix_debug"))):this.addMessage("Error: ".concat(r.error),"command"),e.n=5;break;case 4:e.p=4,e.v,this.removeLoading(n),this.addMessage("Failed to process command. Please try again.","command");case 5:return e.a(2)}},e,this,[[2,4]])})),function(e){return f.apply(this,arguments)})},{key:"handleSlashCommand",value:(p=fe(le().m(function o(s){var c,u,l,d,p,f,g,h,m,y,b,v,w,x;return le().w(function(o){for(;;)switch(o.n){case 0:if("/reset"!==(c=s.toLowerCase().trim())){o.n=1;break}return this.messagesEl.innerHTML="",this.addMessage("💬 Conversation cleared","command"),o.a(2);case 1:if("/reload"!==c){o.n=2;break}return d=e,p=(null===(u=this.copilot)||void 0===u||null===(u=u.constructor)||void 0===u?void 0:u.COPILOT_VERSION)||"unknown",f=(null===(l=this.copilot)||void 0===l||null===(l=l.constructor)||void 0===l?void 0:l.SESSION_ID)||r||"none",g=t,h=n,this.addMessage("🔄 Reloading widget and fetching latest code...\n\nCurrent versions:\n• Widget: v".concat(d,"\n• Copilot: v").concat(p,"\n• Session: ").concat(f,"\n• Git Hash: ").concat(g,"\n• Build: ").concat(h),"command"),this.hide(),m=he({},this.config),sessionStorage.removeItem("kaynix_session_id"),y=document.querySelector('script[src*="widget.js"]'),b=document.getElementById("kaynix-widget-styles"),y&&y.remove(),b&&b.remove(),window.KaynixWidget.destroy(),v=i||"/widget.js",w="?_=".concat(Date.now()),(x=document.createElement("script")).src=v+w,a&&x.setAttribute("data-api-key",a),m.debug&&x.setAttribute("data-debug","true"),x.onload=fe(le().m(function e(){return le().w(function(e){for(;;)switch(e.n){case 0:setTimeout(fe(le().m(function e(){var t,n,r,i,a,o,s,c,u,l;return le().w(function(e){for(;;)switch(e.n){case 0:window.KaynixWidget&&window.KaynixWidget.instance&&(window.KaynixWidget.instance.show(),a=window.KaynixWidget.instance.constructor.WIDGET_VERSION||"unknown",o=(null===(t=window.KaynixWidget.instance.copilot)||void 0===t||null===(t=t.constructor)||void 0===t?void 0:t.COPILOT_VERSION)||"unknown",s=(null===(n=window.KaynixWidget.instance.copilot)||void 0===n||null===(n=n.constructor)||void 0===n?void 0:n.SESSION_ID)||"unknown",c=window.KaynixWidget.instance.constructor.GIT_HASH||"unknown",u=window.KaynixWidget.instance.constructor.BUILD_TIME||"unknown",l=null!==(r=window.KaynixWidget.instance.copilot)&&void 0!==r&&null!==(r=r.siteAdapter)&&void 0!==r&&r.getVersion?null===(i=window.KaynixWidget.instance.copilot)||void 0===i||null===(i=i.siteAdapter)||void 0===i?void 0:i.getVersion():"unknown",window.KaynixWidget.instance.addMessage("✅ Widget reloaded with fresh code!\n\nNew versions:\n• Widget: v".concat(a," ").concat(d!==a?"🆕 (updated!)":"✓","\n• Copilot: v").concat(o," ").concat(p!==o?"🆕 (updated!)":"✓","\n• Adapter: ").concat(l," 🆕\n• Session: ").concat(s," (new)\n• Git Hash: ").concat(c," ").concat(g!==c?"🆕":"✓","\n• Build: ").concat(u,"\n\n").concat(d!==a||p!==o?"🎉 New version loaded!":"✓ Same version reloaded"),"command"));case 1:return e.a(2)}},e)})),500);case 1:return e.a(2)}},e)})),x.onerror=function(){window.KaynixWidget.init(m),window.KaynixWidget.instance&&(window.KaynixWidget.instance.show(),window.KaynixWidget.instance.addMessage("⚠️ Failed to fetch new code, reloaded with existing version","command"))},document.body.appendChild(x),o.a(2);case 2:return o.n=3,this.delegateToCopilot(s);case 3:return o.a(2)}},o,this)})),function(e){return p.apply(this,arguments)})},{key:"addMessage",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=document.createElement("div");i.className="kaynix-message kaynix-message-".concat(t);var a=r.timestamp||(new Date).toISOString();i.dataset.timestamp=a,"system"===t&&(i.dataset.system="true"),r.intent&&i.classList.add("intent-".concat(r.intent));var o=e.includes("Applied filters")||e.includes("/filter");if(o&&i.classList.add("kaynix-message-with-filter"),"user"===t||"user-command"===t)i.innerHTML='<div class="kaynix-message-content">'.concat(this.escapeHtml(e),"</div>");else{var s=this.sanitizeHtml(e);o&&(s=this.formatFilterMessage(s)),i.innerHTML='<div class="kaynix-message-content">'.concat(s,"</div>")}this.messagesEl.appendChild(i),this.scrollToBottom(),clearTimeout(this.saveStateTimeout),this.saveStateTimeout=setTimeout(function(){n.saveSessionState()},1e3)}},{key:"showLoading",value:function(){var e=document.createElement("div");return e.className="kaynix-widget-loading",e.id="loading-".concat(Date.now()),e.textContent="Thinking...",this.messagesEl.appendChild(e),this.scrollToBottom(),e.id}},{key:"removeLoading",value:function(e){var t=document.getElementById(e);t&&t.remove()}},{key:"show",value:function(){this.container.style.display="flex",this.trigger.style.display="none",this.visible=!0;var e=this.container.querySelector(".kaynix-widget-input");e&&setTimeout(function(){return e.focus()},100),this.saveSessionState()}},{key:"hide",value:function(){this.container.style.display="none",this.trigger.style.display="flex",this.visible=!1,this.saveSessionState()}},{key:"toggle",value:function(){this.visible?this.hide():this.show()}},{key:"getApiKey",value:(d=fe(le().m(function e(){var t;return le().w(function(e){for(;;)switch(e.n){case 0:if(!window.KAYNIX_CONFIG||!window.KAYNIX_CONFIG.apiKey){e.n=1;break}return e.a(2,window.KAYNIX_CONFIG.apiKey);case 1:return(t=localStorage.getItem("kaynix_api_key"))||(t=prompt("Please enter your Kaynix API key:"))&&localStorage.setItem("kaynix_api_key",t),e.a(2,t)}},e)})),function(){return d.apply(this,arguments)})},{key:"promptForApiKey",value:(l=fe(le().m(function e(){var t,n;return le().w(function(e){for(;;)switch(e.n){case 0:if(t="🔑 API Key Required\n\nPlease enter your Kaynix API key to use this widget on ".concat(window.location.hostname,".\n\nYou can get your API key from the Kaynix landing page."),!((n=prompt(t))&&n.trim().length>=10)){e.n=1;break}return localStorage.setItem("kaynix_api_key",n.trim()),e.a(2,n.trim());case 1:return e.a(2,null)}},e)})),function(){return l.apply(this,arguments)})},{key:"getSessionId",value:function(){var e=sessionStorage.getItem("kaynix_session_id");return e||(e="session-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),sessionStorage.setItem("kaynix_session_id",e)),e}},{key:"escapeHtml",value:function(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}},{key:"formatFilterMessage",value:function(e){return e.replace(/Applied filters:\s*([^.]+)/gi,function(e,t){var n=t.split(",").map(function(e){return e.trim()}).map(function(e){return'<span class="kaynix-filter-bubble">'.concat(e,"</span>")}).join(" ");return"Applied filters:<br>".concat(n)})}},{key:"sanitizeHtml",value:function(e){var t=["strong","em","b","i","u","br","p","ul","ol","li","code","pre","span","div","a"],n=["href","target","rel"],r=document.createElement("div");r.innerHTML=e;var i=function(e){for(var r=0,a=Array.from(e.children);r<a.length;r++){var o=a[r];if(t.includes(o.tagName.toLowerCase())){for(var s=0,c=Array.from(o.attributes);s<c.length;s++){var u=c[s];n.includes(u.name)&&("href"!==u.name||u.value.startsWith("http"))||o.removeAttribute(u.name)}i(o)}else{var l=document.createTextNode(o.textContent);o.parentNode.replaceChild(l,o)}}};return i(r),r.innerHTML}},{key:"scrollToBottom",value:function(){var e=this;this.messagesEl&&requestAnimationFrame(function(){try{e.messagesEl.scrollTop=e.messagesEl.scrollHeight,setTimeout(function(){e.messagesEl&&(e.messagesEl.scrollTop=e.messagesEl.scrollHeight)},50)}catch(t){e.config.debug}})}},{key:"destroy",value:function(){if(this.suggestionDebounceTimer&&clearTimeout(this.suggestionDebounceTimer),this.elements&&this.elements.input&&this.boundHandlers&&(this.boundHandlers.input&&this.elements.input.removeEventListener("input",this.boundHandlers.input),this.boundHandlers.keydown&&this.elements.input.removeEventListener("keydown",this.boundHandlers.keydown)),this.elements&&this.elements.close&&this.boundHandlers&&(this.boundHandlers.close&&this.elements.close.removeEventListener("click",this.boundHandlers.close),this.boundHandlers.closeTouch&&this.elements.close.removeEventListener("touchend",this.boundHandlers.closeTouch)),this.boundHandlers&&this.boundHandlers.documentClick&&document.removeEventListener("click",this.boundHandlers.documentClick),this.container){var e=this.container.querySelector(".kaynix-widget-messages");e&&this.boundHandlers&&(this.boundHandlers.wheel&&e.removeEventListener("wheel",this.boundHandlers.wheel),this.boundHandlers.mousewheel&&e.removeEventListener("mousewheel",this.boundHandlers.mousewheel))}this.copilot&&(this.copilot=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.trigger&&this.trigger.parentNode&&this.trigger.parentNode.removeChild(this.trigger),this.elements={},this.boundHandlers={},this.container=null,this.trigger=null,this.messagesEl=null,this.visible=!1}}],c&&ye(s.prototype,c),u&&ye(s,u),Object.defineProperty(s,"prototype",{writable:!1}),s;var s,c,u,l,d,p,f,g,h,m,y}();if(window.KaynixWidget={version:e,WIDGET_VERSION:e,GIT_HASH:t,BUILD_TIME:n,SESSION_ID:r,sessionId:t||Math.random().toString(36).substring(2,9),loadTime:(new Date).toISOString(),instance:null,_instance:null,init:function(){var e=arguments,t=this;return fe(le().m(function n(){var r,i,a;return le().w(function(n){for(;;)switch(n.n){case 0:if(r=e.length>0&&void 0!==e[0]?e[0]:{},!t.instance&&!t._instance){n.n=1;break}return n.a(2,t.instance||t._instance);case 1:return t.instance=new s(r),t._instance=t.instance,n.p=2,n.n=3,t.instance.init();case 3:return(i=n.v)||(t.instance=null,t._instance=null),n.a(2,i);case 4:throw n.p=4,a=n.v,t.instance=null,t._instance=null,a;case 5:return n.a(2)}},n,null,[[2,4]])}))()},destroy:function(){this.instance&&(this.instance.destroy(),this.instance=null,this._instance=null)},show:function(){this.instance&&this.instance.show()},hide:function(){this.instance&&this.instance.hide()},getState:function(){return this.instance?{visible:this.instance.visible,initialized:!0}:{visible:!1,initialized:!1}}},"undefined"!=typeof window){var c=window.onerror;window.onerror=function(e,t,n,r,i){return!(!t||!(t.includes("noibu.com")||t.includes("google")||t.includes("facebook")||t.includes("analytics")||t.includes("quantum"))&&t.includes("kaynix"))||!!c&&c.apply(this,arguments)}}var u=document.currentScript;if(u&&"false"!==u.getAttribute("data-auto-init")){var l=window.KAYNIX_CONFIG?he({},window.KAYNIX_CONFIG):{};u.getAttribute("data-position")&&(l.position=u.getAttribute("data-position")),u.getAttribute("data-auto-show")&&(l.autoShow="true"===u.getAttribute("data-auto-show")),u.getAttribute("data-debug")&&(l.debug="true"===u.getAttribute("data-debug")),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){window.KaynixWidget.init(l)}):window.KaynixWidget.init(l)}}()})();