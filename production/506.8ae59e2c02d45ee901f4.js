"use strict";(self.webpackChunkkaynix_frontend=self.webpackChunkkaynix_frontend||[]).push([[506],{506:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t,r){return t=c(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function i(e){var t="function"==typeof Map?new Map:void 0;return i=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(a())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&u(o,r.prototype),o}(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)},i(e)}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(a=function(){return!!e})()}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function f(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.r(t),r.d(t,{KaynixAPIClient:()=>N,default:()=>q});var y={DEFAULT_TIMEOUT:3e4,DEFAULT_BASE_URL_PROD:"https://api.kaynix.ai",DEFAULT_BASE_URL_DEV:"http://localhost:8080",DEFAULT_PORT_DEV:"8090"},d={API_KEY:"kaynix_api_key",FORCE_LOCAL:"kaynix_force_local"},h={LOCAL_MODE:"kaynix_local"},b=0,g=1,v=2,_=3,m=function(){return f(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g;l(this,e),this.name=t,this.level=r,this.debugMode=w()||"true"===localStorage.getItem("kaynix_debug")},[{key:"debug",value:function(){if(this.debugMode&&this.level<=b){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).log.apply(e,["[".concat(this.name,"]")].concat(r))}}},{key:"info",value:function(){if(this.level<=g){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).log.apply(e,["[".concat(this.name,"]")].concat(r))}}},{key:"warn",value:function(){if(this.level<=v){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).warn.apply(e,["[".concat(this.name,"]")].concat(r))}}},{key:"error",value:function(){if(this.level<=_){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).error.apply(e,["[".concat(this.name,"]")].concat(r))}}}])}();function w(){if("undefined"==typeof window)return!1;var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||window.location.port===y.DEFAULT_PORT_DEV||"true"===localStorage.getItem(d.FORCE_LOCAL)||window.location.search.includes("".concat(h.LOCAL_MODE,"=true"))||!0===window.KAYNIX_FORCE_LOCAL}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.baseUrl?e.baseUrl:w()?y.DEFAULT_BASE_URL_DEV:y.DEFAULT_BASE_URL_PROD}var P=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UNKNOWN_ERROR",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return l(this,t),(r=o(this,t,[e])).name="ApiError",r.code=n,r.details=i,r.timestamp=(new Date).toISOString(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),f(t,[{key:"toJSON",value:function(){return{error:{message:this.message,code:this.code,details:this.details,timestamp:this.timestamp}}}}])}(i(Error));function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UNKNOWN_ERROR",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e instanceof P)return e;var n=e instanceof Error?e.message:String(e);return new P(n,t,r)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var r=localStorage.getItem(e);if(null===r)return t;try{return JSON.parse(r)}catch(n){return r}}catch(o){return t}}function A(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);return localStorage.setItem(e,r),!0}catch(n){return!1}}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){R(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function R(e,t,r){return(t=L(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof u?n:u,l=Object.create(c.prototype);return I(l,"_invoke",function(r,n,o){var i,u,c,l=0,s=o||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return i=t,u=0,c=e,p.n=r,a}};function y(r,n){for(u=r,c=n,t=0;!f&&l&&!o&&t<s.length;t++){var o,i=s[t],y=p.p,d=i[2];r>3?(o=d===n)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=y&&((o=r<2&&y<i[1])?(u=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,u=0))}if(o||r>1)return a;throw f=!0,n}return function(o,s,d){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&y(s,d),u=s,c=d;(t=u<2?e:c)||!f;){i||(u?u<3?(u>1&&(p.n=-1),y(u,c)):p.n=c:p.v=c);try{if(l=2,i){if(u||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,u<2&&(u=0)}else 1===u&&(t=i.return)&&t.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((t=(f=p.n<0)?c:r.call(n,p))!==a)break}catch(t){i=e,u=1,c=t}finally{l=1}}return{value:t,done:f}}}(r,o,i),!0),l}var a={};function u(){}function c(){}function l(){}t=Object.getPrototypeOf;var s=[][n]?t(t([][n]())):(I(t={},n,function(){return this}),t),f=l.prototype=u.prototype=Object.create(s);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,I(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=l,I(f,"constructor",l),I(l,"constructor",c),c.displayName="GeneratorFunction",I(l,o,"GeneratorFunction"),I(f),I(f,o,"Generator"),I(f,n,function(){return this}),I(f,"toString",function(){return"[object Generator]"}),(U=function(){return{w:i,m:p}})()}function I(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}I=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var i=function(t,r){I(e,t,function(e){return this._invoke(t,r,e)})};i("next",0),i("throw",1),i("return",2)}},I(e,t,r,n)}function K(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function x(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){K(i,n,o,a,u,"next",e)}function u(e){K(i,n,o,a,u,"throw",e)}a(void 0)})}}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function L(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}var N=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={baseUrl:t.baseUrl||O(),timeout:t.timeout||y.DEFAULT_TIMEOUT,debug:t.debug||!1},this.apiKeyProvider=t.apiKeyProvider||null,this.requestId=0,this.logger=new m("KaynixAPI",this.config.debug?0:1),this.logger.debug("Initialized with base URL: ".concat(this.config.baseUrl))},t=[{key:"_getDefaultBaseUrl",value:function(){return O()}},{key:"getApiKey",value:(s=x(U().m(function e(){var t,r;return U().w(function(e){for(;;)switch(e.n){case 0:if(!w()){e.n=2;break}if("undefined"==typeof process||!process.env||!process.env.KAYNIX_API_KEY){e.n=1;break}return this.logger.debug("Using KAYNIX_API_KEY from environment variable"),e.a(2,process.env.KAYNIX_API_KEY);case 1:this.logger.warn("KAYNIX_API_KEY not found in environment variables for development mode.");case 2:if(!(t=k(d.API_KEY))){e.n=3;break}return e.a(2,t);case 3:if(!this.apiKeyProvider||"function"!=typeof this.apiKeyProvider){e.n=5;break}return e.n=4,this.apiKeyProvider();case 4:if(!(r=e.v)){e.n=5;break}return A(d.API_KEY,r),e.a(2,r);case 5:throw new P("No API key available","NO_API_KEY");case 6:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"request",value:(l=x(U().m(function e(t){var r,n,o,i,a,u,c,l,s,f,p,y,d,h,b,g,v=arguments;return U().w(function(e){for(;;)switch(e.n){case 0:return r=v.length>1&&void 0!==v[1]?v[1]:{},n=++this.requestId,e.p=1,e.n=2,this.getApiKey();case 2:return o=e.v,i="".concat(this.config.baseUrl).concat(t),a=new AbortController,u=setTimeout(function(){return a.abort()},this.config.timeout),c={method:r.method||"POST",headers:T({"Content-Type":"application/json",Authorization:"Bearer ".concat(o),"X-Request-ID":"widget-".concat(n)},r.headers),signal:a.signal},r.body&&(c.body=JSON.stringify(r.body)),this.logger.debug("Request ".concat(n,": ").concat(c.method," ").concat(i),r.body),this.logger.debug("Current location: ".concat(window.location.href)),this.logger.debug("Port detection: ".concat(window.location.port)),this.logger.debug("Base URL: ".concat(this.config.baseUrl)),e.n=3,fetch(i,c);case 3:if(l=e.v,clearTimeout(u),l.ok){e.n=5;break}return e.n=4,l.json().catch(function(){return{}});case 4:throw s=e.v,f=s.detail||"HTTP ".concat(l.status),this.logger.error("HTTP ".concat(l.status," error:"),s),s.detail&&"object"===S(s.detail)&&this.logger.error("Validation errors:",JSON.stringify(s.detail,null,2)),E(f,"HTTP_".concat(l.status),{status:l.status,response:s});case 5:return e.n=6,l.json();case 6:return p=e.v,this.logger.debug("Response ".concat(n,":"),p),e.a(2,p);case 7:if(e.p=7,g=e.v,this.logger.error("Request ".concat(n," failed:"),g),g instanceof P){e.n=8;break}throw d="UNKNOWN_ERROR",h="Something went wrong. Please try again.",b=null,401===(null===(y=g.details)||void 0===y?void 0:y.status)?(d="AUTH_ERROR",h="Invalid API key. Please check your credentials.",b={action:"clear_api_key"}):"AbortError"===g.name&&(d="TIMEOUT_ERROR",h="Request timed out after ".concat(this.config.timeout/1e3," seconds.")),E(h,d,b);case 8:throw g;case 9:return e.a(2)}},e,this,[[1,7]])})),function(e){return l.apply(this,arguments)})},{key:"sendChatRequest",value:(c=x(U().m(function e(t){return U().w(function(e){for(;;)if(0===e.n)return e.a(2,this.request("/api/v1/chat",{body:{site_domain:t.site_domain,user_query:t.user_query,page_query:t.page_query||null,page_url:t.page_url||null,page_context:t.page_context||{},widget_mode:t.widget_mode||null,mode:t.mode||"rag",debug:t.debug||!1,use_cache:!1!==t.use_cache}}))},e,this)})),function(e){return c.apply(this,arguments)})},{key:"sendChatMCPRequest",value:(u=x(U().m(function e(t){var r,n;return U().w(function(e){for(;;)switch(e.n){case 0:return this.config.debug,r=(t.page_products||[]).map(function(e){var t,r;return"Product"===e["@type"]?{title:e.name,price:(null===(t=e.offers)||void 0===t?void 0:t.price)||e.price||0,brand:(null===(r=e.brand)||void 0===r?void 0:r.name)||e.brand||null,productUrl:e["@id"]||e.url||null,id:e.sku||e["@id"]||null}:{title:e.title||e.name||"Unknown",price:e.price||e.priceText||0,brand:e.brand||null,productUrl:e.productUrl||e.url||null,id:e.id||null}}),e.n=1,this.request("/api/v1/chat-mcp",{body:{site_domain:t.site_domain,user_query:t.user_query,page_products:r,available_tools:t.available_tools||[],page_url:t.page_url||null,page_context:t.page_context||{},debug:t.debug||!1,use_cache:!1!==t.use_cache}});case 1:return n=e.v,this.config.debug,e.a(2,n)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"checkHealth",value:(a=x(U().m(function e(){return U().w(function(e){for(;;)if(0===e.n)return e.a(2,this.request("/health",{method:"GET"}))},e,this)})),function(){return a.apply(this,arguments)})},{key:"clearApiKey",value:function(){localStorage.removeItem("kaynix_api_key")}},{key:"chat",value:(i=x(U().m(function e(t,r){return U().w(function(e){for(;;)if(0===e.n)return e.a(2,this.sendChatRequest({site_domain:r.site,user_query:t,page_url:r.url,page_context:r,debug:r.debug}))},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"chatMCP",value:(o=x(U().m(function e(t,r){return U().w(function(e){for(;;)if(0===e.n)return e.a(2,this.sendChatMCPRequest({site_domain:r.site_domain,user_query:r.user_query||t,page_products:r.page_products,available_tools:r.available_tools,page_url:r.page_url,page_context:r.page_context,debug:r.debug}))},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getStatus",value:(n=x(U().m(function e(){return U().w(function(e){for(;;)if(0===e.n)return e.a(2,this.checkHealth())},e,this)})),function(){return n.apply(this,arguments)})}],t&&D(e.prototype,t),r&&D(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,n,o,i,a,u,c,l,s}();const q=N}}]);