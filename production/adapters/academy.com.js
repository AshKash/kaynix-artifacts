import{BaseSiteAdapter}from"./base-adapter.js";export class AcademyAdapter extends BaseSiteAdapter{constructor(t={}){super("academy.com",t)}extractFromStructuredData(){this.log("Attempting to extract from structured data...");const t=[],e=document.querySelectorAll('script[type="application/ld+json"]');for(const c of e)try{const e=JSON.parse(c.textContent);if("ItemList"===e["@type"]&&e.itemListElement)for(const r of e.itemListElement)if(r.item&&"Product"===r.item["@type"]){const e=r.item,c={title:e.name,url:e.url,price:e.offers?.price||e.offers?.lowPrice,imageUrl:e.image,brand:e.brand?.name||e.brand,sku:e.sku||e.mpn};c.title&&c.price&&t.push(c)}if("Product"===e["@type"]){const r={title:e.name,url:e.url,price:e.offers?.price||e.offers?.lowPrice,imageUrl:e.image,brand:e.brand?.name||e.brand,sku:e.sku||e.mpn};r.title&&r.price&&t.push(r)}}catch(r){this.log("Error parsing JSON-LD:",r)}return this.log(`Extracted ${t.length} products from structured data`),t}async extractProducts(t={}){this.log("Extracting products from academy.com...");let e=[];const r=this.extractFromStructuredData();if(r.length>0&&(this.log(`Found ${r.length} products from structured data`),e=r),0===e.length){this.log("No structured data found, trying DOM extraction...");const t=document.querySelectorAll('.productCard--bgvhk, [data-auid="ProductCard"]');this.log(`Found ${t.length} product elements`);for(const r of t)try{const t={},c=r.querySelector('.title--HjbR1, a[href^="/p/"]');t.title=c?c.textContent.trim():null;const o=r.querySelector('a[href^="/p/"]');o&&(t.url=o.href.startsWith("http")?o.href:`https://www.academy.com${o.getAttribute("href")}`);const s=r.querySelector('.price--WDaoS, [class*="price"]');if(s){const e=s.textContent.trim();t.price=this.extractPrice(e)}const i=r.querySelector('.mainProductImage--noHeM, img[src*="academy.scene7.com"]');t.imageUrl=i?i.src||i.getAttribute("data-src"):null,t.title&&t.price&&t.url?e.push(t):this.log("Skipping product with missing fields:",{title:t.title,price:t.price,url:t.url})}catch(c){this.error("Error extracting product:",c)}}if(0===e.length){this.log("Trying generic product extraction...");const t=['article[class*="product"]','div[class*="product-card"]','div[class*="productCard"]','li[class*="product"]'];for(const r of t){const t=document.querySelectorAll(r);if(t.length>0){this.log(`Found ${t.length} elements with selector: ${r}`);for(const r of t)try{const t={},c=r.querySelector('a[href*="/p/"], h2, h3, [class*="title"]');t.title=c?c.textContent.trim():null;const o=r.querySelector('a[href*="/p/"]');o&&(t.url=o.href.startsWith("http")?o.href:`https://www.academy.com${o.getAttribute("href")}`);const s=r.querySelector('[class*="price"], span[data-price]');if(s){const e=s.textContent.trim();t.price=this.extractPrice(e)}const i=r.querySelector('img[src*="academy"], img[data-src*="academy"]');t.imageUrl=i?i.src||i.getAttribute("data-src"):null,t.title&&t.price&&e.push(t)}catch(c){this.log("Error in generic extraction:",c)}if(e.length>0)break}}}return this.log(`Extracted ${e.length} products total`),{products:e,success:!0}}}