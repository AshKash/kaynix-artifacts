(()=>{"use strict";var e,n,t={},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,i),s.exports}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=c(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==t.return||t.return()}finally{if(o)throw s}}}}function o(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,n){if(e){if("string"==typeof e)return u(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?u(e,n):void 0}}function u(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function l(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function s(t,r,i,s){var c=r&&r.prototype instanceof o?r:o,u=Object.create(c.prototype);return d(u,"_invoke",function(t,r,i){var s,o,c,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(n,t){return s=n,o=0,c=e,p.n=t,a}};function g(t,r){for(o=t,c=r,n=0;!d&&u&&!i&&n<l.length;n++){var i,s=l[n],g=p.p,h=s[2];t>3?(i=h===r)&&(c=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=g&&((i=t<2&&g<s[1])?(o=0,p.v=r,p.n=s[1]):g<h&&(i=t<3||s[0]>r||r>h)&&(s[4]=t,s[5]=r,p.n=h,o=0))}if(i||t>1)return a;throw d=!0,r}return function(i,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&g(l,h),o=l,c=h;(n=o<2?e:c)||!d;){s||(o?o<3?(o>1&&(p.n=-1),g(o,c)):p.n=c:p.v=c);try{if(u=2,s){if(o||(i="next"),n=s[i]){if(!(n=n.call(s,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,o<2&&(o=0)}else 1===o&&(n=s.return)&&n.call(s),o<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((n=(d=p.n<0)?c:t.call(r,p))!==a)break}catch(n){s=e,o=1,c=n}finally{u=1}}return{value:n,done:d}}}(t,i,s),!0),u}var a={};function o(){}function c(){}function u(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(d(n={},r,function(){return this}),n),g=u.prototype=o.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,d(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e}return c.prototype=u,d(g,"constructor",u),d(u,"constructor",c),c.displayName="GeneratorFunction",d(u,i,"GeneratorFunction"),d(g),d(g,i,"Generator"),d(g,r,function(){return this}),d(g,"toString",function(){return"[object Generator]"}),(l=function(){return{w:s,m:h}})()}function d(e,n,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}d=function(e,n,t,r){if(n)i?i(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t;else{var s=function(n,t){d(e,n,function(e){return this._invoke(n,t,e)})};s("next",0),s("throw",1),s("return",2)}},d(e,n,t,r)}function p(e,n,t,r,i,s,a){try{var o=e[s](a),c=o.value}catch(e){return void t(e)}o.done?n(c):Promise.resolve(c).then(r,i)}function g(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var s=e.apply(n,t);function a(e){p(s,r,i,a,o,"next",e)}function o(e){p(s,r,i,a,o,"throw",e)}a(void 0)})}}function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function m(e,n,t){return(n=y(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function f(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}function y(e){var n=function(e,n){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==s(n)?n:n+""}i.m=t,i.d=(e,n)=>{for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((n,t)=>(i.f[t](e,n),n),[])),i.u=e=>(193===e?"kaynix-common":e)+"."+{12:"592815afc43bd6097ed8",193:"2497a00f49762b8d0d24",282:"1f5bf5c87b8865141817",506:"8ae59e2c02d45ee901f4",735:"85b122696b154ed90593"}[e]+".js",i.miniCssF=e=>{},i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),e={},n="kaynix-frontend:",i.l=(t,r,s,a)=>{if(e[t])e[t].push(r);else{var o,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==n+s){o=d;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",n+s),o.src=t),e[t]=[r];var p=(n,r)=>{o.onerror=o.onload=null,clearTimeout(g);var i=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(e=>e(r)),n)return n(r)},g=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),c&&document.head.appendChild(o)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={239:0};i.f.j=(n,t)=>{var r=i.o(e,n)?e[n]:void 0;if(0!==r)if(r)t.push(r[2]);else{var s=new Promise((t,i)=>r=e[n]=[t,i]);t.push(r[2]=s);var a=i.p+i.u(n),o=new Error;i.l(a,t=>{if(i.o(e,n)&&(0!==(r=e[n])&&(e[n]=void 0),r)){var s=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;o.message="Loading chunk "+n+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,r[1](o)}},"chunk-"+n,n)}};var n=(n,t)=>{var r,s,[a,o,c]=t,u=0;if(a.some(n=>0!==e[n])){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(c)c(i)}for(n&&n(t);u<a.length;u++)s=a[u],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},t=self.webpackChunkkaynix_frontend=self.webpackChunkkaynix_frontend||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var b="2.0.0",v=Math.random().toString(36).substring(2,9),x=(new Date).toISOString(),w=function(){return e=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({debug:n.debug||"8090"===window.location.port},n),this.apiClient=null,this.siteAdapter=null,this.domain=window.location.hostname.replace("www.",""),this.adapters=new Map,this.mcpServer=null,this.mcpCapabilities=null},n=[{key:"initialize",value:(q=g(l().m(function e(){var n,t,r;return l().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.p=1,e.n=2,i.e(506).then(i.bind(i,506));case 2:t=e.v,n=t.default||t.KaynixAPIClient,e.n=4;break;case 3:throw e.p=3,e.v,new Error("Failed to load KaynixAPIClient. Please ensure kaynix-api-client.js is available in the build.");case 4:return this.apiClient=new n({debug:this.config.debug,apiKeyProvider:this.config.apiKeyProvider,baseUrl:this.config.apiUrl||this.config.baseUrl}),e.n=5,this.loadSiteAdapter();case 5:return this.initializeMCPServer(),e.a(2,{success:!0,domain:this.domain,hasAdapter:!!this.siteAdapter,hasApiClient:!!this.apiClient,mcpServer:!!this.mcpServer});case 6:return e.p=6,r=e.v,e.a(2,{success:!1,error:r.message})}},e,this,[[1,3],[0,6]])})),function(){return q.apply(this,arguments)})},{key:"loadSiteAdapter",value:(M=g(l().m(function e(){var n,t,r;return l().w(function(e){for(;;)switch(e.n){case 0:if(n={localhost:function(){return Promise.all([i.e(193),i.e(282)]).then(i.bind(i,282))},"roadrunnersports.com":function(){return Promise.all([i.e(193),i.e(735)]).then(i.bind(i,735))},"rei.com":function(){return Promise.all([i.e(193),i.e(12)]).then(i.bind(i,12))}}[this.domain]){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,e.n=2,n();case 2:return t=e.v,r=t.default,this.siteAdapter=new r({debug:this.config.debug}),e.a(2,!0);case 3:return e.p=3,e.v,e.a(2,!1)}},e,this,[[1,3]])})),function(){return M.apply(this,arguments)})},{key:"initializeMCPServer",value:function(){this.mcpCapabilities={tools:[{name:"process_user_input",description:"Process user input with intelligent routing to chat, search, filter, or hybrid workflows",inputSchema:{type:"object",properties:{message:{type:"string",description:"The user's message or query"},context:{type:"object",description:"Additional context (page URL, session info, etc.)",properties:{page_url:{type:"string"},session_id:{type:"string"},page_type:{type:"string"},user_intent:{type:"string"}}}},required:["message"]}},{name:"search_products",description:"Search for products on the current e-commerce site",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query for products"},options:{type:"object",description:"Search options"}},required:["query"]}},{name:"apply_filters",description:"Apply filters to current product listing",inputSchema:{type:"object",properties:{filters:{type:"object",description:"Filters to apply",properties:{gender:{type:"string",enum:["men","women","kids"]},priceMax:{type:"number"},brands:{type:"array",items:{type:"string"}},sizes:{type:"array",items:{type:"string"}},saleOnly:{type:"boolean"}}}},required:["filters"]}},{name:"extract_products",description:"Extract products from the current page",inputSchema:{type:"object",properties:{options:{type:"object",description:"Extraction options"}}}},{name:"get_page_context",description:"Get current page context and site information",inputSchema:{type:"object",properties:{}}}]},this.mcpServer={capabilities:this.mcpCapabilities,callTool:function(){var e=g(l().m(function e(n,t){var r;return l().w(function(e){for(;;)switch(e.n){case 0:r=n,e.n="process_user_input"===r?1:"search_products"===r?3:"apply_filters"===r?5:"extract_products"===r?7:"get_page_context"===r?9:11;break;case 1:return e.n=2,this.processUserInput(t.message,t.context||{});case 2:case 4:case 6:case 8:case 10:return e.a(2,e.v);case 3:return e.n=4,this.handleSearchIntent(t.query,t.options||{});case 5:return e.n=6,this.handleFilterIntent(t.filters,{});case 7:return e.n=8,this.handleExtractIntent(t.options||{});case 9:return e.n=10,this.getPageContext();case 11:throw new Error("Unknown tool: ".concat(n));case 12:return e.a(2)}},e,this)}));return function(n,t){return e.apply(this,arguments)}}().bind(this),listTools:function(){return this.mcpCapabilities.tools},getServerInfo:function(){return{name:"kaynix-copilot",version:b,capabilities:this.mcpCapabilities}}}}},{key:"getPageContext",value:(j=g(l().m(function e(){var n;return l().w(function(e){for(;;)if(0===e.n)return n=this.detectPageType(),e.a(2,{success:!0,type:"page_context",data:{url:window.location.href,domain:this.domain,pathname:window.location.pathname,search:window.location.search,title:document.title,pageType:n,hasAdapter:!!this.siteAdapter,adapterName:this.siteAdapter&&this.siteAdapter.constructor.name||"none",timestamp:(new Date).toISOString(),sessionId:v}})},e,this)})),function(){return j.apply(this,arguments)})},{key:"detectPageType",value:function(){var e=window.location.pathname.toLowerCase(),n=window.location.search.toLowerCase();return e.includes("/product")||e.includes("/p/")?"product":e.includes("/search")||n.includes("q=")?"search":e.includes("/category")||e.includes("/c/")?"category":"/"===e||""===e?"home":e.includes("/cart")?"cart":"other"}},{key:"processUserInputMCP",value:(O=g(l().m(function e(n){var t,r,i,s,a,o,c,u,d=arguments;return l().w(function(e){for(;;)switch(e.n){case 0:return t=d.length>1&&void 0!==d[1]?d[1]:{},e.p=1,this.config.debug,e.n=2,this.getPageProductsJsonLD();case 2:return i=e.v,s=(null===(r=this.siteAdapter)||void 0===r||null===(r=r.getMCPCapabilities())||void 0===r?void 0:r.tools)||[],e.n=3,this.apiClient.sendChatMCPRequest({user_query:n,site_domain:this.domain,page_products:i,available_tools:s,page_url:window.location.href,page_context:t});case 3:if(a=e.v,this.config.debug,o={request:{user_query:n,site_domain:this.domain,page_url:window.location.href,page_products_count:i?i.length:0,available_tools:s?s.map(function(e){return e.name}):[]},response:{success:a.success,text_response:a.text_response,tool_calls:a.tool_calls||[],timestamp:a.timestamp},page_products_sample:i?i.slice(0,3).map(function(e){var n;return{name:e.name,price:e.price||(null===(n=e.offers)||void 0===n?void 0:n.price),url:e.url}}):[]},a.text_response,this.config.debug&&("=".repeat(50),"=".repeat(50),'\n‚Ä¢ User Query: "'.concat(o.request.user_query,'"'),"\n‚Ä¢ Site: ".concat(o.request.site_domain),"\n‚Ä¢ Page Products: ".concat(o.request.page_products_count),"\n‚Ä¢ Available Tools: ".concat(o.request.available_tools.join(", ")),"\n‚Ä¢ Success: ".concat(o.response.success),"\n‚Ä¢ Tool Calls: ".concat(o.response.tool_calls.length),o.page_products_sample.length>0&&o.page_products_sample.forEach(function(e,n){"\n".concat(n+1,". ").concat(e.name," - ").concat(e.price||"No price")}),a.tool_calls&&a.tool_calls.length>0&&a.tool_calls.forEach(function(e,n){"\n".concat(n+1,". ").concat(e.tool,"(").concat(JSON.stringify(e.parameters),")")}),"=".repeat(50)),!(a.tool_calls&&a.tool_calls.length>0)){e.n=5;break}return e.n=4,this.executeMCPToolCalls(a.tool_calls);case 4:return c=e.v,o.tool_results=c,e.a(2,{success:!0,type:"mcp",text_response:a.text_response,tool_calls:a.tool_calls,tool_results:c,message:this.formatMCPResponse(a,c),debug:o});case 5:return e.a(2,{success:!0,type:"chat",message:a.text_response,debug:o});case 6:e.n=8;break;case 7:return e.p=7,u=e.v,e.a(2,{success:!1,error:u.message,type:"error"});case 8:return e.a(2)}},e,this,[[1,7]])})),function(e){return O.apply(this,arguments)})},{key:"processUserInput",value:(T=g(l().m(function e(n){var t,r,i,s,a=arguments;return l().w(function(e){for(;;)switch(e.n){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:{},e.p=1,this.config.debug,e.n=2,this.analyzeIntent(n,t);case 2:r=e.v,i=r.type,e.n="chat"===i?3:"search"===i?5:"filter"===i?7:"extract"===i?9:"cart"===i?11:"hybrid"===i?13:"help"===i?15:"status"===i?17:"debug"===i?19:"clear"===i?21:"unknown_command"===i?23:25;break;case 3:return e.n=4,this.handleChatIntent(n,t);case 4:case 6:case 8:case 10:case 12:case 14:case 16:case 18:case 20:case 22:case 24:case 26:return e.a(2,e.v);case 5:return e.n=6,this.handleSearchIntent(r.query,t);case 7:return e.n=8,this.handleFilterIntent(r.filters,t);case 9:return e.n=10,this.handleExtractIntent(t);case 11:return e.n=12,this.handleCartCommandIntent(r.subCommand,t);case 13:return e.n=14,this.handleHybridIntent(n,r,t);case 15:return e.n=16,this.handleHelpIntent();case 17:return e.n=18,this.handleStatusIntent();case 19:return e.n=20,this.handleDebugIntent(r.mode);case 21:return e.n=22,this.handleClearIntent();case 23:return e.n=24,this.handleUnknownCommandIntent(r.command);case 25:return e.n=26,this.handleChatIntent(n,t);case 27:e.n=29;break;case 28:return e.p=28,s=e.v,e.a(2,{success:!1,error:s.message,type:"error"});case 29:return e.a(2)}},e,this,[[1,28]])})),function(e){return T.apply(this,arguments)})},{key:"analyzeIntent",value:(I=g(l().m(function e(n,t){var r,i,s;return l().w(function(e){for(;;)switch(e.n){case 0:if(r=n.toLowerCase().trim(),!n.startsWith("/")){e.n=1;break}return e.a(2,this.analyzeSlashCommand(n));case 1:if(!(r.includes("search for")||r.includes("find")||r.includes("show me"))){e.n=2;break}return i=n.replace(/search for|find|show me/gi,"").trim(),e.a(2,{type:"search",query:i});case 2:if(!(r.startsWith("filter ")||r.includes("filter")||r.includes("only show")||r.includes("just"))){e.n=3;break}if(s=this.extractFilters(n),!(Object.keys(s).length>0)){e.n=3;break}return e.a(2,{type:"filter",filters:s});case 3:if(!r.includes("what products")&&!r.includes("list products")){e.n=4;break}return e.a(2,{type:"extract"});case 4:if(!r.includes("add to cart")&&!r.includes("buy")){e.n=5;break}return e.a(2,{type:"cart",product:null,options:{}});case 5:if(!r.includes("which")||!r.includes("best")){e.n=6;break}return e.a(2,{type:"hybrid",subIntents:["chat","extract"]});case 6:return e.a(2,{type:"chat"})}},e,this)})),function(e,n){return I.apply(this,arguments)})},{key:"extractFilters",value:function(e){var n={},t=e.toLowerCase();t.includes("women")||t.includes("womens")||t.includes("women's")?n.gender="women":t.includes("men")||t.includes("mens")||t.includes("men's")?n.gender="men":(t.includes("kid")||t.includes("child"))&&(n.gender="kids");var r=t.match(/under \$?(\d+)|below \$?(\d+)|less than \$?(\d+)|<\s*\$?(\d+)/);if(r){var i=r[1]||r[2]||r[3]||r[4];n.priceMax=parseInt(i)}var s=["nike","adidas","hoka","asics","brooks","new balance","saucony","mizuno","altra","on"].filter(function(e){return t.includes(e)});s.length>0&&(n.brands=s);var a=t.match(/size\s*(\d+\.?\d*)/);a&&(n.sizes=[a[1]]),t.includes("wide")&&!t.includes("extra wide")?n.width="wide":t.includes("extra wide")&&(n.width="extra wide"),t.includes("waterproof")&&(n.features=["waterproof"]),t.includes("trail")&&(n.features=[].concat(o(n.features||[]),["trail"])),t.includes("cushion")&&(n.features=[].concat(o(n.features||[]),["cushion"])),(t.includes("sale")||t.includes("discount"))&&(n.saleOnly=!0);var c=t.match(/(\d)\+?\s*star/);return c&&(n.minRating=parseInt(c[1])),n}},{key:"analyzeSlashCommand",value:function(e){var n=e.toLowerCase().trim();if(n.startsWith("/search "))return{type:"search",query:e.substring(8).trim()};if(n.startsWith("/filter ")){var t=e.substring(8).trim();return{type:"filter",filters:this.extractFilters(t)}}return"/clear"===n?{type:"clear"}:"/extract"===n?{type:"extract"}:"/help"===n?{type:"help"}:"/status"===n?{type:"status"}:"/debug"===n||"/debug on"===n||"/debug off"===n?{type:"debug",mode:n}:"/cart"===n||n.startsWith("/cart ")?{type:"cart",subCommand:n.substring(5).trim()}:{type:"unknown_command",command:e}}},{key:"handleChatIntent",value:(A=g(l().m(function e(n,t){var r;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.apiClient){e.n=1;break}throw new Error("API client not initialized");case 1:return e.n=2,this.apiClient.sendChatRequest({user_query:n,site_domain:this.domain,page_url:window.location.href,page_context:t,mode:"rag"});case 2:return r=e.v,e.a(2,{success:!0,type:"chat",response:r.response,debug:r.debug})}},e,this)})),function(e,n){return A.apply(this,arguments)})},{key:"handleSearchIntent",value:(E=g(l().m(function e(n,t){var r;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"search",error:"No adapter available for this site"});case 1:return e.n=2,this.siteAdapter.search(n);case 2:return r=e.v,e.a(2,{success:r.success,type:"search",data:r,message:r.success?'Searched for "'.concat(n,'". ').concat(r.message||""):"Search failed: ".concat(r.error)})}},e,this)})),function(e,n){return E.apply(this,arguments)})},{key:"handleFilterIntent",value:(P=g(l().m(function e(n,t){var r,i,s;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"filter",error:"No adapter available for this site. Filter commands only work on supported e-commerce sites."});case 1:return e.n=2,this.siteAdapter.applyFilters(n);case 2:return r=e.v,i="",r.success?(s=[],n.gender&&s.push("".concat(n.gender,"'s products")),n.priceMax&&s.push("under $".concat(n.priceMax)),n.brands&&s.push("".concat(n.brands.join(", ")," brands")),n.saleOnly&&s.push("sale items"),i="Applied filters: ".concat(s.join(", "),". "),r.message&&(i+=r.message)):i="Filter failed: ".concat(r.error),e.a(2,{success:r.success,type:"filter",data:r,message:i})}},e,this)})),function(e,n){return P.apply(this,arguments)})},{key:"handleExtractIntent",value:(C=g(l().m(function e(n){var t,r,i;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"extract",error:"No adapter available for this site"});case 1:return e.p=1,e.n=2,this.siteAdapter.extractProducts();case 2:if((t=e.v).products){e.n=3;break}return e.a(2,{success:!1,type:"extract",error:"Extract failed: No products array returned from adapter"});case 3:return r='<p style="color: #4b5563; font-weight: 600;">üì¶ Found '.concat(t.products.length||0," products on this page:</p>"),t.products&&t.products.length>0?t.products.forEach(function(e){var n=e.title||"Unknown Product",t=e.priceText||(e.price?"".concat(e.price):"No price"),i=e.url||"#";r+='<p><a href="'.concat(i,'" target="_blank" rel="noopener" style="color: #2563eb; text-decoration: none; hover: text-decoration: underline;">').concat(n," - ").concat(t,"</a></p>")}):r+='<p style="color: #6b7280; font-style: italic;">No products found on this page</p>',e.a(2,{success:!0,type:"extract",data:t,html:r,message:r});case 4:return e.p=4,i=e.v,this.log("Error during extraction:",i),e.a(2,{success:!1,type:"extract",error:"Extract failed: ".concat(i.message)})}},e,this,[[1,4]])})),function(e){return C.apply(this,arguments)})},{key:"handleCartIntent",value:(_=g(l().m(function e(n,t,r){return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"cart",error:"No adapter available for this site"});case 1:return e.a(2,{success:!1,type:"cart",error:"Cart actions not yet implemented"})}},e,this)})),function(e,n,t){return _.apply(this,arguments)})},{key:"handleHybridIntent",value:(S=g(l().m(function e(n,t,r){var i,s;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.handleChatIntent(n,r);case 1:if(i=e.v,!this.siteAdapter){e.n=3;break}return e.n=2,this.handleExtractIntent(r);case 2:return s=e.v,e.a(2,{success:!0,type:"hybrid",chat:i,products:s,message:"Here's what I found and my recommendation"});case 3:return e.a(2,i)}},e,this)})),function(e,n,t){return S.apply(this,arguments)})},{key:"handleHelpIntent",value:(k=g(l().m(function e(){return l().w(function(e){for(;;)if(0===e.n)return e.a(2,{success:!0,type:"help",message:'üìö Available Commands\n\nüîç Shopping Actions:\n‚Ä¢ /search [query] - Search for products\n‚Ä¢ /filter [type] - Apply filters (women, men, price)\n‚Ä¢ /extract - Show products on current page\n‚Ä¢ /cart - View cart status and add items\n‚Ä¢ /clear - Clear all filters\n\nüí¨ Chat Controls:\n‚Ä¢ /help - Show this help menu\n‚Ä¢ /status - Show system status\n‚Ä¢ /debug - Toggle debug mode (or use /debug on/off)\n\nüõí Cart Commands:\n‚Ä¢ /cart - Show cart information\n‚Ä¢ /cart add [product] - Add product to cart\n‚Ä¢ /cart view - Open shopping cart\n\nüìù Examples:\n‚Ä¢ /search nike running shoes\n‚Ä¢ /filter women\n‚Ä¢ /filter under 150\n‚Ä¢ /cart add first\n\nüí° Tip: You can also use natural language!\nTry: "show me women\'s running shoes under $100"'})},e)})),function(){return k.apply(this,arguments)})},{key:"handleStatusIntent",value:(w=g(l().m(function e(){var n;return l().w(function(e){for(;;)if(0===e.n)return n=this.getStatus(),e.a(2,{success:!0,type:"status",message:"üìä System Status:\n- Version: ".concat(n.version,"\n- Session: ").concat(n.sessionId,"\n- Loaded: ").concat(n.loadTime,"\n- Domain: ").concat(n.domain,"\n- Adapter: ").concat(n.hasAdapter?"‚úÖ":"‚ùå"," ").concat(n.adapterName,"\n- Chat API: ").concat(n.hasApiClient?"‚úÖ":"‚ùå","\n- MCP Server: ").concat(n.mcpServer?"‚úÖ":"‚ùå"," (").concat(n.mcpToolCount," tools)"),data:n})},e,this)})),function(){return w.apply(this,arguments)})},{key:"handleDebugIntent",value:(y=g(l().m(function e(n){var t;return l().w(function(e){for(;;)if(0===e.n)return t="/debug on"===n||"/debug"===n&&!this.config.debug,this.config.debug=t,e.a(2,{success:!0,type:"debug",message:t?"üîß Debug mode enabled\n\nDebug commands:\n‚Ä¢ Type normally to see input performance metrics\n‚Ä¢ Use /commands to see command processing logs  \n‚Ä¢ Check browser console for detailed timing data\n‚Ä¢ Performance data shows DOM queries, HTML rebuilds, event handling\n\nPerformance optimizations active:\n‚úÖ Input change detection\n‚úÖ DOM element caching  \n‚úÖ Smart HTML rebuilding\n‚úÖ Event delegation\n‚úÖ Early returns for non-slash input":"üîß Debug mode disabled",data:{debug:t}})},e,this)})),function(e){return y.apply(this,arguments)})},{key:"handleClearIntent",value:(p=g(l().m(function e(){var n;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"clear",error:"No adapter available for this site. Clear filters only works on supported e-commerce sites."});case 1:return e.n=2,this.siteAdapter.applyFilters({});case 2:return n=e.v,e.a(2,{success:n.success,type:"clear",message:n.success?"All filters cleared":"Failed to clear filters: ".concat(n.error),data:n})}},e,this)})),function(){return p.apply(this,arguments)})},{key:"handleUnknownCommandIntent",value:(d=g(l().m(function e(n){return l().w(function(e){for(;;)if(0===e.n)return e.a(2,{success:!1,type:"unknown_command",message:"Unknown command: ".concat(n,"\nType /help to see available commands"),error:"Unknown command: ".concat(n)})},e)})),function(e){return d.apply(this,arguments)})},{key:"handleCartCommandIntent",value:(u=g(l().m(function e(n,t){var r,i,s,a,o,c,u;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,{success:!1,type:"cart",message:"üõí Cart operations are not available on this site.\n\nCart commands only work on supported e-commerce sites.",error:"No adapter available"});case 1:if(null==(i=this.siteAdapter.getMCPCapabilities())||null===(r=i.tools)||void 0===r?void 0:r.some(function(e){return"add_to_cart"===e.name})){e.n=2;break}return e.a(2,{success:!1,type:"cart",message:"üõí Cart operations are not implemented for this site yet.",error:"Cart tool not available"});case 2:if(n&&""!==n){e.n=3;break}return e.a(2,{success:!0,type:"cart",message:'üõí Cart Commands\n\n‚Ä¢ /cart - Show this help\n‚Ä¢ /cart add [number] - Add product by position (1, 2, 3...)\n‚Ä¢ /cart add first - Add first product\n‚Ä¢ /cart add last - Add last product\n‚Ä¢ /cart view - Open shopping cart page\n\nüí° Tips:\n- First extract products with /extract\n- Then use /cart add 1 to add the first product\n- Or use natural language: "add the Nike shoes to cart"'});case 3:if("view"!==n){e.n=4;break}return e.a(2,{success:!0,type:"cart",message:"üõí Opening shopping cart...",action:"view_cart"});case 4:if(!n.startsWith("add ")){e.n=12;break}return s=n.substring(4).trim(),e.n=5,this.siteAdapter.extractProducts();case 5:if((a=e.v).success&&a.products&&0!==a.products.length){e.n=6;break}return e.a(2,{success:!1,type:"cart",message:"‚ùå No products found on this page.\n\nTry:\n1. Navigate to a product page\n2. Use /search to find products\n3. Then use /cart add",error:"No products available"});case 6:if(o=-1,c=null,"first"===s?o=0:"last"===s?o=a.products.length-1:/^\d+$/.test(s)&&(o=parseInt(s)-1),!(o>=0&&o<a.products.length)){e.n=7;break}c=a.products[o],e.n=8;break;case 7:return e.a(2,{success:!1,type:"cart",message:'‚ùå Invalid product reference: "'.concat(s,'"\n\nFound ').concat(a.products.length," products. Use:\n‚Ä¢ Numbers 1-").concat(a.products.length,'\n‚Ä¢ "first" or "last"'),error:"Invalid product reference"});case 8:return e.n=9,this.siteAdapter.callMCPTool("add_to_cart",{productId:c.productUrl||c.title,size:null,quantity:1});case 9:if(!(u=e.v).success){e.n=10;break}return e.a(2,{success:!0,type:"cart",message:"‚úÖ ".concat(u.message,"\n\nüì¶ Product: ").concat(c.title,"\nüí∞ Price: ").concat(c.priceText||"No price"),data:{product:c,cartResult:u}});case 10:return e.a(2,{success:!1,type:"cart",message:"‚ùå ".concat(u.message,"\n\nüì¶ Product: ").concat(c.title),error:u.message,debug:u.debug});case 11:e.n=13;break;case 12:return e.a(2,{success:!1,type:"cart",message:'‚ùå Unknown cart command: "'.concat(n,'"\n\nTry:\n‚Ä¢ /cart - Show cart help\n‚Ä¢ /cart add 1 - Add first product\n‚Ä¢ /cart view - Open cart'),error:"Unknown cart sub-command"});case 13:return e.a(2)}},e,this)})),function(e,n){return u.apply(this,arguments)})},{key:"getStatus",value:function(){return{initialized:!0,version:b,sessionId:v,loadTime:x,domain:this.domain,hasAdapter:!!this.siteAdapter,hasApiClient:!!this.apiClient,adapterName:this.siteAdapter&&this.siteAdapter.constructor.name||"none",mcpServer:!!this.mcpServer,mcpToolCount:this.mcpCapabilities&&this.mcpCapabilities.tools&&this.mcpCapabilities.tools.length||0}}},{key:"getMCPCapabilities",value:function(){return this.mcpCapabilities}},{key:"callMCPTool",value:(c=g(l().m(function e(n,t){return l().w(function(e){for(;;)switch(e.n){case 0:if(this.mcpServer){e.n=1;break}throw new Error("MCP Server not initialized");case 1:return e.n=2,this.mcpServer.callTool(n,t);case 2:return e.a(2,e.v)}},e,this)})),function(e,n){return c.apply(this,arguments)})},{key:"getPageProductsJsonLD",value:(s=g(l().m(function e(){var n;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}return e.a(2,[]);case 1:return e.p=1,e.n=2,this.siteAdapter.callMCPTool("get_page_products",{});case 2:if(!(n=e.v).success||!n.data){e.n=3;break}return e.a(2,n.data);case 3:return e.a(2,[]);case 4:e.n=6;break;case 5:return e.p=5,e.v,e.a(2,[]);case 6:return e.a(2)}},e,this,[[1,5]])})),function(){return s.apply(this,arguments)})},{key:"executeMCPToolCalls",value:(r=g(l().m(function e(n){var t,r,i,s,o,c,u;return l().w(function(e){for(;;)switch(e.n){case 0:if(this.siteAdapter){e.n=1;break}throw new Error("No adapter available for MCP tool execution");case 1:t=[],r=a(n),e.p=2,r.s();case 3:if((i=r.n()).done){e.n=8;break}return s=i.value,e.p=4,e.n=5,this.siteAdapter.callMCPTool(s.tool,s.parameters);case 5:o=e.v,t.push({tool:s.tool,parameters:s.parameters,result:o,success:o.success}),e.n=7;break;case 6:e.p=6,c=e.v,t.push({tool:s.tool,parameters:s.parameters,result:{success:!1,message:c.message},success:!1});case 7:e.n=3;break;case 8:e.n=10;break;case 9:e.p=9,u=e.v,r.e(u);case 10:return e.p=10,r.f(),e.f(10);case 11:return e.a(2,t)}},e,this,[[4,6],[2,9,10,11]])})),function(e){return r.apply(this,arguments)})},{key:"formatMCPResponse",value:function(e,n){var t=e.text_response||"";return n&&n.length>0&&(t+="\n\nActions taken:",n.forEach(function(e){var n=e.success?"‚úÖ":"‚ùå";t+="\n".concat(n," ").concat(e.tool,": ").concat(e.result.message)})),t}}],n&&f(e.prototype,n),t&&f(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,t,r,s,c,u,d,p,y,w,k,S,_,C,P,E,A,I,T,O,j,M,q}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function S(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function s(t,r,i,s){var c=r&&r.prototype instanceof o?r:o,u=Object.create(c.prototype);return _(u,"_invoke",function(t,r,i){var s,o,c,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(n,t){return s=n,o=0,c=e,p.n=t,a}};function g(t,r){for(o=t,c=r,n=0;!d&&u&&!i&&n<l.length;n++){var i,s=l[n],g=p.p,h=s[2];t>3?(i=h===r)&&(c=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=g&&((i=t<2&&g<s[1])?(o=0,p.v=r,p.n=s[1]):g<h&&(i=t<3||s[0]>r||r>h)&&(s[4]=t,s[5]=r,p.n=h,o=0))}if(i||t>1)return a;throw d=!0,r}return function(i,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&g(l,h),o=l,c=h;(n=o<2?e:c)||!d;){s||(o?o<3?(o>1&&(p.n=-1),g(o,c)):p.n=c:p.v=c);try{if(u=2,s){if(o||(i="next"),n=s[i]){if(!(n=n.call(s,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,o<2&&(o=0)}else 1===o&&(n=s.return)&&n.call(s),o<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((n=(d=p.n<0)?c:t.call(r,p))!==a)break}catch(n){s=e,o=1,c=n}finally{u=1}}return{value:n,done:d}}}(t,i,s),!0),u}var a={};function o(){}function c(){}function u(){}n=Object.getPrototypeOf;var l=[][r]?n(n([][r]())):(_(n={},r,function(){return this}),n),d=u.prototype=o.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,_(d,"constructor",u),_(u,"constructor",c),c.displayName="GeneratorFunction",_(u,i,"GeneratorFunction"),_(d),_(d,i,"Generator"),_(d,r,function(){return this}),_(d,"toString",function(){return"[object Generator]"}),(S=function(){return{w:s,m:p}})()}function _(e,n,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_=function(e,n,t,r){if(n)i?i(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t;else{var s=function(n,t){_(e,n,function(e){return this._invoke(n,t,e)})};s("next",0),s("throw",1),s("return",2)}},_(e,n,t,r)}function C(e,n,t,r,i,s,a){try{var o=e[s](a),c=o.value}catch(e){return void t(e)}o.done?n(c):Promise.resolve(c).then(r,i)}function P(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var s=e.apply(n,t);function a(e){C(s,r,i,a,o,"next",e)}function o(e){C(s,r,i,a,o,"throw",e)}a(void 0)})}}function E(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function A(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?E(Object(t),!0).forEach(function(n){I(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function I(e,n,t){return(n=O(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function T(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function O(e){var n=function(e,n){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==k(n)?n:n+""}!function(){var e=Math.random().toString(36).substring(2,9);(new Date).toISOString(),document.currentScript&&document.currentScript.src;function n(){if(!document.getElementById("kaynix-widget-styles")){var e=document.createElement("style");e.id="kaynix-widget-styles",e.textContent="\n            .kaynix-widget-container {\n                all: initial;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                width: 400px;\n                max-width: calc(100vw - 40px);\n                height: 500px;\n                background: white;\n                border: 1px solid #e1e5e9;\n                border-radius: 12px;\n                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\n                display: flex;\n                flex-direction: column;\n                z-index: 10000;\n            }\n            \n            .kaynix-widget-header {\n                padding: 16px 20px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                border-radius: 12px 12px 0 0;\n            }\n            \n            .kaynix-widget-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                font-size: 16px;\n            }\n            \n            .kaynix-widget-close {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 24px;\n                cursor: pointer;\n                padding: 0;\n                width: 30px;\n                height: 30px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            \n            .kaynix-widget-close:hover {\n                opacity: 0.8;\n            }\n            \n            .kaynix-widget-body {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n            \n            .kaynix-widget-messages {\n                flex: 1;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 20px;\n                /* Prevent scroll events from bubbling up to the main page */\n                overscroll-behavior-y: contain;\n                /* Ensure scrolling works properly on touch devices */\n                -webkit-overflow-scrolling: touch;\n                scrollbar-width: thin;\n                position: relative;\n                z-index: 1;\n            }\n            \n            .kaynix-widget-messages::-webkit-scrollbar {\n                width: 6px;\n            }\n            \n            .kaynix-widget-messages::-webkit-scrollbar-track {\n                background: #f1f1f1;\n                border-radius: 3px;\n            }\n            \n            .kaynix-widget-messages::-webkit-scrollbar-thumb {\n                background: #c1c1c1;\n                border-radius: 3px;\n            }\n            \n            .kaynix-widget-messages::-webkit-scrollbar-thumb:hover {\n                background: #a8a8a8;\n            }\n            \n            .kaynix-message {\n                margin-bottom: 16px;\n            }\n            \n            .kaynix-message-user {\n                text-align: right;\n            }\n            \n            .kaynix-message-user-command {\n                text-align: right;\n            }\n            \n            .kaynix-message-user .kaynix-message-content {\n                background: #667eea;\n                color: white;\n                display: inline-block;\n                padding: 10px 14px;\n                border-radius: 18px 18px 4px 18px;\n                max-width: 80%;\n                text-align: left;\n            }\n            \n            .kaynix-message-user-command .kaynix-message-content {\n                background: #667eea;\n                color: white;\n                display: inline-block;\n                padding: 8px 12px;\n                border-radius: 8px;\n                max-width: fit-content;\n                text-align: left;\n                font-family: 'Courier New', Courier, monospace;\n                font-size: 13px;\n                border: 1px solid #5a67d8;\n            }\n            \n            .kaynix-message-assistant .kaynix-message-content {\n                background: #f3f4f6;\n                color: #1f2937;\n                display: inline-block;\n                padding: 10px 14px;\n                border-radius: 18px 18px 18px 4px;\n                max-width: 80%;\n            }\n            \n            .kaynix-message-content strong {\n                font-weight: 600;\n                color: #111827;\n            }\n            \n            .kaynix-message-content ul,\n            .kaynix-message-content ol {\n                margin: 8px 0;\n                padding-left: 20px;\n            }\n            \n            .kaynix-message-content li {\n                margin: 4px 0;\n            }\n            \n            .kaynix-message-content br {\n                display: block;\n                content: \"\";\n                margin: 4px 0;\n            }\n            \n            .kaynix-message-command .kaynix-message-content {\n                background: #1e293b;\n                color: #e2e8f0;\n                display: block;\n                padding: 12px 16px;\n                border-radius: 8px;\n                max-width: 100%;\n                font-family: 'Courier New', Courier, monospace;\n                font-size: 13px;\n                line-height: 1.5;\n                white-space: pre-wrap;\n                border: 1px solid #334155;\n            }\n            \n            .kaynix-message-command .kaynix-message-content a {\n                color: #e2e8f0;\n                text-decoration: none;\n            }\n            \n            .kaynix-message-command .kaynix-message-content a:hover {\n                color: #e2e8f0;\n                text-decoration: underline;\n            }\n            \n            .kaynix-widget-input-container {\n                padding: 16px 20px;\n                border-top: 1px solid #e5e7eb;\n                display: flex;\n                gap: 8px;\n                position: relative;\n                z-index: 10000; /* Base z-index for input container */\n            }\n            \n            .kaynix-widget-input {\n                flex: 1;\n                padding: 10px 14px;\n                border: 1px solid #d1d5db;\n                border-radius: 20px;\n                font-size: 14px;\n                outline: none;\n            }\n            \n            .kaynix-widget-input:focus {\n                border-color: #667eea;\n            }\n            \n            .kaynix-widget-submit {\n                padding: 10px 20px;\n                background: #667eea;\n                color: white;\n                border: none;\n                border-radius: 20px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n            }\n            \n            .kaynix-widget-submit:hover:not(:disabled) {\n                background: #5a67d8;\n            }\n            \n            .kaynix-widget-submit:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n            \n            .kaynix-widget-loading {\n                padding: 20px;\n                text-align: center;\n                color: #6b7280;\n            }\n            \n            .kaynix-widget-trigger {\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                width: 60px;\n                height: 60px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                border-radius: 50%;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-size: 28px;\n                z-index: 9999;\n            }\n            \n            .kaynix-widget-trigger:hover {\n                transform: scale(1.1);\n            }\n            \n            /* Product extraction bubble styles */\n            .kaynix-products-bubble {\n                width: 100%;\n                background: #f9fafb;\n                border-radius: 12px;\n                padding: 16px;\n                margin: 8px 0;\n            }\n            \n            .kaynix-products-header {\n                font-weight: 600;\n                color: #1f2937;\n                margin-bottom: 12px;\n                font-size: 15px;\n            }\n            \n            .kaynix-products-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n            \n            .kaynix-product-item {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                padding: 12px;\n                background: white;\n                border: 1px solid #e5e7eb;\n                border-radius: 8px;\n                text-decoration: none;\n                color: inherit;\n                transition: all 0.2s ease;\n                min-height: 50px;\n                gap: 12px;\n            }\n            \n            .kaynix-product-item:hover {\n                background: #f3f4f6;\n                border-color: #d1d5db;\n                transform: translateX(4px);\n            }\n            \n            .kaynix-product-title {\n                flex: 1;\n                font-size: 14px;\n                color: #1f2937 !important;\n                font-weight: 500;\n                margin-right: 12px;\n                line-height: 1.4;\n                word-wrap: break-word;\n                overflow: visible;\n                min-height: 20px;\n                display: block;\n                visibility: visible;\n                opacity: 1;\n            }\n            \n            .kaynix-product-price {\n                font-size: 14px;\n                color: #059669;\n                font-weight: 600;\n                white-space: nowrap;\n            }\n            \n            .kaynix-products-empty {\n                text-align: center;\n                color: #6b7280;\n                padding: 20px;\n                font-style: italic;\n            }\n            \n            .kaynix-command-suggestions {\n                position: absolute;\n                bottom: 100%;\n                left: 0;\n                right: 0;\n                background: white;\n                border: 1px solid #e5e7eb;\n                border-radius: 8px;\n                margin-bottom: 8px;\n                box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);\n                max-height: 200px;\n                overflow-y: auto;\n                display: none;\n                z-index: 10001; /* Higher than widget container */\n                /* Prevent interference with scrolling */\n                pointer-events: auto;\n            }\n            \n            .kaynix-command-suggestions.show {\n                display: block;\n                /* Ensure suggestions don't block scrolling */\n                pointer-events: auto;\n            }\n            \n            .kaynix-command-suggestion {\n                padding: 12px 16px;\n                cursor: pointer;\n                border-bottom: 1px solid #f3f4f6;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n            \n            .kaynix-command-suggestion:last-child {\n                border-bottom: none;\n            }\n            \n            .kaynix-command-suggestion:hover,\n            .kaynix-command-suggestion.selected {\n                background: #f3f4f6;\n            }\n            \n            .kaynix-command-name {\n                font-weight: 500;\n                color: #667eea;\n            }\n            \n            .kaynix-command-desc {\n                font-size: 12px;\n                color: #6b7280;\n            }\n            \n            /* Filter bubble/badge styling */\n            .kaynix-filter-bubble {\n                display: inline-block;\n                background: #667eea;\n                color: white;\n                padding: 4px 12px;\n                border-radius: 16px;\n                font-size: 12px;\n                font-weight: 500;\n                margin: 2px 4px 2px 0;\n                position: relative;\n                z-index: 1;\n                white-space: nowrap;\n            }\n            \n            /* Ensure proper spacing between filter indicators and messages */\n            .kaynix-message-with-filter {\n                margin-top: 12px;\n                margin-bottom: 20px;\n            }\n            \n            .kaynix-message-with-filter .kaynix-message-content {\n                padding-top: 4px;\n                line-height: 1.6;\n            }\n            \n            /* Fix z-index layering issues */\n            .kaynix-widget-messages {\n                position: relative;\n                z-index: 1;\n            }\n            \n            .kaynix-message {\n                position: relative;\n                z-index: 2;\n                clear: both;\n            }\n            \n            /* Prevent filter bubbles from overlapping with subsequent messages */\n            .kaynix-message + .kaynix-message {\n                margin-top: 16px;\n            }\n            \n            /* Debug and system messages should not overlap suggestions */\n            .kaynix-message-command {\n                position: relative;\n                z-index: 1; /* Lower than suggestions */\n            }\n            \n            /* Debug info styling */\n            .kaynix-message.debug .kaynix-message-content {\n                background: #f0f9ff;\n                border: 1px solid #bae6fd;\n                font-family: 'Monaco', 'Menlo', 'Consolas', monospace;\n                font-size: 12px;\n                line-height: 1.5;\n            }\n            \n            .kaynix-debug-info {\n                color: #0f172a;\n            }\n            \n            .kaynix-debug-info strong {\n                color: #0369a1;\n                display: block;\n                margin-top: 8px;\n                margin-bottom: 4px;\n            }\n            \n            .kaynix-debug-info .debug-section {\n                margin-left: 12px;\n                color: #475569;\n            }\n            \n            .kaynix-debug-info .debug-value {\n                color: #0f172a;\n                font-weight: 600;\n                background: rgba(255, 255, 255, 0.5);\n                padding: 0 4px;\n                border-radius: 3px;\n            }\n            \n            /* Intent-specific message styling */\n            .kaynix-message.intent-exploring .kaynix-message-content::before,\n            .kaynix-message.intent-search .kaynix-message-content::before {\n                content: 'üîç ';\n                font-size: 16px;\n            }\n            \n            .kaynix-message.intent-compare_decide .kaynix-message-content::before {\n                content: '‚öñÔ∏è ';\n                font-size: 16px;\n            }\n            \n            .kaynix-message.intent-filter .kaynix-message-content::before {\n                content: 'üéØ ';\n                font-size: 16px;\n            }\n            \n            .kaynix-message.intent-cart .kaynix-message-content::before,\n            .kaynix-message.intent-purchasing .kaynix-message-content::before {\n                content: 'üõí ';\n                font-size: 16px;\n            }\n            \n            .kaynix-message.intent-research_qa .kaynix-message-content::before {\n                content: '‚ÑπÔ∏è ';\n                font-size: 16px;\n            }\n        ",document.head.appendChild(e)}}var t=function(){return e=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=A({position:n.position||"bottom-right",autoShow:!1!==n.autoShow,debug:n.debug||!1},n),this.container=null,this.trigger=null,this.messagesEl=null,this.copilot=null,this.visible=!1,this.selectedSuggestionIndex=-1,this.elements={},this.boundHandlers={},this.lastSuggestionInput="",this.lastMatchesKey="",this.inputEventCount=0,this.suggestionDebounceTimer=null,this.commands=[{command:"/help",description:"Show available commands"},{command:"/search",description:"Search for products",example:"/search nike shoes"},{command:"/filter",description:"Apply filters",example:"/filter women"},{command:"/extract",description:"Show products on page"},{command:"/cart",description:"Cart operations",example:"/cart add 1"},{command:"/cart add",description:"Add product to cart",example:"/cart add first"},{command:"/cart view",description:"Open shopping cart"},{command:"/clear",description:"Clear all filters"},{command:"/status",description:"Show system status"},{command:"/debug",description:"Toggle debug mode"},{command:"/debug on",description:"Enable debug mode"},{command:"/debug off",description:"Disable debug mode"},{command:"/reset",description:"Clear conversation"},{command:"/reload",description:"Force reload widget (clears cache)"}]},t=[{key:"init",value:(l=P(S().m(function e(){return S().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,this.config.debug||localStorage.getItem("kaynix_debug"),n(),this.createUI(),e.n=1,this.initializeCopilot();case 1:return this.setupEventListeners(),this.config.autoShow&&this.show(),e.a(2,!0);case 2:return e.p=2,e.v,e.a(2,!1)}},e,this,[[0,2]])})),function(){return l.apply(this,arguments)})},{key:"initializeCopilot",value:(u=P(S().m(function e(){var n=this;return S().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,this.copilot=new w({debug:this.config.debug||"true"===localStorage.getItem("kaynix_debug"),apiKeyProvider:function(){return n.getApiKey()},apiUrl:this.config.apiUrl||this.config.baseUrl}),e.n=1,this.copilot.initialize();case 1:e.v.success&&(window.kaynixCopilot=this.copilot),e.n=3;break;case 2:e.p=2,e.v,this.copilot=null,setTimeout(function(){n.messagesEl&&n.addMessage("‚ö†Ô∏è Failed to load AI assistant. Please refresh the page and try again.","assistant")},1e3);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return u.apply(this,arguments)})},{key:"createUI",value:function(){var e=this;this.trigger=document.createElement("div"),this.trigger.className="kaynix-widget-trigger",this.trigger.innerHTML="üí¨",this.trigger.onclick=function(){return e.toggle()},document.body.appendChild(this.trigger),this.container=document.createElement("div"),this.container.className="kaynix-widget-container",this.container.style.display="none",this.container.innerHTML='\n                <div class="kaynix-widget-header">\n                    <div class="kaynix-widget-title">\n                        <span>ü§ñ</span>\n                        <span>Kaynix Assistant</span>\n                    </div>\n                    <button class="kaynix-widget-close" type="button">&times;</button>\n                </div>\n                <div class="kaynix-widget-body">\n                    <div class="kaynix-widget-messages"></div>\n                    <div class="kaynix-widget-input-container">\n                        <input type="text" class="kaynix-widget-input" placeholder="Ask me anything..." />\n                        <button type="submit" class="kaynix-widget-submit" disabled>Send</button>\n                        <div class="kaynix-command-suggestions"></div>\n                    </div>\n                </div>\n            ',document.body.appendChild(this.container),this.messagesEl=this.container.querySelector(".kaynix-widget-messages")}},{key:"setupEventListeners",value:function(){var e=this,n=this.container.querySelector(".kaynix-widget-input"),t=this.container.querySelector(".kaynix-widget-submit"),r=this.container.querySelector(".kaynix-widget-close"),i=this.container.querySelector(".kaynix-command-suggestions");this.elements={input:n,submit:t,close:r,suggestionsEl:i},this.boundHandlers.close=function(n){n.preventDefault(),n.stopPropagation(),e.config.debug,e.hide()},r.addEventListener("click",this.boundHandlers.close),this.boundHandlers.closeTouch=function(n){n.preventDefault(),n.stopPropagation(),e.config.debug,e.hide()},r.addEventListener("touchend",this.boundHandlers.closeTouch),this.boundHandlers.input=function(n){var r=n.target.value;t.disabled=!r.trim(),e.suggestionDebounceTimer&&clearTimeout(e.suggestionDebounceTimer),e.suggestionDebounceTimer=setTimeout(function(){r.startsWith("/")?e.showCommandSuggestions(r):e.hideCommandSuggestions()},200)},this.boundHandlers.keydown=function(n){if("Enter"===n.key&&!t.disabled)return n.preventDefault(),e.hideCommandSuggestions(),void e.handleSubmit();if(n.ctrlKey&&"d"===n.key){n.preventDefault();var r=!("true"===localStorage.getItem("kaynix_debug"));return localStorage.setItem("kaynix_debug",r?"true":"false"),e.config.debug=r,e.copilot&&(e.copilot.config.debug=r),void e.addMessage("üîß Debug mode ".concat(r?"enabled":"disabled"," (Ctrl+D to toggle)"),"system")}if("Escape"!==n.key){if(e.elements.suggestionsEl&&e.elements.suggestionsEl.classList.contains("show")){var i=e.elements.suggestionsEl.querySelectorAll(".kaynix-command-suggestion");i.length>0&&("ArrowDown"===n.key?(n.preventDefault(),e.selectedSuggestionIndex=Math.min(e.selectedSuggestionIndex+1,i.length-1),e.updateSelectedSuggestion()):"ArrowUp"===n.key?(n.preventDefault(),e.selectedSuggestionIndex=Math.max(e.selectedSuggestionIndex-1,-1),e.updateSelectedSuggestion()):"Tab"===n.key&&e.selectedSuggestionIndex>=0&&(n.preventDefault(),i[e.selectedSuggestionIndex].click()))}}else e.hideCommandSuggestions()},this.boundHandlers.documentClick=function(n){e.container.contains(n.target)||e.hideCommandSuggestions()},n.addEventListener("input",this.boundHandlers.input),n.addEventListener("keydown",this.boundHandlers.keydown),document.addEventListener("click",this.boundHandlers.documentClick),t.onclick=function(){return e.handleSubmit()}}},{key:"showCommandSuggestions",value:function(e){this.elements.suggestionsEl||(this.elements.suggestionsEl=this.container.querySelector(".kaynix-command-suggestions"));var n=this.elements.suggestionsEl,t=e.toLowerCase(),r=this.commands.filter(function(e){return e.command.toLowerCase().startsWith(t)&&e.command!==t});if(0!==r.length){var i=r.map(function(e){return e.command}).join(",");if(this.lastMatchesKey!==i){this.lastMatchesKey=i;var s=r.map(function(e,n){return'\n                    <div class="kaynix-command-suggestion" data-command="'.concat(e.command,'" data-index="').concat(n,'">\n                        <span class="kaynix-command-name">').concat(e.command,'</span>\n                        <span class="kaynix-command-desc">').concat(e.description,"</span>\n                    </div>\n                ")}).join("");n.innerHTML=s,this.setupSuggestionEventDelegation()}n.classList.add("show"),this.selectedSuggestionIndex=-1}else this.hideCommandSuggestions()}},{key:"setupSuggestionEventDelegation",value:function(){var e=this;this.suggestionClickHandler||(this.suggestionClickHandler=function(n){var t=n.target.closest(".kaynix-command-suggestion");if(t){var r=t.getAttribute("data-command");e.elements.input||(e.elements.input=e.container.querySelector(".kaynix-widget-input")),e.elements.input.value=r+" ",e.elements.input.focus(),e.hideCommandSuggestions()}},this.elements.suggestionsEl.addEventListener("click",this.suggestionClickHandler))}},{key:"showDebugInfo",value:function(e){var n=this.container.querySelector(".kaynix-widget-messages"),t='<div style="font-family: monospace; font-size: 12px;">';if(t+="<strong>üìä DEBUG INFORMATION</strong><br><br>",t+="<strong>üì§ Request:</strong><br>",t+='‚Ä¢ User Query: "'.concat(e.request.user_query,'"<br>'),t+="‚Ä¢ Page Products: ".concat(e.request.page_products_count,"<br><br>"),t+="<strong>üì• Response:</strong><br>",t+="‚Ä¢ Success: ".concat(e.response.success,"<br>"),e.response.tool_calls&&e.response.tool_calls.length>0){t+="‚Ä¢ Tool Calls: ".concat(e.response.tool_calls.length," - ");var r=e.response.tool_calls.map(function(e){return e.tool}).join(", ");t+="<strong>".concat(r,"</strong><br><br>")}else t+="‚Ä¢ Tool Calls: 0<br><br>";e.page_products_sample&&e.page_products_sample.length>0&&(t+="<strong>üì¶ Sample Products:</strong><br>",e.page_products_sample.forEach(function(e,n){t+="".concat(n+1,". ").concat(e.name," - ").concat(e.price||"No price","<br>")}),t+="<br>"),e.response.tool_calls&&e.response.tool_calls.length>0&&(t+="<strong>üîß Tool Calls:</strong><br>",e.response.tool_calls.forEach(function(e,n){t+="".concat(n+1,". ").concat(e.tool,"(").concat(JSON.stringify(e.parameters),")<br>")})),e.tool_results&&e.tool_results.length>0&&(t+="<br><strong>üîß Tool Results:</strong><br>",e.tool_results.forEach(function(e,n){var r=e.success?"‚úÖ":"‚ùå";t+="".concat(n+1,". ").concat(r," ").concat(e.tool,": ").concat(e.result&&e.result.message?e.result.message:"No message available","<br>")})),e.query_analysis&&(t+="<br><strong>üß† Query Analysis:</strong><br>",e.query_analysis.user_intent&&(t+="‚Ä¢ Intent: ".concat(e.query_analysis.user_intent,"<br>")),void 0!==e.query_analysis.intent_confidence&&(t+="‚Ä¢ Confidence: ".concat((100*e.query_analysis.intent_confidence).toFixed(0),"%<br>")),e.query_analysis.page_type&&(t+="‚Ä¢ Page Type: ".concat(e.query_analysis.page_type,"<br>")),e.query_analysis.page_query&&(t+='‚Ä¢ Page Query: "'.concat(e.query_analysis.page_query,'"<br>'))),t+="</div>";var i=document.createElement("div");i.className="kaynix-message kaynix-message-debug",i.innerHTML='\n                <div class="kaynix-message-content" style="background: #f0f0f0; border-left: 3px solid #666; color: #333;">\n                    '.concat(t,"\n                </div>\n            "),n.appendChild(i),n.scrollTop=n.scrollHeight}},{key:"hideCommandSuggestions",value:function(){this.elements.suggestionsEl||(this.elements.suggestionsEl=this.container.querySelector(".kaynix-command-suggestions")),this.elements.suggestionsEl.classList.remove("show"),this.selectedSuggestionIndex=-1,this.lastMatchesKey=""}},{key:"updateSelectedSuggestion",value:function(){var e=this;this.elements.suggestionsEl&&this.elements.suggestionsEl.querySelectorAll(".kaynix-command-suggestion").forEach(function(n,t){t===e.selectedSuggestionIndex?n.classList.add("selected"):n.classList.remove("selected")})}},{key:"handleSubmit",value:(c=P(S().m(function e(){var n,t,r;return S().w(function(e){for(;;)switch(e.n){case 0:if(n=this.container.querySelector(".kaynix-widget-input"),t=n.value.trim()){e.n=1;break}return e.a(2);case 1:return n.value="",this.container.querySelector(".kaynix-widget-submit").disabled=!0,r=t.startsWith("/")?"user-command":"user",this.addMessage(t,r),e.n=2,this.processMessage(t);case 2:return e.a(2)}},e,this)})),function(){return c.apply(this,arguments)})},{key:"processMessage",value:(o=P(S().m(function e(n){var t,r,i,s,a,o,c,u;return S().w(function(e){for(;;)switch(e.n){case 0:if(!n.startsWith("/")){e.n=2;break}return e.n=1,this.handleSlashCommand(n);case 1:return e.a(2);case 2:if(this.copilot){e.n=3;break}return this.addMessage("‚ö†Ô∏è AI assistant not loaded. Please refresh the page and try again.","assistant"),e.a(2);case 3:if(t=this.showLoading(),e.p=4,r=[],!this.copilot.siteAdapter){e.n=8;break}return e.p=5,e.n=6,this.copilot.siteAdapter.extractProducts();case 6:(i=e.v).success&&i.products&&(r=i.products),e.n=8;break;case 7:e.p=7,e.v;case 8:return e.n=9,this.copilot.processUserInputMCP(n,{products:r,page_url:window.location.href,session_id:this.getSessionId()});case 9:s=e.v,this.removeLoading(t),s.success?(a="","debug"===s.type&&s.message?(o="=".repeat(50),c=s.message.split(o),a=c[0].trim()):a="chat"===s.type?null!==(u=s.response)&&void 0!==u&&u.text?s.response.text:"string"==typeof s.response?s.response:s.message||"Action completed":s.message?s.message:s.response?"string"==typeof s.response?s.response:s.response.text||"Action completed":"Action completed",this.addMessage(a,"assistant"),(this.config.debug||"true"===localStorage.getItem("kaynix_debug")||this.copilot&&this.copilot.config.debug)&&s.debug&&this.showDebugInfo(s.debug)):this.addMessage("Error: ".concat(s.error),"assistant"),e.n=11;break;case 10:e.p=10,e.v,this.removeLoading(t),this.addMessage("Something went wrong. Please try again.","assistant");case 11:return e.a(2)}},e,this,[[5,7],[4,10]])})),function(e){return o.apply(this,arguments)})},{key:"delegateToCopilot",value:(a=P(S().m(function e(n){var t,r,i,s;return S().w(function(e){for(;;)switch(e.n){case 0:if(this.copilot){e.n=1;break}return this.addMessage("‚ö†Ô∏è AI assistant not loaded. Please refresh the page and try again.","command"),e.a(2);case 1:return t=this.showLoading(),e.p=2,e.n=3,this.copilot.processUserInput(n,{page_url:window.location.href,session_id:this.getSessionId()});case 3:r=e.v,this.removeLoading(t),r.success?(s="",s="string"==typeof r.response?r.response:null!==(i=r.response)&&void 0!==i&&i.text?r.response.text:r.message?r.message:"Command completed",this.addMessage(s,"command"),"debug"===r.type&&r.data&&void 0!==r.data.debug&&(this.config.debug=r.data.debug,r.data.debug?localStorage.setItem("kaynix_debug","true"):localStorage.removeItem("kaynix_debug"))):this.addMessage("Error: ".concat(r.error),"command"),e.n=5;break;case 4:e.p=4,e.v,this.removeLoading(t),this.addMessage("Failed to process command. Please try again.","command");case 5:return e.a(2)}},e,this,[[2,4]])})),function(e){return a.apply(this,arguments)})},{key:"handleSlashCommand",value:(s=P(S().m(function e(n){var t,r;return S().w(function(e){for(;;)switch(e.n){case 0:if("/reset"!==(t=n.toLowerCase().trim())){e.n=1;break}return this.messagesEl.innerHTML="",this.addMessage("üí¨ Conversation cleared","command"),e.a(2);case 1:if("/reload"!==t){e.n=2;break}return this.addMessage("üîÑ Reloading widget...","command"),this.hide(),sessionStorage.removeItem("kaynix_session_id"),r=A({},this.config),window.KaynixWidget.destroy(),setTimeout(P(S().m(function e(){return S().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.KaynixWidget.init(r);case 1:window.KaynixWidget.instance&&(window.KaynixWidget.instance.show(),window.KaynixWidget.instance.addMessage("‚úÖ Widget reloaded successfully","command"));case 2:return e.a(2)}},e)})),100),e.a(2);case 2:return e.n=3,this.delegateToCopilot(n);case 3:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"addMessage",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement("div");r.className="kaynix-message kaynix-message-".concat(n),t.intent&&r.classList.add("intent-".concat(t.intent));var i=e.includes("Applied filters")||e.includes("/filter");if(i&&r.classList.add("kaynix-message-with-filter"),"user"===n||"user-command"===n)r.innerHTML='<div class="kaynix-message-content">'.concat(this.escapeHtml(e),"</div>");else{var s=this.sanitizeHtml(e);i&&(s=this.formatFilterMessage(s)),r.innerHTML='<div class="kaynix-message-content">'.concat(s,"</div>")}this.messagesEl.appendChild(r),this.scrollToBottom()}},{key:"showLoading",value:function(){var e=document.createElement("div");return e.className="kaynix-widget-loading",e.id="loading-".concat(Date.now()),e.textContent="Thinking...",this.messagesEl.appendChild(e),this.scrollToBottom(),e.id}},{key:"removeLoading",value:function(e){var n=document.getElementById(e);n&&n.remove()}},{key:"show",value:function(){this.container.style.display="flex",this.trigger.style.display="none",this.visible=!0;var e=this.container.querySelector(".kaynix-widget-input");e&&setTimeout(function(){return e.focus()},100)}},{key:"hide",value:function(){this.container.style.display="none",this.trigger.style.display="flex",this.visible=!1}},{key:"toggle",value:function(){this.visible?this.hide():this.show()}},{key:"getApiKey",value:(i=P(S().m(function e(){var n;return S().w(function(e){for(;;)if(0===e.n)return(n=localStorage.getItem("kaynix_api_key"))||(n=prompt("Please enter your Kaynix API key:"))&&localStorage.setItem("kaynix_api_key",n),e.a(2,n)},e)})),function(){return i.apply(this,arguments)})},{key:"getSessionId",value:function(){var e=sessionStorage.getItem("kaynix_session_id");return e||(e="session-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),sessionStorage.setItem("kaynix_session_id",e)),e}},{key:"escapeHtml",value:function(e){var n=document.createElement("div");return n.textContent=e,n.innerHTML}},{key:"formatFilterMessage",value:function(e){return e.replace(/Applied filters:\s*([^.]+)/gi,function(e,n){var t=n.split(",").map(function(e){return e.trim()}).map(function(e){return'<span class="kaynix-filter-bubble">'.concat(e,"</span>")}).join(" ");return"Applied filters:<br>".concat(t)})}},{key:"sanitizeHtml",value:function(e){var n=["strong","em","b","i","u","br","p","ul","ol","li","code","pre","span","div","a"],t=["href","target","rel"],r=document.createElement("div");r.innerHTML=e;var i=function(e){for(var r=0,s=Array.from(e.children);r<s.length;r++){var a=s[r];if(n.includes(a.tagName.toLowerCase())){for(var o=0,c=Array.from(a.attributes);o<c.length;o++){var u=c[o];t.includes(u.name)&&("href"!==u.name||u.value.startsWith("http"))||a.removeAttribute(u.name)}i(a)}else{var l=document.createTextNode(a.textContent);a.parentNode.replaceChild(l,a)}}};return i(r),r.innerHTML}},{key:"scrollToBottom",value:function(){var e=this;this.messagesEl&&requestAnimationFrame(function(){try{e.messagesEl.scrollTop=e.messagesEl.scrollHeight,setTimeout(function(){e.messagesEl&&(e.messagesEl.scrollTop=e.messagesEl.scrollHeight)},50)}catch(n){e.config.debug}})}},{key:"destroy",value:function(){if(this.suggestionDebounceTimer&&clearTimeout(this.suggestionDebounceTimer),this.elements&&this.elements.input&&this.boundHandlers&&(this.boundHandlers.input&&this.elements.input.removeEventListener("input",this.boundHandlers.input),this.boundHandlers.keydown&&this.elements.input.removeEventListener("keydown",this.boundHandlers.keydown)),this.elements&&this.elements.close&&this.boundHandlers&&(this.boundHandlers.close&&this.elements.close.removeEventListener("click",this.boundHandlers.close),this.boundHandlers.closeTouch&&this.elements.close.removeEventListener("touchend",this.boundHandlers.closeTouch)),this.boundHandlers&&this.boundHandlers.documentClick&&document.removeEventListener("click",this.boundHandlers.documentClick),this.container){var e=this.container.querySelector(".kaynix-widget-messages");e&&this.boundHandlers&&(this.boundHandlers.wheel&&e.removeEventListener("wheel",this.boundHandlers.wheel),this.boundHandlers.mousewheel&&e.removeEventListener("mousewheel",this.boundHandlers.mousewheel))}this.copilot&&(this.copilot=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.trigger&&this.trigger.parentNode&&this.trigger.parentNode.removeChild(this.trigger),this.elements={},this.boundHandlers={},this.container=null,this.trigger=null,this.messagesEl=null,this.visible=!1}}],t&&T(e.prototype,t),r&&T(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,i,s,a,o,c,u,l}();window.KaynixWidget={version:"4.0.0",sessionId:e||Math.random().toString(36).substring(2,9),loadTime:(new Date).toISOString(),instance:null,_instance:null,init:function(){var e=arguments,n=this;return P(S().m(function r(){var i,s,a;return S().w(function(r){for(;;)switch(r.n){case 0:if(i=e.length>0&&void 0!==e[0]?e[0]:{},!n.instance&&!n._instance){r.n=1;break}return r.a(2,n.instance||n._instance);case 1:return n.instance=new t(i),n._instance=n.instance,r.p=2,r.n=3,n.instance.init();case 3:return(s=r.v)||(n.instance=null,n._instance=null),r.a(2,s);case 4:throw r.p=4,a=r.v,n.instance=null,n._instance=null,a;case 5:return r.a(2)}},r,null,[[2,4]])}))()},destroy:function(){this.instance&&(this.instance.destroy(),this.instance=null,this._instance=null)},show:function(){this.instance&&this.instance.show()},hide:function(){this.instance&&this.instance.hide()},getState:function(){return this.instance?{visible:this.instance.visible,initialized:!0}:{visible:!1,initialized:!1}}};var r=document.currentScript;if(r&&"false"!==r.getAttribute("data-auto-init")){var i={};r.getAttribute("data-position")&&(i.position=r.getAttribute("data-position")),r.getAttribute("data-auto-show")&&(i.autoShow="true"===r.getAttribute("data-auto-show")),r.getAttribute("data-debug")&&(i.debug="true"===r.getAttribute("data-debug")),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){window.KaynixWidget.init(i)}):window.KaynixWidget.init(i)}}()})();